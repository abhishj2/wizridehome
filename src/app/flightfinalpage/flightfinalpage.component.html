<div *ngIf="loader">
  <main class="shimmer-main">
    <div class="shimmer-box-long"></div>
    <p></p>
    <div class="shimmer-box-long1"></div>
    <br />
    <div>
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-circle"></div>
            <div class="shimmer-box1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-circle"></div>
            <div class="shimmer-box1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>
      </div>
      <br />
      <div class="shimmer-box-long2"></div>
      <br />
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>
      </div>
      <br />
      <div class="shimmer-box-long1"></div>
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long"></div>
          </div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long"></div>
          </div>
        </div>
      </div>
      <div class="shimmer-box-long2"></div>
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>
      </div>
      <br />
      <div class="shimmer-box-long"></div>
    </div>
  </main>
</div>

<div class="scroll-wrapper" *ngIf="!loader">
  <!-- Oneway Trip -->
  <div class="flight-final-page" *ngIf="tripType == 'oneway'" id="oneway-section">
    <!-- Flight Summary Card -->
    <div class="card flight-summary-card" *ngIf="flightSegments?.length">
      <!-- Desktop Flight Summary Design -->
      <div class="desktop-flight-summary" *ngFor="let segment of flightSegments; let i = index">
        <!-- Route Header -->
        <div class="route-header">
          <div class="route-info">
            <div class="route-title">
              {{ segment.from }} <span>â†’</span> {{ segment.to }}
            </div>
            <div class="date-time-section">
              <span class="date-badge">{{ segment.date | date : "EEEE, MMM dd" }}</span>
              <span class="flight-duration">
                <span *ngIf="flightSegments.length === 1">Non Stop</span>
                <span *ngIf="flightSegments.length > 1">{{ flightSegments.length - 1 }} Stop{{ flightSegments.length > 2
                  ? 's' : '' }}</span>
                â€¢ {{ segment.duration }}
              </span>
            </div>
          </div>
          <div class="cancellation-badge"
            *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
            CANCELLATION FEES APPLY
          </div>
        </div>

        <!-- Flight Details -->
        <div class="flight-details-section">
          <!-- Airline Info -->
          <div class="airline-info-row">
            <div class="airline-left">
              <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
              </div>
              <img [src]="segment.logo" class="airline-logo-img"
                *ngIf="segment.logo && !segment.logo.includes('default')" />
              <div class="airline-details">
                <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
              </div>
            </div>
            <div class="fare-info">
              <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass }}</span>
            </div>
          </div>

          <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare Rules</a>

          <!-- Flight Timeline -->
          <div class="flight-timeline-grid">
            <div class="timeline-item">
              <div class="time">{{ segment.departureTime }}</div>
              <div class="timeline-dot"></div>
              <div class="location-info">
                <div class="city-name">{{ segment.from }}</div>
                <div class="airport-name">{{ segment.fromAirport || segment.from + ' Airport' }}</div>
                <div class="duration">{{ segment.duration }}</div>
              </div>
            </div>

            <div class="timeline-item">
              <div class="time">{{ segment.arrivalTime }}</div>
              <div class="timeline-dot"></div>
              <div class="location-info">
                <div class="city-name">{{ segment.to }}</div>
                <div class="airport-name">{{ segment.toAirport || segment.to + ' Airport' }}</div>
              </div>
            </div>
          </div>

          <!-- Baggage Info -->
          <div class="baggage-info-grid">
            <div class="baggage-item">
              <span class="baggage-icon">ðŸ’¼</span>
              <div>
                <span class="baggage-label">Cabin Baggage:</span> {{ segment.cabin || '7 KG' }} / Adult
              </div>
            </div>
            <div class="baggage-item">
              <span class="baggage-icon">ðŸ§³</span>
              <div>
                <span class="baggage-label">Check-In Baggage:</span> {{ segment.checkIn || '15 Kilograms (1 piece only)'
                }} / Adult
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Flight Summary (Original Design) -->
      <div class="mobile-flight-summary">
        <div class="flight-leg oneway-flight-leg">
          <div class="flexflight" *ngFor="let segment of flightSegments; let i = index">
            <!-- Airline Info -->
            <div class="flight-airline">
              <img [src]="segment.logo" class="logo" />
              <div class="name">{{ segment.airline }}</div>
              <div class="code">{{ segment.code }}</div>
            </div>

            <!-- Route Info -->
            <div class="flight-route">
              <div class="city">{{ segment.from }}</div>
              <div class="plane-icon">
                <i class="fas fa-plane"></i>
              </div>
              <div class="city">{{ segment.to }}</div>
            </div>

            <!-- Timing & Duration -->
            <div class="flight-meta">
              {{ segment.date | date : "EEE, dd MMM" }} |
              {{ segment.departureTime }} - {{ segment.arrivalTime }} |
              {{ segment.duration }}
            </div>

            <!-- Layover if applicable -->
            <div class="layover-row" *ngIf="i < flightSegments.length - 1 && segment.layover">
              <div class="line"></div>
              <div class="layover">
                <div *ngIf="segment.layover.hours >= 24" class="plus-day">
                  + 1 Day
                </div>
                {{ segment.layover.duration }} Layover in
                {{ segment.layover.location }}
              </div>
              <div class="line"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Extra Baggage Banner - Desktop Only -->
      <div class="extra-baggage-banner" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="baggage-banner-text">
          <span class="baggage-emoji">ðŸŽ’</span>
          <span *ngIf="baggageTotal === 0">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab
            rates!</span>
          <span *ngIf="baggageTotal > 0">{{ getTotalOneWayBaggageCount() }} KGs of extra baggage added on your trip for
            â‚¹ {{ baggageTotal | number : '1.0-0' }}! Total check-in baggage is now {{ 15 + getTotalOneWayBaggageCount()
            }} KGs.</span>
        </div>
        <button class="change-baggage-btn" (click)="showAddBaggageModal = true">
          {{ baggageTotal > 0 ? 'CHANGE' : 'ADD BAGGAGE' }}
        </button>
      </div>

      <!-- Cancellation Policy Section - Desktop Only -->
      <div class="cancellation-policy-section"
        *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
        <div class="cancellation-header">
          <div class="cancellation-title">Cancellation & Date Change Policy</div>
        </div>
        <div class="cancellation-airline" *ngIf="flightDataDeparture?.Segments?.[0]?.[0]">
          <img [src]="'assets/images/flightimages/' + flightDataDeparture.Segments[0][0].Airline?.AirlineCode + '.png'"
            class="logo" />
          <span class="airline-route">{{ flightDataDeparture.Segments[0][0].Origin?.Airport?.CityCode }}-{{
            flightDataDeparture.Segments[0][flightDataDeparture.Segments[0].length - 1]?.Destination?.Airport?.CityCode
            }}</span>
        </div>
        <div class="cancellation-criteria-header">
          <div class="criteria-left">Cancellation Criteria</div>
          <div class="criteria-right">Charges</div>
        </div>
        <div class="cancellation-rows">
          <div class="cancellation-row-item" *ngFor="let row of getCancellationRows(flightDataDeparture)">
            <div class="criteria-left">{{ row.range }}</div>
            <div class="criteria-right">{{ row.price }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Passenger Card -->
    <div class="card" id="passenger-details-card">
      <div class="section-title">Add Passenger Details</div>

      <!-- Adults Section -->
      <div class="passenger-section">
        <div class="passenger-category-header">
          <span class="passenger-category-title">ADULTS (12+ YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(adults) }}/{{ adults.length }} added</span>
        </div>
        <ng-container *ngFor="let adult of adults; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="adult.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!adult.firstName"></i>
                <i class="fas fa-check" *ngIf="adult.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                adult.firstName
                ? getPassengerDisplayName(adult)
                : "Adult " + (i + 1) + " (12 yrs+)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('adult', i)">
                {{ adult.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('adult', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('adult', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="adult.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="adult.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Male'"
                      (click)="adult.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Female'"
                      (click)="adult.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row form-row-three">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(adult)" [minDate]="getAdultMinDOB()"
                      [maxDate]="getTodayDate()" [initialDate]="getTodayDate()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(adult, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'adult-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                  <div class="form-group form-group-small">
                    <label>Country Code</label>
                    <select class="dial-select" [(ngModel)]="adult.mobileDialCode">
                      <option value="+91">IN +91</option>
                      <option value="+1">US +1</option>
                      <option value="+44">UK +44</option>
                      <option value="+971">AE +971</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Mobile No</label>
                    <input type="tel" [(ngModel)]="adult.mobileNumber" placeholder="Mobile No" maxlength="10"
                      [class.error]="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.mobileNumber }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" [(ngModel)]="adult.email" placeholder="Email"
                    [class.error]="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.email }}</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="adult.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="adult.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="adult.panNumber" placeholder="Enter PAN number"
                    [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('adult', i, adult)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Children Section -->
      <div class="passenger-section" *ngIf="children.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">CHILDREN (2-12 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(children) }}/{{ children.length }} added</span>
        </div>
        <ng-container *ngFor="let child of children; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="child.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!child.firstName"></i>
                <i class="fas fa-check" *ngIf="child.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                child.firstName
                ? getPassengerDisplayName(child)
                : "Child " + (i + 1) + " (2 to 12 yrs)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('child', i)">
                {{ child.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('child', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('child', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="child.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'child-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'child-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="child.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'child-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'child-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="child.gender === 'Male'"
                      (click)="child.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="child.gender === 'Female'"
                      (click)="child.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(child)" [minDate]="getChildMinDOB()"
                      [maxDate]="getChildMaxDOB()" [initialDate]="getChildMaxDOB()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(child, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'child-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="child.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="child.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'child-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="child.panNumber" placeholder="Enter PAN number"
                    [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'child-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('child', i, child)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Infants Section -->
      <div class="passenger-section" *ngIf="infants.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">INFANTS (0-2 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(infants) }}/{{ infants.length }} added</span>
        </div>
        <ng-container *ngFor="let infant of infants; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="infant.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!infant.firstName"></i>
                <i class="fas fa-check" *ngIf="infant.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                infant.firstName
                ? getPassengerDisplayName(infant)
                : "Infant " + (i + 1) + " (15 days to 2 yrs)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('infant', i)">
                {{ infant.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('infant', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('infant', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="infant.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'infant-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'infant-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="infant.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'infant-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'infant-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="infant.gender === 'Male'"
                      (click)="infant.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="infant.gender === 'Female'"
                      (click)="infant.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'infant-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(infant)" [minDate]="getInfantMinDOB()"
                      [maxDate]="getInfantMaxDOB()" [initialDate]="getInfantMaxDOB()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(infant, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'infant-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="infant.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'infant-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'infant-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('infant', i, infant)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Important Note -->
      <div class="passenger-important-note">
        <strong>Important:</strong> Enter name as mentioned on your passport or Government approved IDs.
      </div>
    </div>

    <!-- Continue to unlock addons (shows only after passengers filled) -->
    <div class="card desktop-only" *ngIf="addonUnlockStep === 0">
      <button class="continue-btn-main" (click)="onAddonContinue()">
        {{ getAddonContinueText() }}
      </button>
    </div>

    <!-- Addon Services Section - Desktop Only (Oneway) -->
    <div class="card addon-services-card desktop-only">
      <div class="addon-services-header">
        <div class="addon-header-left">
          <div class="addon-title">Addon Services</div>
          <div class="addon-subtext">Seats & Meals Â· Cabs Â· Add ons</div>
        </div>
      </div>

      <!-- Seats & Meals Section -->
      <div class="addon-section" [class.expanded]="isSeatsExpanded" [class.locked]="addonUnlockStep < 1">
        <div class="addon-section-header" (click)="toggleSeatsSection()">
          <div class="addon-section-title">
            <i class="fas fa-chair"></i>
            <span>Seats & Meals</span>
          </div>
          <i class="fas fa-chevron-down addon-chevron" [class.rotated]="isSeatsExpanded"></i>
        </div>
        <div class="addon-section-content seats-meals-content" *ngIf="isSeatsExpanded">
          <!-- Seats & Meals Tabs -->
          <div class="seats-meals-tabs">
            <div class="tab-header" [class.active]="activeSeatsTab === 'seats'"
              (click)="activeSeatsTab = 'seats'; $event.stopPropagation()">
              <i class="fas fa-chair"></i>
              <span>Seats</span>
            </div>
            <div class="tab-header" [class.active]="activeSeatsTab === 'meals'"
              (click)="activeSeatsTab = 'meals'; $event.stopPropagation()">
              <i class="fas fa-utensils"></i>
              <span>Meals</span>
            </div>
          </div>

          <!-- Seats Tab Content -->
          <div class="tab-content-panel" *ngIf="activeSeatsTab === 'seats'">
            <!-- Promo Banner -->
            <div class="promo-banner">
              <i class="fas fa-ticket-alt"></i>
              <span>Use code <strong>FREESEAT</strong> to get a free seat (up to 500/passenger)</span>
            </div>

            <!-- Flight Route Info -->
            <div class="flight-route-info" *ngFor="let segment of flightSegments; let segIndex = index">
              <div class="route-header-inline">
                <div class="route-title-inline">
                  <strong>{{ segment.from }} â†’ {{ segment.to }}</strong>
                </div>
                <div class="selection-status">
                  <span class="seats-selected">{{ getSelectedSeatsCount(segIndex) }} of {{ getTotalPassengers() }}
                    Seat(s) Selected</span>
                  <span class="status-badge" [class.pending]="getSelectedSeatsCount(segIndex) < getTotalPassengers()"
                    [class.complete]="getSelectedSeatsCount(segIndex) === getTotalPassengers()">
                    {{ getSelectedSeatsCount(segIndex) === getTotalPassengers() ? 'Selection complete' : 'Selection
                    pending' }}
                  </span>
                </div>
              </div>

              <!-- Seat Map -->
              <div class="seat-map-container"
                *ngIf="seatMap && seatMap[segIndex] && seatMap[segIndex].rows?.length > 0">
                <div class="seat-map-scroll">
                  <div class="seat-map">
                    <!-- Seat Legend -->
                    <div class="seat-legend">
                      <div class="legend-item">
                        <div class="seat-icon free"></div>
                        <span>Free</span>
                      </div>
                      <div class="legend-item" *ngFor="let category of seatMap[segIndex].priceCategories">
                        <div class="seat-icon" [ngClass]="category.category"></div>
                        <span>{{ category.category === 'low-price' ? 'Low' : category.category === 'medium-price' ?
                          'Medium' : 'High' }}</span>
                        <span *ngIf="category.min !== 0 || category.max !== 0">
                          (â‚¹{{ category.min | number : '1.0-0' }} - â‚¹{{ category.max | number : '1.0-0' }})
                        </span>
                      </div>
                      <div class="legend-item">
                        <div class="seat-icon not-available"></div>
                        <span>Not Available</span>
                      </div>
                    </div>

                    <!-- Seat Grid with Dynamic Blocks -->
                    <div class="seat-grid-dynamic">
                      <!-- Column Headers -->
                      <div class="seat-row-dynamic header-row">
                        <div class="row-label-header">Row</div>
                        <ng-container *ngFor="let block of seatMap[segIndex].seatBlocks; let blockIndex = index">
                          <div class="seat-block-header-group">
                            <div class="cell-header" *ngFor="let letter of block">{{ letter }}</div>
                          </div>
                          <div class="aisle-divider-header"
                            *ngIf="blockIndex < seatMap[segIndex].seatBlocks.length - 1"></div>
                        </ng-container>
                      </div>

                      <!-- Seat Rows -->
                      <div class="seat-row-dynamic" *ngFor="let row of seatMap[segIndex].rows">
                        <div class="row-label">{{ row.rowNo }}</div>
                        <ng-container *ngFor="let block of row.seatBlocks; let blockIndex = index">
                          <div class="seat-block-group">
                            <div class="seat-cell" *ngFor="let letter of seatMap[segIndex].seatBlocks[blockIndex]"
                              [ngClass]="{
                                   'disabled': !block[letter],
                                   'not-available': block[letter] && !block[letter].isAvailable,
                                   'free': block[letter]?.isAvailable && block[letter].priceCategory === 'free',
                                   'low-price': block[letter]?.isAvailable && block[letter].priceCategory === 'low-price',
                                   'medium-price': block[letter]?.isAvailable && block[letter].priceCategory === 'medium-price',
                                   'high-price': block[letter]?.isAvailable && block[letter].priceCategory === 'high-price',
                                   'selected': block[letter] && isSeatSelected(segIndex, block[letter]?.Code)
                                 }"
                              (click)="block[letter]?.isAvailable && toggleSeatSelectionAPI(segIndex, block[letter])"
                              [title]="block[letter] ? getSeatTooltip(block[letter]) : ''">
                              <ng-container *ngIf="block[letter]; else noSeat">
                                <ng-container *ngIf="block[letter].priceCategory === 'free'; else showPrice">
                                  Free
                                </ng-container>
                                <ng-template #showPrice>
                                  {{ block[letter].Price | number : '1.0-0' }}
                                </ng-template>
                              </ng-container>
                              <ng-template #noSeat>-</ng-template>
                            </div>
                          </div>
                          <div class="aisle-divider" *ngIf="blockIndex < row.seatBlocks.length - 1"></div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Seat Map Available -->
              <div class="no-seats-message"
                *ngIf="!seatMap || !seatMap[segIndex] || !seatMap[segIndex].rows || seatMap[segIndex].rows.length === 0">
                <p>Seat selection not available for this flight segment.</p>
              </div>
            </div>
          </div>

          <!-- Meals Tab Content -->
          <div class="tab-content-panel" *ngIf="activeSeatsTab === 'meals'">
            <div class="meals-container">
              <!-- Meal Segments -->
              <div class="meal-segment-wrapper" *ngFor="let segment of flightSegments; let segIndex = index">
                <div class="meal-segment-header">
                  <strong>{{ segment.from }} â†’ {{ segment.to }}</strong>
                  <span class="meal-selection-count">{{ getMealCount(segIndex) }} meal(s) selected</span>
                </div>

                <div class="meal-scroll-container" *ngIf="segment?.mealOptions?.length; else noMeals">
                  <div class="meal-list">
                    <div class="meal-card" *ngFor="let meal of segment.mealOptions">
                      <div class="meal-visual">
                        <img class="meal-image" src="../../assets/images/meals/chicken.png" alt="Meal" />
                        <div class="meal-price" *ngIf="meal.Price > 0">
                          â‚¹{{ meal.Price | number : '1.2-2' }}
                        </div>
                        <div class="meal-price free-meal" *ngIf="meal.Price == 0">
                          Free
                        </div>
                      </div>
                      <div class="meal-details">
                        <div class="meal-name">
                          {{ meal.AirlineDescription || meal.Description }}
                        </div>
                      </div>
                      <div class="meal-quantity">
                        <button [disabled]="getMealCountForMeal(segIndex, meal.Code) === 0"
                          (click)="decrementMeal(segIndex, meal)">
                          -
                        </button>
                        <span>{{ getMealCountForMeal(segIndex, meal.Code) }}</span>
                        <button [disabled]="getTotalSelectedMeals(segIndex) >= getTotalPassengers()"
                          (click)="incrementMeal(segIndex, meal)">
                          +
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <ng-template #noMeals>
                  <div class="no-meals-message">
                    <p>No meals available for this segment.</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Inline continue inside Seats & Meals -->
          <div class="addon-continue-footer">
            <button class="addon-continue-btn" (click)="onAddonContinue()">CONTINUE TO CABS</button>
          </div>
        </div>
      </div>

      <!-- Cabs Section -->
      <div class="addon-section" [class.expanded]="isCabsExpanded" [class.locked]="addonUnlockStep < 2">
        <div class="addon-section-header" (click)="toggleCabsSection()">
          <div class="addon-section-title">
            <i class="fas fa-car"></i>
            <span>Cabs</span>
          </div>
          <i class="fas fa-chevron-down addon-chevron" [class.rotated]="isCabsExpanded"></i>
        </div>
        <div class="addon-section-content" *ngIf="isCabsExpanded">
          <div class="addon-placeholder">
            <p>Cab services are not available for this journey.</p>
          </div>
        </div>

        <div class="addon-continue-footer" *ngIf="isCabsExpanded">
          <button class="addon-continue-btn" (click)="onAddonContinue()">CONTINUE TO ADD ONS</button>
        </div>
      </div>

      <!-- Add-ons Section (Special Services) -->
      <div class="addon-section" [class.expanded]="isAddonsExpanded" [class.locked]="addonUnlockStep < 3">
        <div class="addon-section-header" (click)="toggleAddonsSection()">
          <div class="addon-section-title">
            <i class="fas fa-plus-circle"></i>
            <span>Add ons</span>
            <span class="addon-subtitle">Flight Delay Insurance, Baggage Courier Service</span>
          </div>
          <i class="fas fa-chevron-down addon-chevron" [class.rotated]="isAddonsExpanded"></i>
        </div>
        <div class="addon-section-content services-content" *ngIf="isAddonsExpanded">
          <div class="services-selection" *ngIf="services?.length; else noServices">
            <div class="services-scroll-container">
              <div class="services-list">
                <div class="service-card" *ngFor="let service of getFilteredServices()">
                  <div class="service-visual">
                    <img class="service-image" src="../../assets/images/meals/special.jpg" alt="Service" />
                    <div class="service-price">
                      â‚¹{{ service.Price | number : '1.2-2' }}
                    </div>
                  </div>
                  <div class="service-details">
                    <div class="service-name">
                      {{ service.Description }}
                    </div>
                    <div class="service-route">
                      {{ service.Origin }} - {{ service.Destination }}
                    </div>
                  </div>
                  <div class="service-actions">
                    <button class="service-remove-btn" *ngIf="getServiceCount(service.Code, service) > 0"
                      (click)="removeService(service)">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button class="service-add-btn" [disabled]="getServiceCount(service.Code, service) >= 1"
                      (click)="addService(service)">
                      <i class="fas fa-plus"></i>
                      <span *ngIf="getServiceCount(service.Code, service) === 0">ADD</span>
                      <span *ngIf="getServiceCount(service.Code, service) > 0">ADDED</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noServices>
            <div class="addon-placeholder">
              <p>No additional services available for this journey.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Baggage Section - Mobile Only -->
    <div class="card mobile-baggage-section oneway-baggage-section oneway-mobile-baggage">
      <div class="section-title">Baggage Allowance</div>
      <div class="mobile-baggage-content">
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <span class="baggage-text">Cabin Baggage: <strong>{{ flightSegments[0]?.cabin || '7 KG' }}</strong> /
            Adult</span>
        </div>

        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <span class="baggage-text">Check-In Baggage: <strong>{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece
              only)' }}</strong> / Adult</span>
        </div>
      </div>
      <div class="mobile-add-baggage oneway-add-baggage oneway-mobile-add-baggage"
        *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="mobile-add-baggage-content">
          <span class="add-baggage-icon">ðŸŽ’</span>
          <span class="add-baggage-text">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab
            rates!</span>
        </div>
        <button class="mobile-add-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <ng-container *ngFor="let segment of flightDataDeparture?.Segments[0]; let i = index">
        <div class="cancellation-row">
          <div class="flight-airline">
            <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'" class="logo" />
            <div class="name">{{ segment.Airline.AirlineName }}</div>
            <div class="code">
              {{ segment.Airline.AirlineCode }}
              {{ segment.Airline.FlightNumber }}
            </div>
          </div>
          <div class="criteria">
            <div class="left">Cancellation Criteria</div>
            <div class="right">Charges</div>
          </div>
          <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
            <div class="left">{{ row.range }}</div>
            <div class="right">{{ row.price }}</div>
          </div>
        </div>
        <hr class="baggage-divider" *ngIf="i < flightDataDeparture?.Segments[0].length - 1" />
      </ng-container>
    </div>

    <!-- Important Information Card -->
    <div class="card info-card">
      <div class="section-title">
        <i class="fas fa-info-circle"></i>
        Important Information
      </div>

      <!-- Travel Guidelines - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-suitcase-rolling"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Baggage Restrictions
          </div>
          <div class="item-content">
            <ul>
              <li>Maximum 1 check-in baggage + 1 hand baggage per passenger</li>
              <li>Violations may result in additional airline charges</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Boarding Pass - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-mobile-alt"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Digital Boarding Pass
          </div>
          <div class="item-content">
            <ul>
              <li>Available within 6 hours after web check-in completion</li>
              <li>Ensure you complete check-in before flight departure</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Unaccompanied Minors - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-user-shield"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Minor Passengers Policy
          </div>
          <div class="item-content">
            <ul>
              <li>Children under 18 traveling alone require special arrangements</li>
              <li>Contact airline for specific unaccompanied minor policies</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- GST Details Card -->
    <div class="card">
      <div class="section-title">GST - (Optional)</div>
      <div class="passenger-item-wrapper">
        <div class="gst-box" [class.completed]="gstDetails.companyName">
          <div class="icon"><i class="fas fa-building"></i></div>
          <div class="label">
            <span class="gst-label-text">
              {{
              gstDetails.companyName
              ? gstDetails.companyName
              : "Travelling for Business?"
              }}
            </span>
          </div>
          <button class="add-btn light small" (click)="handleGSTClick()">
            {{ gstDetails.companyName ? "CHANGE" : "ADD" }}
          </button>
        </div>
        <!-- Desktop Inline Form -->
        <div class="passenger-inline-form gst-inline-form desktop-only" [class.expanded]="isGSTExpanded">
          <div class="passenger-form-content" *ngIf="isGSTExpanded">
            <div class="gst-note">
              <div class="note-header">
                <i class="fas fa-info-circle"></i>
                <div>NOTE</div>
              </div>
              <div class="note-text">
                This is an optional section. Fill this if you wish to claim GST credit for this booking.
              </div>
            </div>
            <div class="form-group">
              <label>Company Name</label>
              <input type="text" [(ngModel)]="gstDetails.companyName" placeholder="Enter company name" />
            </div>
            <div class="form-group">
              <label>Company Billing Address</label>
              <textarea [(ngModel)]="gstDetails.companyAddress" placeholder="Enter billing address" rows="3"></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Company Phone Number</label>
                <input type="tel" [(ngModel)]="gstDetails.companyPhone" placeholder="Enter phone number" />
              </div>
              <div class="form-group">
                <label>Company Email Address</label>
                <input type="email" [(ngModel)]="gstDetails.companyEmail" placeholder="Enter email address" />
              </div>
            </div>
            <div class="form-group">
              <label>GST Number</label>
              <input type="text" [(ngModel)]="gstDetails.gstNumber" placeholder="Enter GST number" />
            </div>
            <div class="form-actions">
              <button class="save-btn" (click)="saveGSTDetails()">DONE</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Terms and Conditions Card -->
    <div class="card">
      <div class="terms-section">
        <label class="terms-checkbox">
          <input type="checkbox" [(ngModel)]="termsAgreed" />
          <span class="checkmark"></span>
          <span class="terms-text">
            I understand and agree with the
            <span class="link-text" (click)="showFareRules = true">Fare Rules</span>, the
            <a class="link-text" href="https://wizzride.com/cancellationpolicy/privacypolicy" target="_blank"
              rel="noopener noreferrer">
              Privacy Policy</a>, the
            <a class="link-text" href="https://wizzride.com/cancellationpolicy/useragreement" target="_blank"
              rel="noopener noreferrer">
              User Agreement</a>
            & the Terms of Service of Wizzride.
          </span>
        </label>
      </div>
    </div>

    <!-- Price Footer -->
    <div class="footer-bar">
      <!-- Desktop Fare Summary -->
      <div class="fare-summary-desktop">
        <div class="fare-summary-title">Fare Summary</div>

        <!-- Base Fare Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleBaseFare()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Base Fare</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalBaseFare) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaseFareExpanded">
            <div class="fare-accordion-detail" *ngIf="totalAdults > 0">
              <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalChildren > 0">
              <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalInfants > 0">
              <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
            </div>
          </div>
        </div>

        <!-- Taxes & Surcharges Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleTaxes()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Taxes and Surcharges</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalTaxes) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isTaxesExpanded">
            <div class="fare-accordion-detail">
              <span>Airline Taxes and Surcharges</span>
            </div>
          </div>
        </div>

        <!-- Other Services Accordion (if baggage exists) -->
        <div class="fare-accordion-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
          <div class="fare-accordion-header" (click)="toggleBaggage()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Other Services</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaggageExpanded">
            <div class="fare-accordion-detail">
              <span>Extra Baggage</span>
            </div>
          </div>
        </div>

        <!-- Add-ons Accordion (Seats, Meals, Services) -->
        <div class="fare-accordion-item" *ngIf="getTotalAddonCharges() > 0">
          <div class="fare-accordion-header" (click)="toggleAddonsAccordion()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isAddonsAccordionExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Add-ons</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(getTotalAddonCharges()) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isAddonsAccordionExpanded">
            <div class="fare-accordion-detail" *ngIf="getTotalSeatCharges() > 0">
              <span>Seats ({{ formatCurrency(getTotalSeatCharges()) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="getTotalMealCharges() > 0">
              <span>Meals ({{ formatCurrency(getTotalMealCharges()) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="getTotalServiceCharges() > 0">
              <span>Special Services ({{ formatCurrency(getTotalServiceCharges()) }})</span>
            </div>
          </div>
        </div>

        <hr class="fare-summary-divider" />

        <!-- Total Amount -->
        <div class="fare-total-amount">
          <span class="fare-total-label">Total Amount</span>
          <span class="fare-total-value">{{ formatCurrency(getTotalAmountWithAddons()) }}</span>
        </div>
      </div>

      <!-- Mobile Price Display (Clickable) -->
      <div class="mobile-price-bar" (click)="openMobileFareBreakdown()">
        <div class="mobile-price-info">
          <span class="mobile-price-label">Total Price</span>
          <span class="mobile-price-amount">{{ formatCurrency(getTotalAmountWithAddons()) }}</span>
        </div>
      </div>

      <button class="proceed-btn" (click)="finalProceed()">
        Proceed
      </button>
    </div>
  </div>

  <!-- Roundtrip -->
  <div class="flight-final-page" *ngIf="tripType == 'roundtrip'">
    <!-- Flight Summary Card -->
    <div class="card flight-summary-wrapper makemytrip-flight-card">
      <div class="flight-cards-container">
        <!-- Onward Flight Card -->
        <div class="flight-card-item" *ngIf="flightSegments?.length">
          <div class="card">
            <div class="flight-leg roundtrip-flight-leg roundtrip-onward-flight-leg">
              <!-- Route Header with Date -->
              <div class="route-header roundtrip-route-header" *ngIf="flightSegments[0]">
                <div class="route-info">
                  <div class="route-title">
                    {{ flightSegments[0].from }} <span>â†’</span> {{ flightSegments[flightSegments.length - 1].to }}
                  </div>
                  <div class="date-time-section">
                    <span class="date-badge">{{ flightSegments[0].date | date : "EEEE, MMM dd" }}</span>
                  </div>
                </div>
                <div class="cancellation-badge"
                  *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
                  CANCELLATION FEES APPLY
                </div>
              </div>
              <div *ngFor="let segment of flightSegments; let i = index">
                <!-- Flight Details -->
                <div class="flight-details-section">
                  <!-- Airline Info -->
                  <div class="airline-info-row">
                    <div class="airline-left">
                      <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                        {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                      </div>
                      <img [src]="segment.logo" class="airline-logo-img"
                        *ngIf="segment.logo && !segment.logo.includes('default')" />
                      <div class="airline-details">
                        <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                        <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                      </div>
                    </div>
                    <div class="fare-info">
                      <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass
                        }}</span>
                    </div>
                  </div>

                  <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare
                    Rules</a>

                  <!-- Flight Timeline -->
                  <div class="flight-timeline-grid">
                    <div class="timeline-item">
                      <div class="time">{{ segment.departureTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.from }}</div>
                        <div class="airport-name">{{ segment.fromAirport || segment.from + ', Terminal N/A' }}</div>
                        <div class="duration">{{ segment.duration }}</div>
                      </div>
                    </div>

                    <div class="timeline-item">
                      <div class="time">{{ segment.arrivalTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.to }}</div>
                        <div class="airport-name">{{ segment.toAirport || segment.to + ', Terminal N/A' }}</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Layover if applicable -->
                <div class="layover-row" *ngIf="i < flightSegments.length - 1 && segment.layover">
                  <div class="line"></div>
                  <div class="layover">
                    <div *ngIf="segment.layover.hours >= 24" class="plus-day">+ 1 Day</div>
                    {{ segment.layover.duration }} Layover in {{ segment.layover.location }}
                  </div>
                  <div class="line"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Return Flight Card -->
        <div class="flight-card-item" *ngIf="flightSegmentsReturn?.length">
          <div class="card">
            <div class="flight-leg roundtrip-flight-leg roundtrip-return-flight-leg">
              <!-- Route Header with Date -->
              <div class="route-header roundtrip-route-header" *ngIf="flightSegmentsReturn[0]">
                <div class="route-info">
                  <div class="route-title">
                    {{ flightSegmentsReturn[0].from }} <span>â†’</span> {{
                    flightSegmentsReturn[flightSegmentsReturn.length - 1].to }}
                  </div>
                  <div class="date-time-section">
                    <span class="date-badge">{{ flightSegmentsReturn[0].date | date : "EEEE, MMM dd" }}</span>
                  </div>
                </div>
                <div class="cancellation-badge"
                  *ngIf="flightDataReturn && getCancellationRows(flightDataReturn).length > 0">
                  CANCELLATION FEES APPLY
                </div>
              </div>
              <div *ngFor="let segment of flightSegmentsReturn; let i = index">
                <!-- Flight Details -->
                <div class="flight-details-section">
                  <!-- Airline Info -->
                  <div class="airline-info-row">
                    <div class="airline-left">
                      <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                        {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                      </div>
                      <img [src]="segment.logo" class="airline-logo-img"
                        *ngIf="segment.logo && !segment.logo.includes('default')" />
                      <div class="airline-details">
                        <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                        <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                      </div>
                    </div>
                    <div class="fare-info">
                      <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass
                        }}</span>
                    </div>
                  </div>

                  <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare
                    Rules</a>

                  <!-- Flight Timeline -->
                  <div class="flight-timeline-grid">
                    <div class="timeline-item">
                      <div class="time">{{ segment.departureTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.from }}</div>
                        <div class="airport-name">{{ segment.fromAirport || segment.from + ', Terminal N/A' }}</div>
                        <div class="duration">{{ segment.duration }}</div>
                      </div>
                    </div>

                    <div class="timeline-item">
                      <div class="time">{{ segment.arrivalTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.to }}</div>
                        <div class="airport-name">{{ segment.toAirport || segment.to + ', Terminal N/A' }}</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Layover if applicable -->
                <div class="layover-row" *ngIf="i < flightSegmentsReturn.length - 1 && segment.layover">
                  <div class="line"></div>
                  <div class="layover">
                    <div *ngIf="segment.layover.hours >= 24" class="plus-day">+ 1 Day</div>
                    {{ segment.layover.duration }} Layover in {{ segment.layover.location }}
                  </div>
                  <div class="line"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Baggage Allowance Section - Desktop Only (Onward) -->
      <div class="makemytrip-baggage-section roundtrip-baggage-section roundtrip-desktop-baggage baggage-info"
        *ngIf="flightSegments?.length">
        <div class="baggage-allowance-item baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <div class="baggage-label baggage-text">
            <span>Cabin Baggage: </span>
            <span class="baggage-weight">{{ flightSegments[0]?.cabin || '7 KG' }}</span>
            <span> / Adult</span>
          </div>
        </div>
        <div class="baggage-allowance-item baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <div class="baggage-label baggage-text">
            <span>Check-In Baggage: </span>
            <span class="baggage-weight">{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece only)' }}</span>
            <span> / Adult</span>
          </div>
        </div>
      </div>

      <!-- Add Baggage CTA - Desktop Only -->
      <div class="extra-baggage-banner" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="baggage-banner-text">
          <span class="baggage-emoji">ðŸŽ’</span>
          <span>Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
        </div>
        <button class="change-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>

      <!-- Cancellation Policy Section with Tabs - Desktop Only -->
      <div class="makemytrip-cancellation-section roundtrip-cancellation-tabs"
        *ngIf="(flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0) || (flightDataReturn && getCancellationRows(flightDataReturn).length > 0)">
        <div class="cancellation-header">
          <div class="cancellation-title">Cancellation & Date Change Policy</div>
        </div>

        <!-- Onward / Return Tabs -->
        <div class="cancellation-tab-headers">
          <div class="cancellation-tab-header" [class.active]="activePolicyTab === 'onward'"
            (click)="activePolicyTab = 'onward'">
            Onward
          </div>
          <div class="cancellation-tab-header" [class.active]="activePolicyTab === 'return'"
            (click)="activePolicyTab = 'return'">
            Return
          </div>
        </div>

        <!-- Onward Tab Content -->
        <div class="cancellation-tab-content" *ngIf="activePolicyTab === 'onward' && flightDataDeparture">
          <div class="cancellation-airline" *ngIf="flightDataDeparture?.Segments?.[0]?.[0]">
            <img
              [src]="'assets/images/flightimages/' + flightDataDeparture.Segments[0][0].Airline?.AirlineCode + '.png'"
              class="logo" />
            <span class="airline-route">{{ flightDataDeparture.Segments[0][0].Origin?.Airport?.CityCode }}-{{
              flightDataDeparture.Segments[0][flightDataDeparture.Segments[0].length -
              1]?.Destination?.Airport?.CityCode }}</span>
          </div>
          <div class="cancellation-criteria-header">
            <div class="criteria-left">Cancellation Criteria</div>
            <div class="criteria-right">Charges</div>
          </div>
          <div class="cancellation-rows">
            <div class="cancellation-row-item" *ngFor="let row of getCancellationRows(flightDataDeparture)">
              <div class="criteria-left">{{ row.range }}</div>
              <div class="criteria-right">{{ row.price }}</div>
            </div>
          </div>
        </div>

        <!-- Return Tab Content -->
        <div class="cancellation-tab-content" *ngIf="activePolicyTab === 'return' && flightDataReturn">
          <div class="cancellation-airline" *ngIf="flightDataReturn?.Segments?.[0]?.[0]">
            <img [src]="'assets/images/flightimages/' + flightDataReturn.Segments[0][0].Airline?.AirlineCode + '.png'"
              class="logo" />
            <span class="airline-route">{{ flightDataReturn.Segments[0][0].Origin?.Airport?.CityCode }}-{{
              flightDataReturn.Segments[0][flightDataReturn.Segments[0].length - 1]?.Destination?.Airport?.CityCode
              }}</span>
          </div>
          <div class="cancellation-criteria-header">
            <div class="criteria-left">Cancellation Criteria</div>
            <div class="criteria-right">Charges</div>
          </div>
          <div class="cancellation-rows">
            <div class="cancellation-row-item" *ngFor="let row of getCancellationRows(flightDataReturn)">
              <div class="criteria-left">{{ row.range }}</div>
              <div class="criteria-right">{{ row.price }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Passenger Card -->
    <div class="card">
      <div class="section-title">Add Passenger Details</div>

      <!-- Adults Section -->
      <div class="passenger-section">
        <div class="passenger-category-header">
          <span class="passenger-category-title">ADULTS (12+ YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(adults) }}/{{ adults.length }} added</span>
        </div>
        <ng-container *ngFor="let adult of adults; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="adult.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!adult.firstName"></i>
                <i class="fas fa-check" *ngIf="adult.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                adult.firstName
                ? getPassengerDisplayName(adult)
                : "Adult " + (i + 1) + " (12 yrs+)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('adult', i)">
                {{ adult.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('adult', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('adult', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="adult.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="adult.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Male'"
                      (click)="adult.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Female'"
                      (click)="adult.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row form-row-three">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(adult)" [minDate]="getAdultMinDOB()"
                      [maxDate]="getTodayDate()" [initialDate]="getTodayDate()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(adult, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'adult-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                  <div class="form-group form-group-small">
                    <label>Country Code</label>
                    <select class="dial-select" [(ngModel)]="adult.mobileDialCode">
                      <option value="+91">IN +91</option>
                      <option value="+1">US +1</option>
                      <option value="+44">UK +44</option>
                      <option value="+971">AE +971</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Mobile No</label>
                    <input type="tel" [(ngModel)]="adult.mobileNumber" placeholder="Mobile No" maxlength="10"
                      [class.error]="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.mobileNumber }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" [(ngModel)]="adult.email" placeholder="Email"
                    [class.error]="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.email }}</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="adult.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="adult.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="adult.panNumber" placeholder="Enter PAN number"
                    [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('adult', i, adult)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Children Section -->
      <div class="passenger-section" *ngIf="children.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">CHILDREN (2-12 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(children) }}/{{ children.length }} added</span>
        </div>
        <ng-container *ngFor="let child of children; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="child.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!child.firstName"></i>
                <i class="fas fa-check" *ngIf="child.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                child.firstName
                ? getPassengerDisplayName(child)
                : "Child " + (i + 1) + " (2 to 12 yrs)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('child', i)">
                {{ child.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('child', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('child', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="child.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'child-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'child-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="child.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'child-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'child-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="child.gender === 'Male'"
                      (click)="child.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="child.gender === 'Female'"
                      (click)="child.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(child)" [minDate]="getChildMinDOB()"
                      [maxDate]="getChildMaxDOB()" [initialDate]="getChildMaxDOB()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(child, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'child-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="child.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="child.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'child-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="child.panNumber" placeholder="Enter PAN number"
                    [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'child-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('child', i, child)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Infants Section -->
      <div class="passenger-section" *ngIf="infants.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">INFANTS (0-2 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(infants) }}/{{ infants.length }} added</span>
        </div>
        <ng-container *ngFor="let infant of infants; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="infant.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!infant.firstName"></i>
                <i class="fas fa-check" *ngIf="infant.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                infant.firstName
                ? getPassengerDisplayName(infant)
                : "Infant " + (i + 1) + " (15 days to 2 yrs)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('infant', i)">
                {{ infant.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('infant', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('infant', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="infant.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'infant-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'infant-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="infant.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'infant-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'infant-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="infant.gender === 'Male'"
                      (click)="infant.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="infant.gender === 'Female'"
                      (click)="infant.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'infant-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(infant)" [minDate]="getInfantMinDOB()"
                      [maxDate]="getInfantMaxDOB()" [initialDate]="getInfantMaxDOB()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(infant, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'infant-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="infant.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'infant-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'infant-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('infant', i, infant)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Important Note -->
      <div class="passenger-important-note">
        <strong>Important:</strong> Enter name as mentioned on your passport or Government approved IDs.
      </div>
    </div>

    <!-- Continue to unlock addons (shows only after passengers filled) -->
    <div class="card desktop-only" *ngIf="addonUnlockStep === 0">
      <button class="continue-btn-main" (click)="onAddonContinue()">
        {{ getAddonContinueText() }}
      </button>
    </div>

    <!-- Addon Services Section - Desktop Only (Roundtrip) -->
    <div class="card addon-services-card desktop-only">
      <div class="addon-services-header">
        <div class="addon-header-left">
          <div class="addon-title">Addon Services</div>
          <div class="addon-subtext">Seats & Meals Â· Cabs Â· Add ons</div>
        </div>
      </div>

      <!-- Seats & Meals Section -->
      <div class="addon-section" [class.expanded]="isSeatsExpanded" [class.locked]="addonUnlockStep < 1">
        <div class="addon-section-header" (click)="toggleSeatsSection()">
          <div class="addon-section-title">
            <i class="fas fa-chair"></i>
            <span>Seats & Meals</span>
          </div>
          <i class="fas fa-chevron-down addon-chevron" [class.rotated]="isSeatsExpanded"></i>
        </div>
        <div class="addon-section-content seats-meals-content" *ngIf="isSeatsExpanded">
          <!-- Seats & Meals Tabs -->
          <div class="seats-meals-tabs">
            <div class="tab-header" [class.active]="activeSeatsTab === 'seats'"
              (click)="activeSeatsTab = 'seats'; $event.stopPropagation()">
              <i class="fas fa-chair"></i>
              <span>Seats</span>
            </div>
            <div class="tab-header" [class.active]="activeSeatsTab === 'meals'"
              (click)="activeSeatsTab = 'meals'; $event.stopPropagation()">
              <i class="fas fa-utensils"></i>
              <span>Meals</span>
            </div>
          </div>

          <!-- Seats Tab Content -->
          <div class="tab-content-panel" *ngIf="activeSeatsTab === 'seats'">
            <!-- Promo Banner -->
            <div class="promo-banner">
              <i class="fas fa-ticket-alt"></i>
              <span>Use code <strong>FREESEAT</strong> to get a free seat (up to 500/passenger)</span>
            </div>

            <!-- Flight Route Info -->
            <div class="flight-route-info" *ngFor="let segment of flightSegments; let segIndex = index">
              <div class="route-header-inline">
                <div class="route-title-inline">
                  <strong>{{ segment.from }} â†’ {{ segment.to }}</strong>
                </div>
                <div class="selection-status">
                  <span class="seats-selected">{{ getSelectedSeatsCount(segIndex) }} of {{ getTotalPassengers() }}
                    Seat(s) Selected</span>
                  <span class="status-badge" [class.pending]="getSelectedSeatsCount(segIndex) < getTotalPassengers()"
                    [class.complete]="getSelectedSeatsCount(segIndex) === getTotalPassengers()">
                    {{ getSelectedSeatsCount(segIndex) === getTotalPassengers() ? 'Selection complete' : 'Selection
                    pending' }}
                  </span>
                </div>
              </div>

              <!-- Seat Map -->
              <div class="seat-map-container"
                *ngIf="seatMap && seatMap[segIndex] && seatMap[segIndex].rows?.length > 0">
                <div class="seat-map-scroll">
                  <div class="seat-map">
                    <!-- Seat Legend -->
                    <div class="seat-legend">
                      <div class="legend-item">
                        <div class="seat-icon free"></div>
                        <span>Free</span>
                      </div>
                      <div class="legend-item" *ngFor="let category of seatMap[segIndex].priceCategories">
                        <div class="seat-icon" [ngClass]="category.category"></div>
                        <span>{{ category.category === 'low-price' ? 'Low' : category.category === 'medium-price' ?
                          'Medium' : 'High' }}</span>
                        <span *ngIf="category.min !== 0 || category.max !== 0">
                          (â‚¹{{ category.min | number : '1.0-0' }} - â‚¹{{ category.max | number : '1.0-0' }})
                        </span>
                      </div>
                      <div class="legend-item">
                        <div class="seat-icon not-available"></div>
                        <span>Not Available</span>
                      </div>
                    </div>

                    <!-- Seat Grid with Dynamic Blocks -->
                    <div class="seat-grid-dynamic">
                      <!-- Column Headers -->
                      <div class="seat-row-dynamic header-row">
                        <div class="row-label-header">Row</div>
                        <ng-container *ngFor="let block of seatMap[segIndex].seatBlocks; let blockIndex = index">
                          <div class="seat-block-header-group">
                            <div class="cell-header" *ngFor="let letter of block">{{ letter }}</div>
                          </div>
                          <div class="aisle-divider-header"
                            *ngIf="blockIndex < seatMap[segIndex].seatBlocks.length - 1"></div>
                        </ng-container>
                      </div>

                      <!-- Seat Rows -->
                      <div class="seat-row-dynamic" *ngFor="let row of seatMap[segIndex].rows">
                        <div class="row-label">{{ row.rowNo }}</div>
                        <ng-container *ngFor="let block of row.seatBlocks; let blockIndex = index">
                          <div class="seat-block-group">
                            <div class="seat-cell" *ngFor="let letter of seatMap[segIndex].seatBlocks[blockIndex]"
                              [ngClass]="{
                                   'disabled': !block[letter],
                                   'not-available': block[letter] && !block[letter].isAvailable,
                                   'free': block[letter]?.isAvailable && block[letter].priceCategory === 'free',
                                   'low-price': block[letter]?.isAvailable && block[letter].priceCategory === 'low-price',
                                   'medium-price': block[letter]?.isAvailable && block[letter].priceCategory === 'medium-price',
                                   'high-price': block[letter]?.isAvailable && block[letter].priceCategory === 'high-price',
                                   'selected': block[letter] && isSeatSelected(segIndex, block[letter]?.Code)
                                 }"
                              (click)="block[letter]?.isAvailable && toggleSeatSelectionAPI(segIndex, block[letter])"
                              [title]="block[letter] ? getSeatTooltip(block[letter]) : ''">
                              <ng-container *ngIf="block[letter]; else noSeat">
                                <ng-container *ngIf="block[letter].priceCategory === 'free'; else showPrice">
                                  Free
                                </ng-container>
                                <ng-template #showPrice>
                                  {{ block[letter].Price | number : '1.0-0' }}
                                </ng-template>
                              </ng-container>
                              <ng-template #noSeat>-</ng-template>
                            </div>
                          </div>
                          <div class="aisle-divider" *ngIf="blockIndex < row.seatBlocks.length - 1"></div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Seat Map Available -->
              <div class="no-seats-message"
                *ngIf="!seatMap || !seatMap[segIndex] || !seatMap[segIndex].rows || seatMap[segIndex].rows.length === 0">
                <p>Seat selection not available for this flight segment.</p>
              </div>
            </div>
          </div>

          <!-- Meals Tab Content -->
          <div class="tab-content-panel" *ngIf="activeSeatsTab === 'meals'">
            <div class="meals-container">
              <!-- Meal Segments -->
              <div class="meal-segment-wrapper" *ngFor="let segment of flightSegments; let segIndex = index">
                <div class="meal-segment-header">
                  <strong>{{ segment.from }} â†’ {{ segment.to }}</strong>
                  <span class="meal-selection-count">{{ getMealCount(segIndex) }} meal(s) selected</span>
                </div>

                <div class="meal-scroll-container" *ngIf="segment?.mealOptions?.length; else noMeals">
                  <div class="meal-list">
                    <div class="meal-card" *ngFor="let meal of segment.mealOptions">
                      <div class="meal-visual">
                        <img class="meal-image" src="../../assets/images/meals/chicken.png" alt="Meal" />
                        <div class="meal-price" *ngIf="meal.Price > 0">
                          â‚¹{{ meal.Price | number : '1.2-2' }}
                        </div>
                        <div class="meal-price free-meal" *ngIf="meal.Price == 0">
                          Free
                        </div>
                      </div>
                      <div class="meal-details">
                        <div class="meal-name">
                          {{ meal.AirlineDescription || meal.Description }}
                        </div>
                      </div>
                      <div class="meal-quantity">
                        <button [disabled]="getMealCountForMeal(segIndex, meal.Code) === 0"
                          (click)="decrementMeal(segIndex, meal)">
                          -
                        </button>
                        <span>{{ getMealCountForMeal(segIndex, meal.Code) }}</span>
                        <button [disabled]="getTotalSelectedMeals(segIndex) >= getTotalPassengers()"
                          (click)="incrementMeal(segIndex, meal)">
                          +
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <ng-template #noMeals>
                  <div class="no-meals-message">
                    <p>No meals available for this segment.</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Inline continue inside Seats & Meals -->
          <div class="addon-continue-footer">
            <button class="addon-continue-btn" (click)="onAddonContinue()">CONTINUE TO CABS</button>
          </div>
        </div>
      </div>

      <!-- Cabs Section -->
      <div class="addon-section" [class.expanded]="isCabsExpanded" [class.locked]="addonUnlockStep < 2">
        <div class="addon-section-header" (click)="toggleCabsSection()">
          <div class="addon-section-title">
            <i class="fas fa-car"></i>
            <span>Cabs</span>
          </div>
          <i class="fas fa-chevron-down addon-chevron" [class.rotated]="isCabsExpanded"></i>
        </div>
        <div class="addon-section-content" *ngIf="isCabsExpanded">
          <div class="addon-placeholder">
            <p>Cab services are not available for this journey.</p>
          </div>
        </div>

        <div class="addon-continue-footer" *ngIf="isCabsExpanded">
          <button class="addon-continue-btn" (click)="onAddonContinue()">CONTINUE TO ADD ONS</button>
        </div>
      </div>

      <!-- Add-ons Section (Special Services) -->
      <div class="addon-section" [class.expanded]="isAddonsExpanded" [class.locked]="addonUnlockStep < 3">
        <div class="addon-section-header" (click)="toggleAddonsSection()">
          <div class="addon-section-title">
            <i class="fas fa-plus-circle"></i>
            <span>Add ons</span>
            <span class="addon-subtitle">Flight Delay Insurance, Baggage Courier Service</span>
          </div>
          <i class="fas fa-chevron-down addon-chevron" [class.rotated]="isAddonsExpanded"></i>
        </div>
        <div class="addon-section-content services-content" *ngIf="isAddonsExpanded">
          <div class="services-selection" *ngIf="services?.length; else noServices">
            <div class="services-scroll-container">
              <div class="services-list">
                <div class="service-card" *ngFor="let service of getFilteredServices()">
                  <div class="service-visual">
                    <img class="service-image" src="../../assets/images/meals/special.jpg" alt="Service" />
                    <div class="service-price">
                      â‚¹{{ service.Price | number : '1.2-2' }}
                    </div>
                  </div>
                  <div class="service-details">
                    <div class="service-name">
                      {{ service.Description }}
                    </div>
                    <div class="service-route">
                      {{ service.Origin }} - {{ service.Destination }}
                    </div>
                  </div>
                  <div class="service-actions">
                    <button class="service-remove-btn" *ngIf="getServiceCount(service.Code, service) > 0"
                      (click)="removeService(service)">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button class="service-add-btn" [disabled]="getServiceCount(service.Code, service) >= 1"
                      (click)="addService(service)">
                      <i class="fas fa-plus"></i>
                      <span *ngIf="getServiceCount(service.Code, service) === 0">ADD</span>
                      <span *ngIf="getServiceCount(service.Code, service) > 0">ADDED</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noServices>
            <div class="addon-placeholder">
              <p>No additional services available for this journey.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Baggage Section - Mobile Only -->
    <div class="card mobile-baggage-section roundtrip-baggage-section roundtrip-mobile-baggage">
      <div class="section-title">Baggage Allowance</div>
      <div class="mobile-baggage-content">
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <span class="baggage-text">Cabin Baggage: <strong>{{ flightSegments[0]?.cabin || '7 KG' }}</strong> /
            Adult</span>
        </div>
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <span class="baggage-text">Check-In Baggage: <strong>{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece
              only)' }}</strong> / Adult</span>
        </div>
      </div>
      <div class="mobile-add-baggage roundtrip-add-baggage roundtrip-mobile-add-baggage"
        *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="baggage-banner-text">
          <span class="baggage-emoji">ðŸŽ’</span>
          <span>Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
        </div>
        <button class="mobile-add-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <!-- Onward / Return Tabs -->
      <div class="policy-tabs">
        <div [class.active]="activePolicyTab === 'onward'" (click)="activePolicyTab = 'onward'">
          Onward
        </div>
        <div [class.active]="activePolicyTab === 'return'" (click)="activePolicyTab = 'return'">
          Return
        </div>
      </div>

      <!-- Tab Scroll Container -->
      <div class="tab-content-container">
        <div class="tab-content-wrapper" [class.return-active]="activePolicyTab === 'return'">
          <!-- Onward Panel -->
          <div class="tab-panel baggage-margin">
            <ng-container *ngFor="
                let segment of flightDataDeparture?.Segments[0];
                let i = index
              ">
              <div class="cancellation-row">
                <div class="flight-airline">
                  <img [src]="
                      'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'
                    " class="logo" />
                  <div class="name">{{ segment.Airline.AirlineName }}</div>
                  <div class="code">
                    {{ segment.Airline.AirlineCode }}
                    {{ segment.Airline.FlightNumber }}
                  </div>
                </div>
                <div class="criteria">
                  <div class="left">Cancellation Criteria</div>
                  <div class="right">Charges</div>
                </div>
                <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
                  <div class="left">{{ row.range }}</div>
                  <div class="right">{{ row.price }}</div>
                </div>
              </div>
              <hr class="baggage-divider" *ngIf="i < flightDataDeparture?.Segments[0].length - 1" />
            </ng-container>
          </div>

          <!-- Return Panel -->
          <div class="tab-panel baggage-margin">
            <ng-container *ngFor="
                let segment of flightDataReturn?.Segments[0];
                let i = index
              ">
              <div class="cancellation-row">
                <div class="flight-airline">
                  <img [src]="
                      'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'
                    " class="logo" />
                  <div class="name">{{ segment.Airline.AirlineName }}</div>
                  <div class="code">
                    {{ segment.Airline.AirlineCode }}
                    {{ segment.Airline.FlightNumber }}
                  </div>
                </div>
                <div class="criteria">
                  <div class="left">Cancellation Criteria</div>
                  <div class="right">Charges</div>
                </div>
                <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataReturn)">
                  <div class="left">{{ row.range }}</div>
                  <div class="right">{{ row.price }}</div>
                </div>
              </div>
              <hr class="baggage-divider" *ngIf="i < flightDataReturn?.Segments[0].length - 1" />
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- Important Information Card -->
    <div class="card info-card">
      <div class="section-title">
        <i class="fas fa-info-circle"></i>
        Important Information
      </div>

      <!-- Travel Guidelines - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-suitcase-rolling"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Baggage Restrictions
          </div>
          <div class="item-content">
            <ul>
              <li>Maximum 1 check-in baggage + 1 hand baggage per passenger</li>
              <li>Violations may result in additional airline charges</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Boarding Pass - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-mobile-alt"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Digital Boarding Pass
          </div>
          <div class="item-content">
            <ul>
              <li>Available within 6 hours after web check-in completion</li>
              <li>Ensure you complete check-in before flight departure</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Unaccompanied Minors - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-user-shield"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Minor Passengers Policy
          </div>
          <div class="item-content">
            <ul>
              <li>Children under 18 traveling alone require special arrangements</li>
              <li>Contact airline for specific unaccompanied minor policies</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- GST Details Card -->
    <div class="card">
      <div class="section-title">GST - (Optional)</div>
      <div class="passenger-item-wrapper">
        <div class="gst-box" [class.completed]="gstDetails.companyName">
          <div class="icon"><i class="fas fa-building"></i></div>
          <div class="label">
            <span class="gst-label-text">
              {{
              gstDetails.companyName
              ? gstDetails.companyName
              : "Travelling for Business?"
              }}
            </span>
          </div>
          <button class="add-btn light small" (click)="handleGSTClick()">
            {{ gstDetails.companyName ? "CHANGE" : "ADD" }}
          </button>
        </div>
        <!-- Desktop Inline Form -->
        <div class="passenger-inline-form gst-inline-form desktop-only" [class.expanded]="isGSTExpanded">
          <div class="passenger-form-content" *ngIf="isGSTExpanded">
            <div class="gst-note">
              <div class="note-header">
                <i class="fas fa-info-circle"></i>
                <div>NOTE</div>
              </div>
              <div class="note-text">
                This is an optional section. Fill this if you wish to claim GST credit for this booking.
              </div>
            </div>
            <div class="form-group">
              <label>Company Name</label>
              <input type="text" [(ngModel)]="gstDetails.companyName" placeholder="Enter company name" />
            </div>
            <div class="form-group">
              <label>Company Billing Address</label>
              <textarea [(ngModel)]="gstDetails.companyAddress" placeholder="Enter billing address" rows="3"></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Company Phone Number</label>
                <input type="tel" [(ngModel)]="gstDetails.companyPhone" placeholder="Enter phone number" />
              </div>
              <div class="form-group">
                <label>Company Email Address</label>
                <input type="email" [(ngModel)]="gstDetails.companyEmail" placeholder="Enter email address" />
              </div>
            </div>
            <div class="form-group">
              <label>GST Number</label>
              <input type="text" [(ngModel)]="gstDetails.gstNumber" placeholder="Enter GST number" />
            </div>
            <div class="form-actions">
              <button class="save-btn" (click)="saveGSTDetails()">DONE</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Terms and Conditions Card -->
    <div class="card">
      <div class="terms-section">
        <label class="terms-checkbox">
          <input type="checkbox" [(ngModel)]="termsAgreed" />
          <span class="checkmark"></span>
          <span class="terms-text">
            I understand and agree with the
            <span class="link-text" (click)="showFareRules = true">Fare Rules</span>, the Privacy Policy, the User
            Agreement & the Terms of Service of
            Wizzride.
          </span>
        </label>
      </div>
    </div>

    <!-- Price Footer -->
    <div class="footer-bar">
      <!-- Desktop Fare Summary -->
      <div class="fare-summary-desktop">
        <div class="fare-summary-title">Fare Summary</div>

        <!-- Base Fare Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleBaseFare()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Base Fare</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalBaseFare) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaseFareExpanded">
            <div class="fare-accordion-detail" *ngIf="totalAdults > 0">
              <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalChildren > 0">
              <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalInfants > 0">
              <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
            </div>
          </div>
        </div>

        <!-- Taxes & Surcharges Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleTaxes()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Taxes and Surcharges</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalTaxes) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isTaxesExpanded">
            <div class="fare-accordion-detail">
              <span>Airline Taxes and Surcharges</span>
            </div>
          </div>
        </div>

        <!-- Other Services Accordion (if baggage exists) -->
        <div class="fare-accordion-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
          <div class="fare-accordion-header" (click)="toggleBaggage()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Other Services</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaggageExpanded">
            <div class="fare-accordion-detail">
              <span>Extra Baggage</span>
            </div>
          </div>
        </div>

        <!-- Add-ons Accordion (Seats, Meals, Services) -->
        <div class="fare-accordion-item" *ngIf="getTotalAddonCharges() > 0">
          <div class="fare-accordion-header" (click)="toggleAddonsAccordion()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isAddonsAccordionExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Add-ons</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(getTotalAddonCharges()) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isAddonsAccordionExpanded">
            <div class="fare-accordion-detail" *ngIf="getTotalSeatCharges() > 0">
              <span>Seats ({{ formatCurrency(getTotalSeatCharges()) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="getTotalMealCharges() > 0">
              <span>Meals ({{ formatCurrency(getTotalMealCharges()) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="getTotalServiceCharges() > 0">
              <span>Special Services ({{ formatCurrency(getTotalServiceCharges()) }})</span>
            </div>
          </div>
        </div>

        <hr class="fare-summary-divider" />

        <!-- Total Amount -->
        <div class="fare-total-amount">
          <span class="fare-total-label">Total Amount</span>
          <span class="fare-total-value">{{ formatCurrency(getTotalAmountWithAddons()) }}</span>
        </div>
      </div>

      <!-- Mobile Price Display (Clickable) -->
      <div class="mobile-price-bar" (click)="openMobileFareBreakdown()">
        <div class="mobile-price-info">
          <span class="mobile-price-label">Total Price</span>
          <span class="mobile-price-amount">{{ formatCurrency(getTotalAmountWithAddons()) }}</span>
        </div>
      </div>

      <button class="proceed-btn" (click)="finalProceed()">
        Proceed
      </button>
    </div>
  </div>

  <!-- Multi-City -->
  <div class="flight-final-page" *ngIf="tripType == 'multicity'">
    <!-- Flight Summary Card -->
    <!-- Flight Summary Cards: One per segment -->
    <!-- Flight Summary Cards: One per segment group -->
    <ng-container *ngIf="tripType === 'multicity' && flightSegmentGroups?.length">
      <div class="card makemytrip-flight-card" *ngFor="let group of flightSegmentGroups; let groupIndex = index">
        <div class="flight-leg multicity-flight-leg">
          <!-- Route Header with Date -->
          <div class="route-header multicity-route-header" *ngIf="group?.length > 0">
            <div class="route-info">
              <div class="route-title">
                {{ group[0]?.from }} <span>â†’</span> {{ group[group.length - 1]?.to }}
              </div>
              <div class="date-time-section">
                <span class="date-badge">{{ group[0]?.date | date : "EEEE, MMM dd" }}</span>
              </div>
            </div>
            <div class="cancellation-badge"
              *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
              CANCELLATION FEES APPLY
            </div>
          </div>
          <ng-container *ngFor="let segment of group; let i = index">
            <!-- Flight Details -->
            <div class="flight-details-section">
              <!-- Airline Info -->
              <div class="airline-info-row">
                <div class="airline-left">
                  <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                    {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                  </div>
                  <img [src]="segment.logo" class="airline-logo-img"
                    *ngIf="segment.logo && !segment.logo.includes('default')" />
                  <div class="airline-details">
                    <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                    <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                  </div>
                </div>
                <div class="fare-info">
                  <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass
                    }}</span>
                </div>
              </div>

              <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare Rules</a>

              <!-- Flight Timeline -->
              <div class="flight-timeline-grid">
                <div class="timeline-item">
                  <div class="time">{{ segment.departureTime }}</div>
                  <div class="timeline-dot"></div>
                  <div class="location-info">
                    <div class="city-name">{{ segment.from }}</div>
                    <div class="airport-name">{{ segment.fromAirport || segment.from + ', Terminal N/A' }}</div>
                    <div class="duration">{{ segment.duration }}</div>
                  </div>
                </div>

                <div class="timeline-item">
                  <div class="time">{{ segment.arrivalTime }}</div>
                  <div class="timeline-dot"></div>
                  <div class="location-info">
                    <div class="city-name">{{ segment.to }}</div>
                    <div class="airport-name">{{ segment.toAirport || segment.to + ', Terminal N/A' }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Layover between legs -->
            <div class="layover-row" *ngIf="segment.layover">
              <div class="line"></div>
              <div class="layover">
                <div *ngIf="segment.layover.hours >= 24" class="plus-day">
                  + {{ Math.floor(segment.layover.hours / 24) }} Day
                </div>
                {{ segment.layover.duration }} Layover in {{ segment.layover.location }}
              </div>
              <div class="line"></div>
            </div>
          </ng-container>
        </div>

      </div>

    </ng-container>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <!-- Tab Headers -->
      <div class="tab-header-scroll">
        <div *ngFor="let group of groupedFlightSegments; let i = index" class="tab-header"
          [class.active]="i === activeCancelTabIndex" (click)="activeCancelTabIndex = i">
          {{ group[0]?.originCode }} -
          {{ group[group.length - 1]?.destinationCode }}
        </div>
      </div>

      <!-- Tab Body -->
      <div class="tab-body" *ngIf="groupedFlightSegments?.[activeCancelTabIndex]">
        <ng-container *ngFor="let segment of groupedFlightSegments[activeCancelTabIndex]">
          <div class="cancellation-row">
            <div class="flight-airline">
              <img [src]="'assets/images/flightimages/' + segment.code.split(' ')[0] + '.png'" class="logo" />
              <div class="name">{{ segment.airline }}</div>
              <div class="code">{{ segment.code }}</div>
            </div>

            <div class="criteria">
              <div class="left">Cancellation Criteria</div>
              <div class="right">Charges</div>
            </div>

            <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
              <div class="left">{{ row.range }}</div>
              <div class="right">{{ row.price }}</div>
            </div>
          </div>

          <hr class="baggage-divider" />
        </ng-container>
      </div>
    </div>

    <!-- Add Passenger Card -->
    <div class="card">
      <div class="section-title">Add Passenger Details</div>

      <!-- Adults Section -->
      <div class="passenger-section">
        <div class="passenger-category-header">
          <span class="passenger-category-title">ADULTS (12+ YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(adults) }}/{{ adults.length }} added</span>
        </div>
        <ng-container *ngFor="let adult of adults; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="adult.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!adult.firstName"></i>
                <i class="fas fa-check" *ngIf="adult.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                adult.firstName
                ? getPassengerDisplayName(adult)
                : "Adult " + (i + 1) + " (12 yrs+)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('adult', i)">
                {{ adult.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('adult', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('adult', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="adult.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="adult.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Male'"
                      (click)="adult.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Female'"
                      (click)="adult.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row form-row-three">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(adult)" [minDate]="getAdultMinDOB()"
                      [maxDate]="getTodayDate()" [initialDate]="getTodayDate()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(adult, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'adult-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                  <div class="form-group form-group-small">
                    <label>Country Code</label>
                    <select class="dial-select" [(ngModel)]="adult.mobileDialCode">
                      <option value="+91">IN +91</option>
                      <option value="+1">US +1</option>
                      <option value="+44">UK +44</option>
                      <option value="+971">AE +971</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Mobile No</label>
                    <input type="tel" [(ngModel)]="adult.mobileNumber" placeholder="Mobile No" maxlength="10"
                      [class.error]="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i">{{
                      passengerValidationErrors.mobileNumber }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" [(ngModel)]="adult.email" placeholder="Email"
                    [class.error]="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.email }}</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="adult.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="adult.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="adult.panNumber" placeholder="Enter PAN number"
                    [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i">{{
                    passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('adult', i, adult)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Children Section -->
      <div class="passenger-section" *ngIf="children.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">CHILDREN (2-12 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(children) }}/{{ children.length }} added</span>
        </div>
        <ng-container *ngFor="let child of children; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="child.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!child.firstName"></i>
                <i class="fas fa-check" *ngIf="child.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                child.firstName
                ? child.firstName + " " + child.lastName
                : "Child " + (i + 1) + " (2 to 12 yrs)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('child', i)">
                {{ child.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('child', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('child', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="child.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'child-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'child-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="child.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'child-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'child-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="child.gender === 'Male'"
                      (click)="child.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="child.gender === 'Female'"
                      (click)="child.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(child)" [minDate]="getChildMinDOB()"
                      [maxDate]="getChildMaxDOB()" [initialDate]="getChildMaxDOB()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(child, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'child-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="child.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="child.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'child-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="child.panNumber" placeholder="Enter PAN number"
                    [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'child-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'child-' + i">{{
                    passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('child', i, child)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Infants Section -->
      <div class="passenger-section" *ngIf="infants.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">INFANTS (0-2 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(infants) }}/{{ infants.length }} added</span>
        </div>
        <ng-container *ngFor="let infant of infants; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="infant.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!infant.firstName"></i>
                <i class="fas fa-check" *ngIf="infant.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                infant.firstName
                ? infant.firstName + " " + infant.lastName
                : "Infant " + (i + 1) + " (15 days to 2 yrs)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('infant', i)">
                {{ infant.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('infant', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('infant', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="infant.firstName" placeholder="First & Middle Name"
                      [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'infant-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'infant-' + i">{{
                      passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="infant.lastName" placeholder="Last Name"
                      [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'infant-' + i" />
                    <div class="error-message"
                      *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'infant-' + i">{{
                      passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="infant.gender === 'Male'"
                      (click)="infant.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="infant.gender === 'Female'"
                      (click)="infant.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'infant-' + i">{{
                    passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-row">
                  <div class="form-group" id="finalpagecal">
                    <label>Date of Birth</label>
                    <app-custom-calendar [selectedDate]="getDOBAsDateString(infant)" [minDate]="getInfantMinDOB()"
                      [maxDate]="getInfantMaxDOB()" [initialDate]="getInfantMaxDOB()" placeholder="Select Date of Birth"
                      (dateSelected)="onDOBSelected(infant, $event)">
                    </app-custom-calendar>
                    <div class="error-message"
                      *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'infant-' + i">
                      {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth ||
                      passengerValidationErrors.dobYear }}
                    </div>
                  </div>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="infant.passportNumber" placeholder="Enter passport number"
                    [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'infant-' + i" />
                  <div class="error-message"
                    *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'infant-' + i">{{
                    passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn"
                    (click)="savePassengerDetailsInline('infant', i, infant)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Important Note -->
      <div class="passenger-important-note">
        <strong>Important:</strong> Enter name as mentioned on your passport or Government approved IDs.
      </div>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <!-- Tab Headers -->
      <div class="tab-header-scroll">
        <div *ngFor="let group of groupedFlightSegments; let i = index" class="tab-header"
          [class.active]="i === activeCancelTabIndex" (click)="activeCancelTabIndex = i">
          {{ group[0]?.originCode }} -
          {{ group[group.length - 1]?.destinationCode }}
        </div>
      </div>

      <!-- Tab Body -->
      <div class="tab-body" *ngIf="groupedFlightSegments?.[activeCancelTabIndex]">
        <ng-container *ngFor="let segment of groupedFlightSegments[activeCancelTabIndex]">
          <div class="cancellation-row">
            <div class="flight-airline">
              <img [src]="'assets/images/flightimages/' + segment.code.split(' ')[0] + '.png'" class="logo" />
              <div class="name">{{ segment.airline }}</div>
              <div class="code">{{ segment.code }}</div>
            </div>

            <div class="criteria">
              <div class="left">Cancellation Criteria</div>
              <div class="right">Charges</div>
            </div>

            <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
              <div class="left">{{ row.range }}</div>
              <div class="right">{{ row.price }}</div>
            </div>
          </div>

          <hr class="baggage-divider" />
        </ng-container>
      </div>
    </div>

    <!-- Important Information Card -->
    <div class="card info-card">
      <div class="section-title">
        <i class="fas fa-info-circle"></i>
        Important Information
      </div>

      <!-- Travel Guidelines - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-suitcase-rolling"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Baggage Restrictions
          </div>
          <div class="item-content">
            <ul>
              <li>Maximum 1 check-in baggage + 1 hand baggage per passenger</li>
              <li>Violations may result in additional airline charges</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Boarding Pass - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-mobile-alt"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Digital Boarding Pass
          </div>
          <div class="item-content">
            <ul>
              <li>Available within 6 hours after web check-in completion</li>
              <li>Ensure you complete check-in before flight departure</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Unaccompanied Minors - Compact -->
      <div class="info-item-compact">
        <div class="icon-circle">
          <i class="fas fa-user-shield"></i>
        </div>
        <div class="item-content-wrapper">
          <div class="item-header">
            Minor Passengers Policy
          </div>
          <div class="item-content">
            <ul>
              <li>Children under 18 traveling alone require special arrangements</li>
              <li>Contact airline for specific unaccompanied minor policies</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- GST Details Card -->
    <div class="card">
      <div class="section-title">GST - (Optional)</div>
      <div class="passenger-item-wrapper">
        <div class="gst-box" [class.completed]="gstDetails.companyName">
          <div class="icon"><i class="fas fa-building"></i></div>
          <div class="label">
            <span class="gst-label-text">
              {{
              gstDetails.companyName
              ? gstDetails.companyName
              : "Travelling for Business?"
              }}
            </span>
          </div>
          <button class="add-btn light small" (click)="handleGSTClick()">
            {{ gstDetails.companyName ? "CHANGE" : "ADD" }}
          </button>
        </div>
        <!-- Desktop Inline Form -->
        <div class="passenger-inline-form gst-inline-form desktop-only" [class.expanded]="isGSTExpanded">
          <div class="passenger-form-content" *ngIf="isGSTExpanded">
            <div class="gst-note">
              <div class="note-header">
                <i class="fas fa-info-circle"></i>
                <div>NOTE</div>
              </div>
              <div class="note-text">
                This is an optional section. Fill this if you wish to claim GST credit for this booking.
              </div>
            </div>
            <div class="form-group">
              <label>Company Name</label>
              <input type="text" [(ngModel)]="gstDetails.companyName" placeholder="Enter company name" />
            </div>
            <div class="form-group">
              <label>Company Billing Address</label>
              <textarea [(ngModel)]="gstDetails.companyAddress" placeholder="Enter billing address" rows="3"></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Company Phone Number</label>
                <input type="tel" [(ngModel)]="gstDetails.companyPhone" placeholder="Enter phone number" />
              </div>
              <div class="form-group">
                <label>Company Email Address</label>
                <input type="email" [(ngModel)]="gstDetails.companyEmail" placeholder="Enter email address" />
              </div>
            </div>
            <div class="form-group">
              <label>GST Number</label>
              <input type="text" [(ngModel)]="gstDetails.gstNumber" placeholder="Enter GST number" />
            </div>
            <div class="form-actions">
              <button class="save-btn" (click)="saveGSTDetails()">DONE</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Terms and Conditions Card (New) -->
    <div class="card">
      <div class="terms-section">
        <label class="terms-checkbox">
          <input type="checkbox" [(ngModel)]="termsAgreed" />
          <span class="checkmark"></span>
          <span class="terms-text">
            I understand and agree with the
            <span class="link-text" (click)="showFareRules = true">Fare Rules</span>, the Privacy Policy, the User
            Agreement & the Terms of Service of
            Wizzride.
          </span>
        </label>
      </div>
    </div>

    <!-- Price Footer -->
    <div class="footer-bar">
      <div class="fare-summary-desktop">
        <div class="fare-summary-title">Fare Summary</div>

        <!-- Base Fare Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleBaseFare()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Base Fare</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalBaseFare) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaseFareExpanded">
            <div class="fare-accordion-detail" *ngIf="totalAdults > 0">
              <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalChildren > 0">
              <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalInfants > 0">
              <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
            </div>
          </div>
        </div>

        <!-- Taxes & Surcharges Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleTaxes()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Taxes and Surcharges</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalTaxes) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isTaxesExpanded">
            <div class="fare-accordion-detail">
              <span>Airline Taxes and Surcharges</span>
            </div>
          </div>
        </div>

        <!-- Other Services Accordion (if baggage exists) -->
        <div class="fare-accordion-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
          <div class="fare-accordion-header" (click)="toggleBaggage()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Other Services</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaggageExpanded">
            <div class="fare-accordion-detail">
              <span>Extra Baggage</span>
            </div>
          </div>
        </div>

        <!-- Add-ons Accordion (Seats, Meals, Services) -->
        <div class="fare-accordion-item" *ngIf="getTotalAddonCharges() > 0">
          <div class="fare-accordion-header" (click)="toggleAddonsAccordion()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isAddonsAccordionExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Add-ons</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(getTotalAddonCharges()) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isAddonsAccordionExpanded">
            <div class="fare-accordion-detail" *ngIf="getTotalSeatCharges() > 0">
              <span>Seats ({{ formatCurrency(getTotalSeatCharges()) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="getTotalMealCharges() > 0">
              <span>Meals ({{ formatCurrency(getTotalMealCharges()) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="getTotalServiceCharges() > 0">
              <span>Special Services ({{ formatCurrency(getTotalServiceCharges()) }})</span>
            </div>
          </div>
        </div>

        <hr class="fare-summary-divider" />

        <!-- Total Amount -->
        <div class="fare-total-amount">
          <span class="fare-total-label">Total Amount</span>
          <span class="fare-total-value">{{ formatCurrency(getTotalAmountWithAddons()) }}</span>
        </div>
      </div>
      <button class="proceed-btn" [disabled]="!updateProceedButton()" (click)="finalProceed()">
        Proceed
      </button>
    </div>
  </div>

  <!-- Modals and Popups -->
</div>

<!-- Fare Summary Modal -->
<div class="trip-overlay" *ngIf="showFareSummaryModal" (click)="closeFareSummary()"></div>
<div class="trip-popup fare-summary-modal" *ngIf="showFareSummaryModal">
  <div class="trip-header">
    <div>Fare Summary</div>
    <button class="close-btn" (click)="closeFareSummary()">Ã—</button>
  </div>
  <div class="trip-body">
    <div class="fare-summary-content">
      <div class="fare-line">
        <div>Base Fare</div>
        <div>{{ formatCurrency(totalBaseFare) }}</div>
      </div>
      <div class="fare-line">
        <div>Taxes & Surcharges</div>
        <div>{{ formatCurrency(totalTaxes) }}</div>
      </div>
      <div class="fare-line" *ngIf="baggageTotal + baggageTotalReturn > 0">
        <div>Baggage</div>
        <div>{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</div>
      </div>
      <div class="fare-line" *ngIf="getTotalAddonCharges() > 0">
        <div>Add-ons</div>
        <div>{{ formatCurrency(getTotalAddonCharges()) }}</div>
      </div>
      <div class="fare-summary-divider"></div>
      <div class="fare-total-box">
        <div class="fare-total-label">â‚¹ Total Price</div>
        <div class="fare-total-amount">{{ getTotalAmountWithAddons() | number : "1.2-2" }}</div>
      </div>
    </div>
  </div>
  <div class="trip-footer">
    <button class="proceed-btn fare-proceed-btn" (click)="closeFareSummary()">PROCEED</button>
  </div>
</div>

<!-- Add Baggage Modal -->
<div class="trip-overlay" *ngIf="showAddBaggageModal" (click)="showAddBaggageModal = false"></div>
<div class="baggage-popup baggage-modal" *ngIf="showAddBaggageModal && tripType !== 'roundtrip'">
  <div class="trip-header">
    <div>Add Extra Baggage</div>
    <button class="close-btn" (click)="showAddBaggageModal = false">Ã—</button>
  </div>
  <div class="trip-body">
    <!-- Flight Route Indicator (Blue Pill - MMT Style) -->
    <div class="baggage-route-pill" *ngIf="flightSegments?.length">
      <div class="route-text">
        {{ flightSegments[0]?.from }}-{{ flightSegments[flightSegments.length - 1]?.to }}
      </div>
      <div class="route-status">Selection pending</div>
    </div>

    <!-- Included Baggage Info -->
    <div class="included-baggage-info">
      Included Check-in baggage per person - <span class="baggage-amount">15 KGS</span>
    </div>

    <!-- Baggage Options -->
    <ng-container *ngFor="let baggage of baggageOptions">
      <div class="baggage-option" *ngIf="(baggage.kgs || baggage.Weight) > 0">
        <div class="option-left">
          <i class="fas fa-suitcase-rolling"></i>
          <div class="baggage-text">
            <div class="baggage-weight">Additional {{ baggage.kgs || baggage.Weight }} KG</div>
          </div>
        </div>
        <div class="option-right">
          <div class="baggage-price">â‚¹ {{ baggage.price || baggage.Price }}</div>
          <div class="button-wrapper">
            <button class="add-option-btn" *ngIf="(baggageCounts[baggage.kgs || baggage.Code] || 0) === 0"
              (click)="incrementBaggage(baggage)">
              Add <i class="fas fa-plus"></i>
            </button>
            <div class="counter-wrapper" *ngIf="(baggageCounts[baggage.kgs || baggage.Code] || 0) > 0">
              <button class="counter-btn" (click)="decrementBaggage(baggage)">-</button>
              <div class="counter-value">
                {{ baggageCounts[baggage.kgs || baggage.Code] || 0 }}
              </div>
              <button class="counter-btn" (click)="incrementBaggage(baggage)"
                [disabled]="getTotalOneWayBaggageCount() >= maxAllowedBaggageCount">
                +
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="baggage-footer">
    <div class="baggage-count">{{ getTotalOneWayBaggageCount() }} of {{ maxAllowedBaggageCount }} Baggage(s) Selected
    </div>
    <div class="footer-right">
      <div class="fare-details">
        <div class="added-to-fare">Added to fare</div>
        <div class="total-price">â‚¹ {{ calculateBaggageTotal() | number : "1.2-2" }}</div>
      </div>
      <button class="baggage-done-btn" (click)="handleOneWayBaggageDone()">DONE</button>
    </div>
  </div>
</div>

<!-- Roundtrip Baggage Modal -->
<div class="baggage-popup baggage-modal" *ngIf="tripType === 'roundtrip' && showAddBaggageModal">
  <div class="trip-header">
    <div>Add Extra Baggage</div>
    <button class="close-btn" (click)="showAddBaggageModal = false">Ã—</button>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activeRoundBaggageTab === 'onward'" (click)="activeRoundBaggageTab = 'onward'">
      Onward
    </div>
    <div [class.active]="activeRoundBaggageTab === 'return'" (click)="activeRoundBaggageTab = 'return'">
      Return
    </div>
  </div>
  <div class="trip-body">
    <div class="tab-content-container">
      <div class="tab-content-wrapper" [class.return-active]="activeRoundBaggageTab === 'return'">
        <!-- Onward Tab -->
        <div class="tab-panel">
          <!-- Flight Route Indicator (Blue Pill - MMT Style) -->
          <div class="baggage-route-pill" *ngIf="flightSegments?.length">
            <div class="route-text">
              {{ flightSegments[0]?.from }}-{{ flightSegments[flightSegments.length - 1]?.to }}
            </div>
            <div class="route-status">{{ activeRoundBaggageTab === 'onward' ? '1 of 2 selected' : '2 of 2 selected' }}
            </div>
          </div>

          <!-- Included Baggage Info -->
          <div class="included-baggage-info">
            Included Check-in baggage per person - <span class="baggage-amount">15 KGS</span>
          </div>

          <!-- Baggage Options -->
          <ng-container *ngFor="let baggage of baggageOptions">
            <div class="baggage-option" *ngIf="(baggage.kgs || baggage.Weight) > 0">
              <div class="option-left">
                <i class="fas fa-suitcase-rolling"></i>
                <div class="baggage-text">
                  <div class="baggage-weight">Additional {{ baggage.kgs || baggage.Weight }} KG</div>
                </div>
              </div>
              <div class="option-right">
                <div class="baggage-price">â‚¹ {{ baggage.price || baggage.Price }}</div>
                <div class="button-wrapper">
                  <button class="add-option-btn" *ngIf="(onwardBaggageCounts[baggage.kgs || baggage.Code] || 0) === 0"
                    (click)="incrementRoundBaggage(baggage)">
                    Add <i class="fas fa-plus"></i>
                  </button>
                  <div class="counter-wrapper" *ngIf="(onwardBaggageCounts[baggage.kgs || baggage.Code] || 0) > 0">
                    <button class="counter-btn" (click)="decrementRoundBaggage(baggage)">-</button>
                    <div class="counter-value">
                      {{ onwardBaggageCounts[baggage.kgs || baggage.Code] || 0 }}
                    </div>
                    <button class="counter-btn" (click)="incrementRoundBaggage(baggage)"
                      [disabled]="!canAddMoreBaggage()">
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>

        <!-- Return Tab -->
        <div class="tab-panel">
          <!-- Flight Route Indicator (Blue Pill - MMT Style) -->
          <div class="baggage-route-pill" *ngIf="flightSegmentsReturn?.length">
            <div class="route-text">
              {{ flightSegmentsReturn[0]?.from }}-{{ flightSegmentsReturn[flightSegmentsReturn.length - 1]?.to }}
            </div>
            <div class="route-status">{{ activeRoundBaggageTab === 'onward' ? '1 of 2 selected' : '2 of 2 selected' }}
            </div>
          </div>

          <!-- Included Baggage Info -->
          <div class="included-baggage-info">
            Included Check-in baggage per person - <span class="baggage-amount">15 KGS</span>
          </div>

          <!-- Baggage Options -->
          <ng-container *ngFor="let baggage of baggageOptionsReturn">
            <div class="baggage-option" *ngIf="(baggage.kgs || baggage.Weight) > 0">
              <div class="option-left">
                <i class="fas fa-suitcase-rolling"></i>
                <div class="baggage-text">
                  <div class="baggage-weight">Additional {{ baggage.kgs || baggage.Weight }} KG</div>
                </div>
              </div>
              <div class="option-right">
                <div class="baggage-price">â‚¹ {{ baggage.price || baggage.Price }}</div>
                <div class="button-wrapper">
                  <button class="add-option-btn" *ngIf="(returnBaggageCounts[baggage.kgs || baggage.Code] || 0) === 0"
                    (click)="incrementRoundBaggage(baggage)">
                    Add <i class="fas fa-plus"></i>
                  </button>
                  <div class="counter-wrapper" *ngIf="(returnBaggageCounts[baggage.kgs || baggage.Code] || 0) > 0">
                    <button class="counter-btn" (click)="decrementRoundBaggage(baggage)">-</button>
                    <div class="counter-value">
                      {{ returnBaggageCounts[baggage.kgs || baggage.Code] || 0 }}
                    </div>
                    <button class="counter-btn" (click)="incrementRoundBaggage(baggage)"
                      [disabled]="!canAddMoreBaggage()">
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <div class="baggage-footer">
    <div class="baggage-count">{{ getTotalRoundTripBaggageCount() }} of {{ maxAllowedBaggageCount * 2 }} Baggage(s)
      Selected</div>
    <div class="footer-right">
      <div class="fare-details">
        <div class="added-to-fare">Added to fare</div>
        <div class="total-price">â‚¹ {{ calculateRoundTripBaggageTotal() | number : "1.2-2" }}</div>
      </div>
      <button class="baggage-done-btn" (click)="handleRoundTripBaggageDone()">DONE</button>
    </div>
  </div>
</div>

<!-- Policy Modal -->
<div class="trip-overlay" *ngIf="showPolicyModal" (click)="showPolicyModal = false"></div>
<div class="trip-popup" *ngIf="showPolicyModal && tripType !== 'roundtrip'">
  <div class="trip-header">
    <div>Cancellation & Rescheduling Policy</div>
    <button class="close-btn" (click)="showPolicyModal = false">Ã—</button>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activeTab === 'cancel'" (click)="activeTab = 'cancel'">
      CANCELLATION
    </div>
    <div [class.active]="activeTab === 'reschedule'" (click)="activeTab = 'reschedule'">
      RESCHEDULE
    </div>
  </div>
  <div class="trip-body">
    <div class="tab-content-container">
      <div class="tab-content-wrapper" [class.return-active]="activeTab === 'reschedule'">
        <div class="tab-panel">
          <div class="trip-flight" *ngFor="let seg of flightSegments">
            <div class="trip-airline">
              <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
              <div>{{ seg.airline }}</div>
              <div class="code">{{ seg.code }}</div>
            </div>
            <table class="policy-table" *ngIf="getCancellationRows(flightDataDeparture).length > 0">
              <tr *ngFor="let row of getCancellationRows(flightDataDeparture)">
                <td>{{ row.range }}</td>
                <td>{{ row.price }}</td>
              </tr>
            </table>
          </div>
        </div>
        <div class="tab-panel">
          <div class="trip-flight" *ngFor="let seg of flightSegments">
            <div class="trip-airline">
              <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
              <div>{{ seg.airline }}</div>
              <div class="code">{{ seg.code }}</div>
            </div>
            <table class="policy-table" *ngIf="getDateChangeRows(flightDataDeparture).length > 0">
              <tr *ngFor="let row of getDateChangeRows(flightDataDeparture)">
                <td>{{ row.range }}</td>
                <td>{{ row.price }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Roundtrip Policy Modal -->
<div class="trip-popup" *ngIf="showPolicyModal && tripType === 'roundtrip'">
  <div class="trip-header">
    <div>Cancellation & Rescheduling Policy</div>
    <button class="close-btn" (click)="showPolicyModal = false">Ã—</button>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activePolicyLeg === 'departure'" (click)="activePolicyLeg = 'departure'">
      DEPARTURE
    </div>
    <div [class.active]="activePolicyLeg === 'return'" (click)="activePolicyLeg = 'return'">
      RETURN
    </div>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activePolicySubTab === 'cancel'" (click)="activePolicySubTab = 'cancel'">
      CANCELLATION
    </div>
    <div [class.active]="activePolicySubTab === 'reschedule'" (click)="activePolicySubTab = 'reschedule'">
      RESCHEDULE
    </div>
  </div>
  <div class="trip-body">
    <div class="tab-content-container">
      <div class="tab-content-wrapper" [class.return-active]="activePolicyLeg === 'return'">
        <div class="tab-panel">
          <div *ngIf="activePolicySubTab === 'cancel'">
            <div class="trip-flight" *ngFor="let seg of flightSegments">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getCancellationRows(flightDataDeparture).length > 0">
                <tr *ngFor="let row of getCancellationRows(flightDataDeparture)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
          <div *ngIf="activePolicySubTab === 'reschedule'">
            <div class="trip-flight" *ngFor="let seg of flightSegments">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getDateChangeRows(flightDataDeparture).length > 0">
                <tr *ngFor="let row of getDateChangeRows(flightDataDeparture)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="tab-panel">
          <div *ngIf="activePolicySubTab === 'cancel'">
            <div class="trip-flight" *ngFor="let seg of flightSegmentsReturn">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getCancellationRows(flightDataReturn).length > 0">
                <tr *ngFor="let row of getCancellationRows(flightDataReturn)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
          <div *ngIf="activePolicySubTab === 'reschedule'">
            <div class="trip-flight" *ngFor="let seg of flightSegmentsReturn">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getDateChangeRows(flightDataReturn).length > 0">
                <tr *ngFor="let row of getDateChangeRows(flightDataReturn)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GST Modal -->
<div class="trip-overlay" *ngIf="showGSTModal" (click)="closeGSTModal()"></div>
<div class="gst-popup" *ngIf="showGSTModal">
  <div class="gst-header">
    <div>Add GST Details</div>
    <button class="close-btn" (click)="closeGSTModal()">Ã—</button>
  </div>
  <div class="gst-body">
    <div class="gst-note">
      <div class="note-header">
        <i class="fas fa-info-circle"></i>
        <div>NOTE</div>
      </div>
      <div class="note-text">
        This is an optional section. Fill this if you wish to claim GST credit for this booking.
      </div>
    </div>
    <div class="form-group">
      <label>Company Name</label>
      <input type="text" [(ngModel)]="gstDetails.companyName" placeholder="Enter company name" />
    </div>
    <div class="form-group">
      <label>Company Billing Address</label>
      <textarea [(ngModel)]="gstDetails.companyAddress" placeholder="Enter billing address" rows="3"></textarea>
    </div>
    <div class="form-group">
      <label>Company Phone Number</label>
      <input type="tel" [(ngModel)]="gstDetails.companyPhone" placeholder="Enter phone number" />
    </div>
    <div class="form-group">
      <label>Company Email Address</label>
      <input type="email" [(ngModel)]="gstDetails.companyEmail" placeholder="Enter email address" />
    </div>
    <div class="form-group">
      <label>GST Number</label>
      <input type="text" [(ngModel)]="gstDetails.gstNumber" placeholder="Enter GST number" />
    </div>
  </div>
  <div class="gst-footer">
    <button class="proceed-btn" (click)="saveGSTDetails()">DONE</button>
  </div>
</div>

<!-- Passenger Details Modal (Mobile Only) -->
<div class="trip-overlay" *ngIf="showPassengerModal && isMobileView()" (click)="closePassengerModal()"></div>
<div class="trip-popup" *ngIf="showPassengerModal && isMobileView()">
  <div class="trip-header">
    <div>Add Passenger Details</div>
    <button class="close-btn" (click)="closePassengerModal()">Ã—</button>
  </div>
  <div class="trip-body">
    <div class="form-group">
      <label>First Name</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.firstName" placeholder="Enter first name"
        [class.error]="passengerValidationErrors.firstName" />
      <div class="error-message" *ngIf="passengerValidationErrors.firstName">{{ passengerValidationErrors.firstName }}
      </div>
    </div>
    <div class="form-group">
      <label>Last Name</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.lastName" placeholder="Enter last name"
        [class.error]="passengerValidationErrors.lastName" />
      <div class="error-message" *ngIf="passengerValidationErrors.lastName">{{ passengerValidationErrors.lastName }}
      </div>
    </div>
    <div class="form-group">
      <label>Gender</label>
      <select [(ngModel)]="currentPassengerDetails.gender" required [class.error]="passengerValidationErrors.gender">
        <option value="" disabled selected>Select gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <div class="error-message" *ngIf="passengerValidationErrors.gender">{{ passengerValidationErrors.gender }}</div>
    </div>
    <div class="form-group" id="finalpagecal">
      <label>Date of Birth</label>
      <app-custom-calendar [selectedDate]="getDOBAsDateString(currentPassengerDetails)"
        [minDate]="getCurrentPassengerMinDOB()" [maxDate]="getTodayDate()" [initialDate]="getTodayDate()"
        placeholder="Select Date of Birth" (dateSelected)="onDOBSelected(currentPassengerDetails, $event)">
      </app-custom-calendar>
      <div class="error-message"
        *ngIf="passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear">
        {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear
        }}
      </div>
    </div>
    <div class="form-group" *ngIf="currentPassengerType === 'adult'">
      <label>Mobile Number</label>
      <div class="phone-row">
        <select class="dial-select" [(ngModel)]="currentPassengerDetails.mobileDialCode">
          <option value="+91">IN +91</option>
          <option value="+1">US +1</option>
          <option value="+44">UK +44</option>
          <option value="+61">AU +61</option>
          <option value="+971">AE +971</option>
          <option value="+65">SG +65</option>
          <option value="+60">MY +60</option>
          <option value="+66">TH +66</option>
          <option value="+62">ID +62</option>
          <option value="+63">PH +63</option>
          <option value="+84">VN +84</option>
          <option value="+86">CN +86</option>
          <option value="+81">JP +81</option>
          <option value="+82">KR +82</option>
          <option value="+33">FR +33</option>
          <option value="+49">DE +49</option>
          <option value="+39">IT +39</option>
          <option value="+34">ES +34</option>
          <option value="+31">NL +31</option>
          <option value="+32">BE +32</option>
          <option value="+41">CH +41</option>
          <option value="+43">AT +43</option>
          <option value="+46">SE +46</option>
          <option value="+47">NO +47</option>
          <option value="+45">DK +45</option>
          <option value="+358">FI +358</option>
          <option value="+353">IE +353</option>
          <option value="+351">PT +351</option>
          <option value="+30">GR +30</option>
          <option value="+48">PL +48</option>
          <option value="+420">CZ +420</option>
          <option value="+36">HU +36</option>
          <option value="+40">RO +40</option>
          <option value="+7">RU +7</option>
          <option value="+27">ZA +27</option>
          <option value="+20">EG +20</option>
          <option value="+52">MX +52</option>
          <option value="+55">BR +55</option>
          <option value="+54">AR +54</option>
          <option value="+56">CL +56</option>
          <option value="+57">CO +57</option>
          <option value="+51">PE +51</option>
          <option value="+64">NZ +64</option>
        </select>
        <input type="tel" name="contactMobile" #contactMobileInput [(ngModel)]="currentPassengerDetails.mobileNumber"
          placeholder="10-digit mobile starts 6-9" maxlength="10" [readonly]="isMobileView()"
          [attr.inputmode]="isMobileView() ? 'none' : 'numeric'" (click)="openPhoneDialer('primary', $event)"
          (focus)="isMobileView() && openPhoneDialer('primary', $event)"
          [class.error]="passengerValidationErrors.mobileNumber" />
      </div>
      <div class="error-message" *ngIf="passengerValidationErrors.mobileNumber">{{
        passengerValidationErrors.mobileNumber }}</div>
    </div>
    <div class="form-group" *ngIf="currentPassengerType === 'adult'">
      <label>Email</label>
      <input type="email" [(ngModel)]="currentPassengerDetails.email" placeholder="Enter email"
        [class.error]="passengerValidationErrors.email" />
      <div class="error-message" *ngIf="passengerValidationErrors.email">{{ passengerValidationErrors.email }}</div>
    </div>
    <div class="form-group checkbox-group" *ngIf="currentPassengerType !== 'infant'">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="currentPassengerDetails.requiresWheelchair" />
        <span>Optional - This passenger requires a wheelchair</span>
      </label>
    </div>
    <div class="form-group" *ngIf="passportInfoRequired">
      <label>Passport Number</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.passportNumber" placeholder="Enter passport number"
        [class.error]="passengerValidationErrors.passportNumber" />
      <div class="error-message" *ngIf="passengerValidationErrors.passportNumber">{{
        passengerValidationErrors.passportNumber }}</div>
    </div>
    <div class="form-group" *ngIf="panInfoRequired">
      <label>PAN Number</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.panNumber" placeholder="Enter PAN number"
        [class.error]="passengerValidationErrors.panNumber" />
      <div class="error-message" *ngIf="passengerValidationErrors.panNumber">{{ passengerValidationErrors.panNumber }}
      </div>
    </div>
  </div>
  <div class="trip-footer">
    <button class="proceed-btn" (click)="savePassengerDetails(currentPassengerDetails)">SAVE</button>
  </div>
</div>

<!-- Fare Rules Modal -->
<div *ngIf="showFareRules" class="trip-overlay" (click)="showFareRules = false"></div>
<div *ngIf="showFareRules" class="trip-popup fare-summary-modal">
  <div class="trip-header">
    Fare Rules
    <button class="modal-close-btn" (click)="showFareRules = false">Ã—</button>
  </div>
  <div class="trip-body">
    <div class="fare-tabs" *ngIf="tripType === 'roundtrip'">
      <div class="fare-tab" [class.fare-tab-active]="fareTab === 'onward'" (click)="fareTab = 'onward'">
        Onward
      </div>
      <div class="fare-tab" [class.fare-tab-active]="fareTab === 'return'" (click)="fareTab = 'return'">
        Return
      </div>
    </div>
    <div *ngIf="tripType === 'roundtrip'" class="fare-tab-panels">
      <div *ngIf="fareTab === 'onward'" class="fare-tab-panel">
        <div class="fare-info-text" *ngIf="fareRuleText" [innerHTML]="fareRuleText"></div>
        <div class="fare-info-text" *ngIf="!fareRuleText">Fare rules not available.</div>
      </div>
      <div *ngIf="fareTab === 'return'" class="fare-tab-panel">
        <div class="fare-info-text" *ngIf="fareRuleTextReturn" [innerHTML]="fareRuleTextReturn"></div>
        <div class="fare-info-text" *ngIf="!fareRuleTextReturn">Fare rules not available.</div>
      </div>
    </div>
    <div *ngIf="tripType !== 'roundtrip'">
      <div class="fare-info-text" *ngIf="fareRuleText" [innerHTML]="fareRuleText"></div>
      <div class="fare-info-text" *ngIf="!fareRuleText">Fare rules not available.</div>
    </div>
  </div>
  <div class="trip-footer">
    <button class="proceed-btn" (click)="showFareRules = false">DONE</button>
  </div>
</div>

<!-- Mobile Fare Breakdown Bottom Sheet -->
<div class="bottom-sheet-overlay" *ngIf="showMobileFareBreakdown" (click)="closeMobileFareBreakdown()"></div>
<div class="bottom-sheet-modal fare-breakdown-sheet" [class.show]="showMobileFareBreakdown">
  <div class="bottom-sheet-header">
    <div class="bottom-sheet-handle"></div>
    <div class="bottom-sheet-title">Fare Breakdown</div>
    <button class="bottom-sheet-close" (click)="closeMobileFareBreakdown()">Ã—</button>
  </div>
  <div class="bottom-sheet-content">
    <!-- Base Fare -->
    <div class="fare-breakdown-item">
      <div class="fare-breakdown-row main" (click)="toggleBaseFare()">
        <div class="fare-breakdown-left">
          <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
          <span>Base Fare</span>
        </div>
        <span class="fare-breakdown-amount">{{ formatCurrency(totalBaseFare) }}</span>
      </div>
      <div class="fare-breakdown-details" [class.expanded]="isBaseFareExpanded">
        <div class="fare-breakdown-detail" *ngIf="totalAdults > 0">
          <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
        </div>
        <div class="fare-breakdown-detail" *ngIf="totalChildren > 0">
          <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
        </div>
        <div class="fare-breakdown-detail" *ngIf="totalInfants > 0">
          <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
        </div>
      </div>
    </div>

    <!-- Taxes & Surcharges -->
    <div class="fare-breakdown-item">
      <div class="fare-breakdown-row main" (click)="toggleTaxes()">
        <div class="fare-breakdown-left">
          <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
          <span>Taxes and Surcharges</span>
        </div>
        <span class="fare-breakdown-amount">{{ formatCurrency(totalTaxes) }}</span>
      </div>
      <div class="fare-breakdown-details" [class.expanded]="isTaxesExpanded">
        <div class="fare-breakdown-detail">
          <span>Airline Taxes and Surcharges</span>
        </div>
      </div>
    </div>

    <!-- Other Services (if baggage exists) -->
    <div class="fare-breakdown-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
      <div class="fare-breakdown-row main" (click)="toggleBaggage()">
        <div class="fare-breakdown-left">
          <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
          <span>Other Services</span>
        </div>
        <span class="fare-breakdown-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
      </div>
      <div class="fare-breakdown-details" [class.expanded]="isBaggageExpanded">
        <div class="fare-breakdown-detail">
          <span>Extra Baggage</span>
        </div>
      </div>
    </div>

    <!-- Add-ons (Seats, Meals, Services) -->
    <div class="fare-breakdown-item" *ngIf="getTotalAddonCharges() > 0">
      <div class="fare-breakdown-row main" (click)="toggleAddonsAccordion()">
        <div class="fare-breakdown-left">
          <i class="fas" [ngClass]="isAddonsAccordionExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
          <span>Add-ons</span>
        </div>
        <span class="fare-breakdown-amount">{{ formatCurrency(getTotalAddonCharges()) }}</span>
      </div>
      <div class="fare-breakdown-details" [class.expanded]="isAddonsAccordionExpanded">
        <div class="fare-breakdown-detail" *ngIf="getTotalSeatCharges() > 0">
          <span>Seats ({{ formatCurrency(getTotalSeatCharges()) }})</span>
        </div>
        <div class="fare-breakdown-detail" *ngIf="getTotalMealCharges() > 0">
          <span>Meals ({{ formatCurrency(getTotalMealCharges()) }})</span>
        </div>
        <div class="fare-breakdown-detail" *ngIf="getTotalServiceCharges() > 0">
          <span>Special Services ({{ formatCurrency(getTotalServiceCharges()) }})</span>
        </div>
      </div>
    </div>

    <hr class="fare-breakdown-divider" />

    <!-- Total Amount -->
    <div class="fare-breakdown-total">
      <span class="fare-breakdown-total-label">Total Amount</span>
      <span class="fare-breakdown-total-value">{{ formatCurrency(getTotalAmountWithAddons()) }}</span>
    </div>
  </div>
</div>

<app-phone-dialer [isVisible]="showPhoneDialer" [currentValue]="getCurrentDialerValue()" [maxLength]="10"
  (numberClick)="onDialerNumberClick($event)" (backspaceClick)="onDialerBackspace()" (doneClick)="onDialerDone()"
  (closeDialer)="closePhoneDialer()"></app-phone-dialer>