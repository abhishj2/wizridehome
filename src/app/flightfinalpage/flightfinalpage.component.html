<div *ngIf="loader">
  <main class="shimmer-main">
    <div class="shimmer-box-long"></div>
    <p></p>
    <div class="shimmer-box-long1"></div>
    <br />
    <div>
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-circle"></div>
            <div class="shimmer-box1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-circle"></div>
            <div class="shimmer-box1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>
      </div>
      <br />
      <div class="shimmer-box-long2"></div>
      <br />
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>
      </div>
      <br />
      <div class="shimmer-box-long1"></div>
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long"></div>
          </div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long"></div>
          </div>
        </div>
      </div>
      <div class="shimmer-box-long2"></div>
      <div class="shimmer-grid">
        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>

        <div class="container">
          <div class="flex-container-space-between">
            <div class="shimmer-box-long1"></div>
          </div>
          <div class="shimmer-box"></div>
        </div>
      </div>
      <br />
      <div class="shimmer-box-long"></div>
    </div>
  </main>
</div>

<div class="scroll-wrapper" *ngIf="!loader">
    <!-- Oneway Trip -->
    <div class="flight-final-page" *ngIf="tripType == 'oneway'" id="oneway-section">
      <!-- Flight Summary Card -->
      <div class="card flight-summary-card" *ngIf="flightSegments?.length">
        <!-- Desktop Flight Summary Design -->
        <div class="desktop-flight-summary" *ngFor="let segment of flightSegments; let i = index">
          <!-- Route Header -->
          <div class="route-header">
            <div class="route-info">
              <div class="route-title">
                {{ segment.from }} <span>â†’</span> {{ segment.to }}
              </div>
              <div class="date-time-section">
                <span class="date-badge">{{ segment.date | date : "EEEE, MMM dd" }}</span>
                <span class="flight-duration">
                  <span *ngIf="flightSegments.length === 1">Non Stop</span>
                  <span *ngIf="flightSegments.length > 1">{{ flightSegments.length - 1 }} Stop{{ flightSegments.length > 2 ? 's' : '' }}</span>
                  â€¢ {{ segment.duration }}
                </span>
              </div>
            </div>
            <div class="cancellation-badge" *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
              CANCELLATION FEES APPLY
            </div>
          </div>

          <!-- Flight Details -->
          <div class="flight-details-section">
            <!-- Airline Info -->
            <div class="airline-info-row">
              <div class="airline-left">
                <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                  {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                </div>
                <img [src]="segment.logo" class="airline-logo-img" *ngIf="segment.logo && !segment.logo.includes('default')" />
                <div class="airline-details">
                  <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                  <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                </div>
              </div>
              <div class="fare-info">
                <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass }}</span>
              </div>
            </div>

            <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare Rules</a>

            <!-- Flight Timeline -->
            <div class="flight-timeline-grid">
              <div class="timeline-item">
                <div class="time">{{ segment.departureTime }}</div>
                <div class="timeline-dot"></div>
                <div class="location-info">
                  <div class="city-name">{{ segment.from }}</div>
                  <div class="airport-name">{{ segment.fromAirport || segment.from + ' Airport' }}</div>
                  <div class="duration">{{ segment.duration }}</div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="time">{{ segment.arrivalTime }}</div>
                <div class="timeline-dot"></div>
                <div class="location-info">
                  <div class="city-name">{{ segment.to }}</div>
                  <div class="airport-name">{{ segment.toAirport || segment.to + ' Airport' }}</div>
                </div>
              </div>
            </div>

            <!-- Baggage Info -->
            <div class="baggage-info-grid">
              <div class="baggage-item">
                <span class="baggage-icon">ðŸ’¼</span>
                <div>
                  <span class="baggage-label">Cabin Baggage:</span> {{ segment.cabin || '7 KG' }} / Adult
                </div>
              </div>
              <div class="baggage-item">
                <span class="baggage-icon">ðŸ§³</span>
                <div>
                  <span class="baggage-label">Check-In Baggage:</span> {{ segment.checkIn || '15 Kilograms (1 piece only)' }} / Adult
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mobile Flight Summary (Original Design) -->
        <div class="mobile-flight-summary">
          <div class="flight-leg oneway-flight-leg">
            <div class="flexflight" *ngFor="let segment of flightSegments; let i = index">
              <!-- Airline Info -->
              <div class="flight-airline">
                <img [src]="segment.logo" class="logo" />
                <div class="name">{{ segment.airline }}</div>
                <div class="code">{{ segment.code }}</div>
              </div>

              <!-- Route Info -->
              <div class="flight-route">
                <div class="city">{{ segment.from }}</div>
                <div class="plane-icon">
                  <i class="fas fa-plane"></i>
                </div>
                <div class="city">{{ segment.to }}</div>
              </div>

              <!-- Timing & Duration -->
              <div class="flight-meta">
                {{ segment.date | date : "EEE, dd MMM" }} |
                {{ segment.departureTime }} - {{ segment.arrivalTime }} |
                {{ segment.duration }}
              </div>

              <!-- Layover if applicable -->
              <div class="layover-row" *ngIf="i < flightSegments.length - 1 && segment.layover">
                <div class="line"></div>
                <div class="layover">
                  <div *ngIf="segment.layover.hours >= 24" class="plus-day">
                    + 1 Day
                  </div>
                  {{ segment.layover.duration }} Layover in
                  {{ segment.layover.location }}
                </div>
                <div class="line"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Extra Baggage Banner - Desktop Only -->
        <div class="extra-baggage-banner" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
          <div class="baggage-banner-text">
            <span class="baggage-emoji">ðŸŽ’</span>
            <span *ngIf="baggageTotal === 0">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
            <span *ngIf="baggageTotal > 0">{{ getTotalOneWayBaggageCount() }} KGs of extra baggage added on your trip for â‚¹ {{ baggageTotal | number : '1.0-0' }}! Total check-in baggage is now {{ 15 + getTotalOneWayBaggageCount() }} KGs.</span>
          </div>
          <button class="change-baggage-btn" (click)="showAddBaggageModal = true">
            {{ baggageTotal > 0 ? 'CHANGE' : 'ADD BAGGAGE' }}
          </button>
        </div>

      <!-- Cancellation Policy Section - Desktop Only -->
      <div class="cancellation-policy-section" *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
        <div class="cancellation-header">
          <div class="cancellation-title">Cancellation & Date Change Policy</div>
        </div>
        <div class="cancellation-airline" *ngIf="flightDataDeparture?.Segments?.[0]?.[0]">
          <img [src]="'assets/images/flightimages/' + flightDataDeparture.Segments[0][0].Airline?.AirlineCode + '.png'" class="logo" />
          <span class="airline-route">{{ flightDataDeparture.Segments[0][0].Origin?.Airport?.CityCode }}-{{ flightDataDeparture.Segments[0][flightDataDeparture.Segments[0].length - 1]?.Destination?.Airport?.CityCode }}</span>
        </div>
        <div class="cancellation-criteria-header">
          <div class="criteria-left">Cancellation Criteria</div>
          <div class="criteria-right">Charges</div>
        </div>
        <div class="cancellation-rows">
          <div class="cancellation-row-item" *ngFor="let row of getCancellationRows(flightDataDeparture)">
            <div class="criteria-left">{{ row.range }}</div>
            <div class="criteria-right">{{ row.price }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Passenger Card -->
    <div class="card">
      <div class="section-title">Add Passenger Details</div>
      
      <!-- Adults Section -->
      <div class="passenger-section">
        <div class="passenger-category-header">
          <span class="passenger-category-title">ADULTS (12+ YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(adults) }}/{{ adults.length }} added</span>
        </div>
        <ng-container *ngFor="let adult of adults; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="adult.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!adult.firstName"></i>
                <i class="fas fa-check" *ngIf="adult.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                adult.firstName
                ? getPassengerDisplayName(adult)
                : "Adult " + (i + 1) + " (12 yrs+)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('adult', i)">
                {{ adult.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('adult', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('adult', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="adult.firstName" placeholder="First & Middle Name" [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="adult.lastName" placeholder="Last Name" [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Male'" (click)="adult.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Female'" (click)="adult.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message" *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-group">
                  <label>Date of Birth</label>
                  <div class="input-group-row">
                    <select [(ngModel)]="adult.dobDay" [class.error]="passengerValidationErrors.dobDay && expandedPassengerKey === 'adult-' + i">
                      <option value="">DD</option>
                      <option *ngFor="let day of days" [value]="day">{{ day }}</option>
                    </select>
                    <select [(ngModel)]="adult.dobMonth" [class.error]="passengerValidationErrors.dobMonth && expandedPassengerKey === 'adult-' + i">
                      <option value="">MM</option>
                      <option *ngFor="let month of months" [value]="month">{{ month }}</option>
                    </select>
                    <select [(ngModel)]="adult.dobYear" [class.error]="passengerValidationErrors.dobYear && expandedPassengerKey === 'adult-' + i">
                      <option value="">YYYY</option>
                      <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                    </select>
                  </div>
                  <div class="error-message" *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'adult-' + i">
                    {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear }}
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Country Code</label>
                    <select class="dial-select" [(ngModel)]="adult.mobileDialCode">
                      <option value="+91">IN +91</option>
                      <option value="+1">US +1</option>
                      <option value="+44">UK +44</option>
                      <option value="+971">AE +971</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Mobile No</label>
                    <input type="tel" [(ngModel)]="adult.mobileNumber" placeholder="Mobile No" maxlength="10" [class.error]="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.mobileNumber }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" [(ngModel)]="adult.email" placeholder="Email" [class.error]="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.email }}</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="adult.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="adult.passportNumber" placeholder="Enter passport number" [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="adult.panNumber" placeholder="Enter PAN number" [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn" (click)="savePassengerDetailsInline('adult', i, adult)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Children Section -->
      <div class="passenger-section" *ngIf="children.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">CHILDREN (2-12 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(children) }}/{{ children.length }} added</span>
        </div>
        <div class="passenger-box" [class.completed]="child.firstName" *ngFor="let child of children; let i = index">
          <div class="passenger-icon-circle">
            <i class="fas fa-plus" *ngIf="!child.firstName"></i>
            <i class="fas fa-check" *ngIf="child.firstName"></i>
          </div>
          <div class="passenger-label">
            {{
            child.firstName
            ? child.firstName + " " + child.lastName
            : "Child " + (i + 1) + " (2 to 12 yrs)"
            }}
          </div>
          <button class="passenger-add-btn" (click)="openPassengerModal('child', i)">
            {{ child.firstName ? "CHANGE" : "+ ADD" }}
          </button>
        </div>
      </div>

      <!-- Infants Section -->
      <div class="passenger-section" *ngIf="infants.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">INFANTS (0-2 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(infants) }}/{{ infants.length }} added</span>
        </div>
        <div class="passenger-box" [class.completed]="infant.firstName" *ngFor="let infant of infants; let i = index">
          <div class="passenger-icon-circle">
            <i class="fas fa-plus" *ngIf="!infant.firstName"></i>
            <i class="fas fa-check" *ngIf="infant.firstName"></i>
          </div>
          <div class="passenger-label">
            {{
            infant.firstName
            ? infant.firstName + " " + infant.lastName
            : "Infant " + (i + 1) + " (15 days to 2 yrs)"
            }}
          </div>
          <button class="passenger-add-btn" (click)="openPassengerModal('infant', i)">
            {{ infant.firstName ? "CHANGE" : "+ ADD" }}
          </button>
        </div>
      </div>

      <!-- Important Note -->
      <div class="passenger-important-note">
        <strong>Important:</strong> Enter name as mentioned on your passport or Government approved IDs.
      </div>
    </div>

    <!-- Baggage Section - Mobile Only -->
    <div class="card mobile-baggage-section oneway-baggage-section oneway-mobile-baggage">
      <div class="section-title">Baggage Allowance</div>
      <div class="mobile-baggage-content">
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <span class="baggage-text">Cabin Baggage: <strong>{{ flightSegments[0]?.cabin || '7 KG' }}</strong> / Adult</span>
        </div>
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <span class="baggage-text">Check-In Baggage: <strong>{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece only)' }}</strong> / Adult</span>
        </div>
      </div>
      <div class="mobile-add-baggage oneway-add-baggage oneway-mobile-add-baggage" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="mobile-add-baggage-content">
          <span class="add-baggage-icon">ðŸŽ’</span>
          <span class="add-baggage-text">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
        </div>
        <button class="mobile-add-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <ng-container *ngFor="let segment of flightDataDeparture?.Segments[0]; let i = index">
        <div class="cancellation-row">
          <div class="flight-airline">
            <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'" class="logo" />
            <div class="name">{{ segment.Airline.AirlineName }}</div>
            <div class="code">
              {{ segment.Airline.AirlineCode }}
              {{ segment.Airline.FlightNumber }}
            </div>
          </div>
          <div class="criteria">
            <div class="left">Cancellation Criteria</div>
            <div class="right">Charges</div>
          </div>
          <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
            <div class="left">{{ row.range }}</div>
            <div class="right">{{ row.price }}</div>
          </div>
        </div>
        <hr class="baggage-divider" *ngIf="i < flightDataDeparture?.Segments[0].length - 1" />
      </ng-container>
    </div>

    <!-- GST Details Card -->
    <div class="card">
      <div class="section-title">GST - (Optional)</div>
      <div class="gst-box" (click)="openGSTModal()">
        <div class="icon"><i class="fas fa-building"></i></div>
        <div class="label">
          <span class="gst-label-text">
            {{
            gstDetails.companyName
            ? gstDetails.companyName
            : "Travelling for Business?"
            }}
          </span>
        </div>
        <button class="add-btn light small">
          {{ gstDetails.companyName ? "CHANGE" : "ADD" }}
        </button>
      </div>
    </div>

    <!-- Terms and Conditions Card -->
    <div class="card">
      <div class="terms-section">
        <label class="terms-checkbox">
          <input type="checkbox" [(ngModel)]="termsAgreed" />
          <span class="checkmark"></span>
          <span class="terms-text">
            I understand and agree with the
            <span class="link-text" (click)="showFareRules = true">Fare Rules</span>, the
            <a class="link-text" href="https://wizzride.com/cancellationpolicy/privacypolicy" target="_blank"
              rel="noopener noreferrer">
              Privacy Policy</a>, the
            <a class="link-text" href="https://wizzride.com/cancellationpolicy/useragreement" target="_blank"
              rel="noopener noreferrer">
              User Agreement</a>
            & the Terms of Service of Wizzride.
          </span>
        </label>
      </div>
    </div>

    <!-- Price Footer -->
    <div class="footer-bar">
      <div class="fare-summary-desktop">
        <div class="fare-summary-title">Fare Summary</div>
        
        <!-- Base Fare Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleBaseFare()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Base Fare</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalBaseFare) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaseFareExpanded">
            <div class="fare-accordion-detail" *ngIf="totalAdults > 0">
              <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalChildren > 0">
              <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalInfants > 0">
              <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
            </div>
          </div>
        </div>

        <!-- Taxes & Surcharges Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleTaxes()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Taxes and Surcharges</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalTaxes) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isTaxesExpanded">
            <div class="fare-accordion-detail">
              <span>Airline Taxes and Surcharges</span>
            </div>
          </div>
        </div>

        <!-- Other Services Accordion (if baggage exists) -->
        <div class="fare-accordion-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
          <div class="fare-accordion-header" (click)="toggleBaggage()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Other Services</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaggageExpanded">
            <div class="fare-accordion-detail">
              <span>Extra Baggage</span>
            </div>
          </div>
        </div>

        <hr class="fare-summary-divider" />
        
        <!-- Total Amount -->
        <div class="fare-total-amount">
          <span class="fare-total-label">Total Amount</span>
          <span class="fare-total-value">{{ formatCurrency(finalAmount) }}</span>
        </div>
      </div>
      <button class="proceed-btn" [disabled]="!updateProceedButton()" (click)="finalProceed()">
        Proceed
      </button>
    </div>
  </div>

  <!-- Roundtrip -->
  <div class="flight-final-page" *ngIf="tripType == 'roundtrip'">
    <!-- Flight Summary Card -->
    <div class="card flight-summary-wrapper makemytrip-flight-card">
      <div class="flight-cards-container">
        <!-- Onward Flight Card -->
        <div class="flight-card-item" *ngIf="flightSegments?.length">
          <div class="card">
            <div class="flight-leg roundtrip-flight-leg roundtrip-onward-flight-leg">
              <div *ngFor="let segment of flightSegments; let i = index">
                <!-- Flight Details -->
                <div class="flight-details-section">
                  <!-- Airline Info -->
                  <div class="airline-info-row">
                    <div class="airline-left">
                      <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                        {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                      </div>
                      <img [src]="segment.logo" class="airline-logo-img" *ngIf="segment.logo && !segment.logo.includes('default')" />
                      <div class="airline-details">
                        <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                        <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                      </div>
                    </div>
                    <div class="fare-info">
                      <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass }}</span>
                    </div>
                  </div>

                  <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare Rules</a>

                  <!-- Flight Timeline -->
                  <div class="flight-timeline-grid">
                    <div class="timeline-item">
                      <div class="time">{{ segment.departureTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.from }}</div>
                        <div class="airport-name">{{ segment.fromAirport || segment.from + ', Terminal N/A' }}</div>
                        <div class="duration">{{ segment.duration }}</div>
                      </div>
                    </div>

                    <div class="timeline-item">
                      <div class="time">{{ segment.arrivalTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.to }}</div>
                        <div class="airport-name">{{ segment.toAirport || segment.to + ', Terminal N/A' }}</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Layover if applicable -->
                <div class="layover-row" *ngIf="i < flightSegments.length - 1 && segment.layover">
                  <div class="line"></div>
                  <div class="layover">
                    <div *ngIf="segment.layover.hours >= 24" class="plus-day">+ 1 Day</div>
                    {{ segment.layover.duration }} Layover in {{ segment.layover.location }}
                  </div>
                  <div class="line"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Return Flight Card -->
        <div class="flight-card-item" *ngIf="flightSegmentsReturn?.length">
          <div class="card">
            <div class="flight-leg roundtrip-flight-leg roundtrip-return-flight-leg">
              <div *ngFor="let segment of flightSegmentsReturn; let i = index">
                <!-- Flight Details -->
                <div class="flight-details-section">
                  <!-- Airline Info -->
                  <div class="airline-info-row">
                    <div class="airline-left">
                      <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                        {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                      </div>
                      <img [src]="segment.logo" class="airline-logo-img" *ngIf="segment.logo && !segment.logo.includes('default')" />
                      <div class="airline-details">
                        <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                        <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                      </div>
                    </div>
                    <div class="fare-info">
                      <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass }}</span>
                    </div>
                  </div>

                  <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare Rules</a>

                  <!-- Flight Timeline -->
                  <div class="flight-timeline-grid">
                    <div class="timeline-item">
                      <div class="time">{{ segment.departureTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.from }}</div>
                        <div class="airport-name">{{ segment.fromAirport || segment.from + ', Terminal N/A' }}</div>
                        <div class="duration">{{ segment.duration }}</div>
                      </div>
                    </div>

                    <div class="timeline-item">
                      <div class="time">{{ segment.arrivalTime }}</div>
                      <div class="timeline-dot"></div>
                      <div class="location-info">
                        <div class="city-name">{{ segment.to }}</div>
                        <div class="airport-name">{{ segment.toAirport || segment.to + ', Terminal N/A' }}</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Layover if applicable -->
                <div class="layover-row" *ngIf="i < flightSegmentsReturn.length - 1 && segment.layover">
                  <div class="line"></div>
                  <div class="layover">
                    <div *ngIf="segment.layover.hours >= 24" class="plus-day">+ 1 Day</div>
                    {{ segment.layover.duration }} Layover in {{ segment.layover.location }}
                  </div>
                  <div class="line"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Baggage Allowance Section - Desktop Only (Onward) -->
      <div class="makemytrip-baggage-section roundtrip-baggage-section roundtrip-desktop-baggage baggage-info" *ngIf="flightSegments?.length">
        <div class="baggage-allowance-item baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <div class="baggage-label baggage-text">
            <span>Cabin Baggage: </span>
            <span class="baggage-weight">{{ flightSegments[0]?.cabin || '7 KG' }}</span>
            <span> / Adult</span>
          </div>
        </div>
        <div class="baggage-allowance-item baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <div class="baggage-label baggage-text">
            <span>Check-In Baggage: </span>
            <span class="baggage-weight">{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece only)' }}</span>
            <span> / Adult</span>
          </div>
        </div>
      </div>

      <!-- Add Baggage CTA - Desktop Only -->
      <div class="makemytrip-add-baggage roundtrip-add-baggage roundtrip-desktop-add-baggage extra-baggage" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="add-baggage-left baggage-promo">
          <span class="promo-icon add-baggage-icon">ðŸŽ’</span>
          <span class="add-baggage-text promo-text">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
        </div>
        <button class="add-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>

      <!-- Cancellation Policy Section - Desktop Only (Onward) -->
      <div class="makemytrip-cancellation-section" *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
        <div class="cancellation-header">
          <div class="cancellation-title">Cancellation & Date Change Policy</div>
        </div>
        <div class="cancellation-airline" *ngIf="flightDataDeparture?.Segments?.[0]?.[0]">
          <img [src]="'assets/images/flightimages/' + flightDataDeparture.Segments[0][0].Airline?.AirlineCode + '.png'" class="logo" />
          <span class="airline-route">{{ flightDataDeparture.Segments[0][0].Origin?.Airport?.CityCode }}-{{ flightDataDeparture.Segments[0][flightDataDeparture.Segments[0].length - 1]?.Destination?.Airport?.CityCode }}</span>
        </div>
        <div class="cancellation-criteria-header">
          <div class="criteria-left">Cancellation Criteria</div>
          <div class="criteria-right">Charges</div>
        </div>
        <div class="cancellation-rows">
          <div class="cancellation-row-item" *ngFor="let row of getCancellationRows(flightDataDeparture)">
            <div class="criteria-left">{{ row.range }}</div>
            <div class="criteria-right">{{ row.price }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Passenger Card -->
    <div class="card">
      <div class="section-title">Add Passenger Details</div>
      
      <!-- Adults Section -->
      <div class="passenger-section">
        <div class="passenger-category-header">
          <span class="passenger-category-title">ADULTS (12+ YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(adults) }}/{{ adults.length }} added</span>
        </div>
        <ng-container *ngFor="let adult of adults; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="adult.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!adult.firstName"></i>
                <i class="fas fa-check" *ngIf="adult.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                adult.firstName
                ? getPassengerDisplayName(adult)
                : "Adult " + (i + 1) + " (12 yrs+)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('adult', i)">
                {{ adult.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('adult', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('adult', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="adult.firstName" placeholder="First & Middle Name" [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="adult.lastName" placeholder="Last Name" [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Male'" (click)="adult.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Female'" (click)="adult.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message" *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-group">
                  <label>Date of Birth</label>
                  <div class="input-group-row">
                    <select [(ngModel)]="adult.dobDay" [class.error]="passengerValidationErrors.dobDay && expandedPassengerKey === 'adult-' + i">
                      <option value="">DD</option>
                      <option *ngFor="let day of days" [value]="day">{{ day }}</option>
                    </select>
                    <select [(ngModel)]="adult.dobMonth" [class.error]="passengerValidationErrors.dobMonth && expandedPassengerKey === 'adult-' + i">
                      <option value="">MM</option>
                      <option *ngFor="let month of months" [value]="month">{{ month }}</option>
                    </select>
                    <select [(ngModel)]="adult.dobYear" [class.error]="passengerValidationErrors.dobYear && expandedPassengerKey === 'adult-' + i">
                      <option value="">YYYY</option>
                      <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                    </select>
                  </div>
                  <div class="error-message" *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'adult-' + i">
                    {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear }}
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Country Code</label>
                    <select class="dial-select" [(ngModel)]="adult.mobileDialCode">
                      <option value="+91">IN +91</option>
                      <option value="+1">US +1</option>
                      <option value="+44">UK +44</option>
                      <option value="+971">AE +971</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Mobile No</label>
                    <input type="tel" [(ngModel)]="adult.mobileNumber" placeholder="Mobile No" maxlength="10" [class.error]="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.mobileNumber }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" [(ngModel)]="adult.email" placeholder="Email" [class.error]="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.email }}</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="adult.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="adult.passportNumber" placeholder="Enter passport number" [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="adult.panNumber" placeholder="Enter PAN number" [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn" (click)="savePassengerDetailsInline('adult', i, adult)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Children Section -->
      <div class="passenger-section" *ngIf="children.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">CHILDREN (2-12 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(children) }}/{{ children.length }} added</span>
        </div>
        <div class="passenger-box" [class.completed]="child.firstName" *ngFor="let child of children; let i = index">
          <div class="passenger-icon-circle">
            <i class="fas fa-plus" *ngIf="!child.firstName"></i>
            <i class="fas fa-check" *ngIf="child.firstName"></i>
          </div>
          <div class="passenger-label">
            {{
            child.firstName
            ? child.firstName + " " + child.lastName
            : "Child " + (i + 1) + " (2 to 12 yrs)"
            }}
          </div>
          <button class="passenger-add-btn" (click)="openPassengerModal('child', i)">
            {{ child.firstName ? "CHANGE" : "+ ADD" }}
          </button>
        </div>
      </div>

      <!-- Infants Section -->
      <div class="passenger-section" *ngIf="infants.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">INFANTS (0-2 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(infants) }}/{{ infants.length }} added</span>
        </div>
        <div class="passenger-box" [class.completed]="infant.firstName" *ngFor="let infant of infants; let i = index">
          <div class="passenger-icon-circle">
            <i class="fas fa-plus" *ngIf="!infant.firstName"></i>
            <i class="fas fa-check" *ngIf="infant.firstName"></i>
          </div>
          <div class="passenger-label">
            {{
            infant.firstName
            ? infant.firstName + " " + infant.lastName
            : "Infant " + (i + 1) + " (15 days to 2 yrs)"
            }}
          </div>
          <button class="passenger-add-btn" (click)="openPassengerModal('infant', i)">
            {{ infant.firstName ? "CHANGE" : "+ ADD" }}
          </button>
        </div>
      </div>

      <!-- Important Note -->
      <div class="passenger-important-note">
        <strong>Important:</strong> Enter name as mentioned on your passport or Government approved IDs.
      </div>
    </div>

    <!-- Baggage Section - Mobile Only -->
    <div class="card mobile-baggage-section roundtrip-baggage-section roundtrip-mobile-baggage">
      <div class="section-title">Baggage Allowance</div>
      <div class="mobile-baggage-content">
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <span class="baggage-text">Cabin Baggage: <strong>{{ flightSegments[0]?.cabin || '7 KG' }}</strong> / Adult</span>
        </div>
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <span class="baggage-text">Check-In Baggage: <strong>{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece only)' }}</strong> / Adult</span>
        </div>
      </div>
      <div class="mobile-add-baggage roundtrip-add-baggage roundtrip-mobile-add-baggage" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="mobile-add-baggage-content">
          <span class="add-baggage-icon">ðŸŽ’</span>
          <span class="add-baggage-text">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
        </div>
        <button class="mobile-add-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <!-- Onward / Return Tabs -->
      <div class="policy-tabs">
        <div [class.active]="activePolicyTab === 'onward'" (click)="activePolicyTab = 'onward'">
          Onward
        </div>
        <div [class.active]="activePolicyTab === 'return'" (click)="activePolicyTab = 'return'">
          Return
        </div>
      </div>

      <!-- Tab Scroll Container -->
      <div class="tab-content-container">
        <div class="tab-content-wrapper" [class.return-active]="activePolicyTab === 'return'">
          <!-- Onward Panel -->
          <div class="tab-panel baggage-margin">
            <ng-container *ngFor="
                let segment of flightDataDeparture?.Segments[0];
                let i = index
              ">
              <div class="cancellation-row">
                <div class="flight-airline">
                  <img [src]="
                      'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'
                    " class="logo" />
                  <div class="name">{{ segment.Airline.AirlineName }}</div>
                  <div class="code">
                    {{ segment.Airline.AirlineCode }}
                    {{ segment.Airline.FlightNumber }}
                  </div>
                </div>
                <div class="criteria">
                  <div class="left">Cancellation Criteria</div>
                  <div class="right">Charges</div>
                </div>
                <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
                  <div class="left">{{ row.range }}</div>
                  <div class="right">{{ row.price }}</div>
                </div>
              </div>
              <hr class="baggage-divider" *ngIf="i < flightDataDeparture?.Segments[0].length - 1" />
            </ng-container>
          </div>

          <!-- Return Panel -->
          <div class="tab-panel baggage-margin">
            <ng-container *ngFor="
                let segment of flightDataReturn?.Segments[0];
                let i = index
              ">
              <div class="cancellation-row">
                <div class="flight-airline">
                  <img [src]="
                      'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'
                    " class="logo" />
                  <div class="name">{{ segment.Airline.AirlineName }}</div>
                  <div class="code">
                    {{ segment.Airline.AirlineCode }}
                    {{ segment.Airline.FlightNumber }}
                  </div>
                </div>
                <div class="criteria">
                  <div class="left">Cancellation Criteria</div>
                  <div class="right">Charges</div>
                </div>
                <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataReturn)">
                  <div class="left">{{ row.range }}</div>
                  <div class="right">{{ row.price }}</div>
                </div>
              </div>
              <hr class="baggage-divider" *ngIf="i < flightDataReturn?.Segments[0].length - 1" />
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- GST Details Card -->
    <div class="card">
      <div class="section-title">GST - (Optional)</div>
      <div class="gst-box" (click)="openGSTModal()">
        <div class="icon"><i class="fas fa-building"></i></div>
        <div class="label">
          <span class="gst-label-text">
            {{
            gstDetails.companyName
            ? gstDetails.companyName
            : "Travelling for Business?"
            }}
          </span>
        </div>
        <button class="add-btn light small">
          {{ gstDetails.companyName ? "CHANGE" : "ADD" }}
        </button>
      </div>
    </div>

    <!-- Terms and Conditions Card -->
    <div class="card">
      <div class="terms-section">
        <label class="terms-checkbox">
          <input type="checkbox" [(ngModel)]="termsAgreed" />
          <span class="checkmark"></span>
          <span class="terms-text">
            I understand and agree with the
            <span class="link-text" (click)="showFareRules = true">Fare Rules</span>, the Privacy Policy, the User
            Agreement & the Terms of Service of
            Wizzride.
          </span>
        </label>
      </div>
    </div>

    <!-- Price Footer -->
    <div class="footer-bar">
      <div class="fare-summary-desktop">
        <div class="fare-summary-title">Fare Summary</div>
        
        <!-- Base Fare Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleBaseFare()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Base Fare</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalBaseFare) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaseFareExpanded">
            <div class="fare-accordion-detail" *ngIf="totalAdults > 0">
              <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalChildren > 0">
              <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalInfants > 0">
              <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
            </div>
          </div>
        </div>

        <!-- Taxes & Surcharges Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleTaxes()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Taxes and Surcharges</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalTaxes) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isTaxesExpanded">
            <div class="fare-accordion-detail">
              <span>Airline Taxes and Surcharges</span>
            </div>
          </div>
        </div>

        <!-- Other Services Accordion (if baggage exists) -->
        <div class="fare-accordion-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
          <div class="fare-accordion-header" (click)="toggleBaggage()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Other Services</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaggageExpanded">
            <div class="fare-accordion-detail">
              <span>Extra Baggage</span>
            </div>
          </div>
        </div>

        <hr class="fare-summary-divider" />
        
        <!-- Total Amount -->
        <div class="fare-total-amount">
          <span class="fare-total-label">Total Amount</span>
          <span class="fare-total-value">{{ formatCurrency(finalAmount) }}</span>
        </div>
      </div>
      <button class="proceed-btn" [disabled]="!updateProceedButton()" (click)="finalProceed()">
        Proceed
      </button>
    </div>
  </div>

  <!-- Multi-City -->
  <div class="flight-final-page" *ngIf="tripType == 'multicity'">
    <!-- Flight Summary Card -->
    <!-- Flight Summary Cards: One per segment -->
    <!-- Flight Summary Cards: One per segment group -->
    <ng-container
      *ngIf="tripType === 'multicity' && flightSegmentGroups?.length"
    >
      <div
        class="card makemytrip-flight-card"
        *ngFor="let group of flightSegmentGroups; let groupIndex = index"
      >
        <div class="flight-leg multicity-flight-leg">
          <ng-container *ngFor="let segment of group; let i = index">
            <!-- Flight Details -->
            <div class="flight-details-section">
              <!-- Airline Info -->
              <div class="airline-info-row">
                <div class="airline-left">
                  <div class="airline-logo" *ngIf="!segment.logo || segment.logo.includes('default')">
                    {{ segment.airline?.substring(0, 2).toUpperCase() || 'AI' }}
                  </div>
                  <img [src]="segment.logo" class="airline-logo-img" *ngIf="segment.logo && !segment.logo.includes('default')" />
                  <div class="airline-details">
                    <div class="airline-name">{{ segment.airline }} {{ segment.code }}</div>
                    <div class="aircraft-badge" *ngIf="segment.aircraft">Boeing {{ segment.aircraft }}</div>
                  </div>
                </div>
                <div class="fare-info">
                  <span>Economy ></span> <span class="fare-type" *ngIf="segment.fareClass">{{ segment.fareClass }}</span>
                </div>
              </div>

              <a href="#" class="view-rules" (click)="showFareRules = true; $event.preventDefault()">View Fare Rules</a>

              <!-- Flight Timeline -->
              <div class="flight-timeline-grid">
                <div class="timeline-item">
                  <div class="time">{{ segment.departureTime }}</div>
                  <div class="timeline-dot"></div>
                  <div class="location-info">
                    <div class="city-name">{{ segment.from }}</div>
                    <div class="airport-name">{{ segment.fromAirport || segment.from + ', Terminal N/A' }}</div>
                    <div class="duration">{{ segment.duration }}</div>
                  </div>
                </div>

                <div class="timeline-item">
                  <div class="time">{{ segment.arrivalTime }}</div>
                  <div class="timeline-dot"></div>
                  <div class="location-info">
                    <div class="city-name">{{ segment.to }}</div>
                    <div class="airport-name">{{ segment.toAirport || segment.to + ', Terminal N/A' }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Layover between legs -->
            <div class="layover-row" *ngIf="segment.layover">
              <div class="line"></div>
              <div class="layover">
                <div *ngIf="segment.layover.hours >= 24" class="plus-day">
                  + {{ Math.floor(segment.layover.hours / 24) }} Day
                </div>
                {{ segment.layover.duration }} Layover in {{ segment.layover.location }}
              </div>
              <div class="line"></div>
            </div>
          </ng-container>
        </div>

        <!-- Baggage Allowance Section - Desktop Only -->
        <div class="makemytrip-baggage-section multicity-baggage-section multicity-desktop-baggage baggage-info">
          <div class="baggage-allowance-item baggage-item">
            <span class="baggage-icon">ðŸ’¼</span>
            <div class="baggage-label baggage-text">
              <span>Cabin Baggage: </span>
              <span class="baggage-weight">{{ group[0]?.cabin || '7 KG' }}</span>
              <span> / Adult</span>
            </div>
          </div>
          <div class="baggage-allowance-item baggage-item">
            <span class="baggage-icon">ðŸ§³</span>
            <div class="baggage-label baggage-text">
              <span>Check-In Baggage: </span>
              <span class="baggage-weight">{{ group[0]?.checkIn || '15 Kilograms (1 piece only)' }}</span>
              <span> / Adult</span>
            </div>
          </div>
        </div>

        <!-- Cancellation Policy Section - Desktop Only -->
        <div class="makemytrip-cancellation-section" *ngIf="flightDataDeparture && getCancellationRows(flightDataDeparture).length > 0">
          <div class="cancellation-header">
            <div class="cancellation-title">Cancellation & Date Change Policy</div>
          </div>
          <div class="cancellation-airline" *ngIf="group && group.length > 0">
            <img [src]="'assets/images/flightimages/' + group[0].code?.split(' ')[0] + '.png'" class="logo" />
            <span class="airline-route">{{ group[0].originCode }}-{{ group[group.length - 1].destinationCode }}</span>
          </div>
          <div class="cancellation-criteria-header">
            <div class="criteria-left">Cancellation Criteria</div>
            <div class="criteria-right">Charges</div>
          </div>
          <div class="cancellation-rows">
            <div class="cancellation-row-item" *ngFor="let row of getCancellationRows(flightDataDeparture)">
              <div class="criteria-left">{{ row.range }}</div>
              <div class="criteria-right">{{ row.price }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- CTA button -->
      <div class="card no-padding">
      </div>
    </ng-container>

    <!-- Add Baggage CTA - Desktop Only (Outside loop - appears once) -->
    <div class="makemytrip-add-baggage multicity-add-baggage multicity-desktop-add-baggage extra-baggage" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
      <div class="add-baggage-left baggage-promo">
        <span class="promo-icon add-baggage-icon">ðŸŽ’</span>
        <span class="add-baggage-text promo-text">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
      </div>
      <button class="add-baggage-btn" (click)="showAddBaggageModal = true">
        ADD BAGGAGE
      </button>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div
        class="section-title-row"
        (click)="showPolicyModal = true; activeTab = 'cancel'"
      >
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <!-- Tab Headers -->
      <div class="tab-header-scroll">
        <div
          *ngFor="let group of groupedFlightSegments; let i = index"
          class="tab-header"
          [class.active]="i === activeCancelTabIndex"
          (click)="activeCancelTabIndex = i"
        >
          {{ group[0]?.originCode }} -
          {{ group[group.length - 1]?.destinationCode }}
        </div>
      </div>

      <!-- Tab Body -->
      <div
        class="tab-body"
        *ngIf="groupedFlightSegments?.[activeCancelTabIndex]"
      >
        <ng-container
          *ngFor="let segment of groupedFlightSegments[activeCancelTabIndex]"
        >
          <div class="cancellation-row">
            <div class="flight-airline">
              <img
                [src]="'assets/logos/' + segment.code.split(' ')[0] + '.png'"
                class="logo"
              />
              <div class="name">{{ segment.airline }}</div>
              <div class="code">{{ segment.code }}</div>
            </div>

            <div class="criteria">
              <div class="left">Cancellation Criteria</div>
              <div class="right">Charges</div>
            </div>

            <div
              class="criteria-detail"
              *ngFor="let row of getCancellationRows(flightDataDeparture)"
            >
              <div class="left">{{ row.range }}</div>
              <div class="right">{{ row.price }}</div>
            </div>
          </div>

          <hr class="baggage-divider" />
        </ng-container>
      </div>
    </div>

    <!-- Add Passenger Card -->
    <div class="card">
      <div class="section-title">Add Passenger Details</div>
      
      <!-- Adults Section -->
      <div class="passenger-section">
        <div class="passenger-category-header">
          <span class="passenger-category-title">ADULTS (12+ YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(adults) }}/{{ adults.length }} added</span>
        </div>
        <ng-container *ngFor="let adult of adults; let i = index">
          <div class="passenger-item-wrapper">
            <div class="passenger-box" [class.completed]="adult.firstName">
              <div class="passenger-icon-circle">
                <i class="fas fa-plus" *ngIf="!adult.firstName"></i>
                <i class="fas fa-check" *ngIf="adult.firstName"></i>
              </div>
              <div class="passenger-label">
                {{
                  adult.firstName
                    ? getPassengerDisplayName(adult)
                    : "Adult " + (i + 1) + " (12 yrs+)"
                }}
              </div>
              <button class="passenger-add-btn" (click)="openPassengerModal('adult', i)">
                {{ adult.firstName ? "CHANGE" : "+ ADD" }}
              </button>
            </div>
            <!-- Desktop Inline Form -->
            <div class="passenger-inline-form desktop-only" [class.expanded]="isPassengerExpanded('adult', i)">
              <div class="passenger-form-content" *ngIf="isPassengerExpanded('adult', i)">
                <div class="form-row">
                  <div class="form-group">
                    <label>First & Middle Name</label>
                    <input type="text" [(ngModel)]="adult.firstName" placeholder="First & Middle Name" [class.error]="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.firstName && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.firstName }}</div>
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="adult.lastName" placeholder="Last Name" [class.error]="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.lastName && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.lastName }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <div class="gender-buttons">
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Male'" (click)="adult.gender = 'Male'">MALE</button>
                    <button type="button" class="gender-btn" [class.active]="adult.gender === 'Female'" (click)="adult.gender = 'Female'">FEMALE</button>
                  </div>
                  <div class="error-message" *ngIf="passengerValidationErrors.gender && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.gender }}</div>
                </div>
                <div class="form-group">
                  <label>Date of Birth</label>
                  <div class="input-group-row">
                    <select [(ngModel)]="adult.dobDay" [class.error]="passengerValidationErrors.dobDay && expandedPassengerKey === 'adult-' + i">
                      <option value="">DD</option>
                      <option *ngFor="let day of days" [value]="day">{{ day }}</option>
                    </select>
                    <select [(ngModel)]="adult.dobMonth" [class.error]="passengerValidationErrors.dobMonth && expandedPassengerKey === 'adult-' + i">
                      <option value="">MM</option>
                      <option *ngFor="let month of months" [value]="month">{{ month }}</option>
                    </select>
                    <select [(ngModel)]="adult.dobYear" [class.error]="passengerValidationErrors.dobYear && expandedPassengerKey === 'adult-' + i">
                      <option value="">YYYY</option>
                      <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                    </select>
                  </div>
                  <div class="error-message" *ngIf="(passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear) && expandedPassengerKey === 'adult-' + i">
                    {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear }}
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Country Code</label>
                    <select class="dial-select" [(ngModel)]="adult.mobileDialCode">
                      <option value="+91">IN +91</option>
                      <option value="+1">US +1</option>
                      <option value="+44">UK +44</option>
                      <option value="+971">AE +971</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Mobile No</label>
                    <input type="tel" [(ngModel)]="adult.mobileNumber" placeholder="Mobile No" maxlength="10" [class.error]="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i" />
                    <div class="error-message" *ngIf="passengerValidationErrors.mobileNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.mobileNumber }}</div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" [(ngModel)]="adult.email" placeholder="Email" [class.error]="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.email && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.email }}</div>
                </div>
                <div class="form-group checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="adult.requiresWheelchair" />
                    <span>I require wheelchair (Optional)</span>
                  </label>
                </div>
                <div class="form-group" *ngIf="passportInfoRequired">
                  <label>Passport Number</label>
                  <input type="text" [(ngModel)]="adult.passportNumber" placeholder="Enter passport number" [class.error]="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.passportNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.passportNumber }}</div>
                </div>
                <div class="form-group" *ngIf="panInfoRequired">
                  <label>PAN Number</label>
                  <input type="text" [(ngModel)]="adult.panNumber" placeholder="Enter PAN number" [class.error]="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i" />
                  <div class="error-message" *ngIf="passengerValidationErrors.panNumber && expandedPassengerKey === 'adult-' + i">{{ passengerValidationErrors.panNumber }}</div>
                </div>
                <div class="passenger-form-actions">
                  <button class="passenger-save-btn" (click)="savePassengerDetailsInline('adult', i, adult)">SAVE</button>
                  <button class="passenger-cancel-btn" (click)="collapsePassengerForm()">CANCEL</button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Children Section -->
      <div class="passenger-section" *ngIf="children.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">CHILDREN (2-12 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(children) }}/{{ children.length }} added</span>
        </div>
        <div class="passenger-box" [class.completed]="child.firstName" *ngFor="let child of children; let i = index">
          <div class="passenger-icon-circle">
            <i class="fas fa-plus" *ngIf="!child.firstName"></i>
            <i class="fas fa-check" *ngIf="child.firstName"></i>
          </div>
          <div class="passenger-label">
            {{
              child.firstName
                ? child.firstName + " " + child.lastName
                : "Child " + (i + 1) + " (2 to 12 yrs)"
            }}
          </div>
          <button class="passenger-add-btn" (click)="openPassengerModal('child', i)">
            {{ child.firstName ? "CHANGE" : "+ ADD" }}
          </button>
        </div>
      </div>

      <!-- Infants Section -->
      <div class="passenger-section" *ngIf="infants.length > 0">
        <div class="passenger-category-header">
          <span class="passenger-category-title">INFANTS (0-2 YRS)</span>
          <span class="passenger-count">{{ getCompletedCount(infants) }}/{{ infants.length }} added</span>
        </div>
        <div class="passenger-box" [class.completed]="infant.firstName" *ngFor="let infant of infants; let i = index">
          <div class="passenger-icon-circle">
            <i class="fas fa-plus" *ngIf="!infant.firstName"></i>
            <i class="fas fa-check" *ngIf="infant.firstName"></i>
          </div>
          <div class="passenger-label">
            {{
              infant.firstName
                ? infant.firstName + " " + infant.lastName
                : "Infant " + (i + 1) + " (15 days to 2 yrs)"
            }}
          </div>
          <button class="passenger-add-btn" (click)="openPassengerModal('infant', i)">
            {{ infant.firstName ? "CHANGE" : "+ ADD" }}
          </button>
        </div>
      </div>

      <!-- Important Note -->
      <div class="passenger-important-note">
        <strong>Important:</strong> Enter name as mentioned on your passport or Government approved IDs.
      </div>
    </div>

    <!-- Baggage Section - Mobile Only -->
    <div class="card mobile-baggage-section multicity-baggage-section multicity-mobile-baggage">
      <div class="section-title">Baggage Allowance</div>
      <div class="mobile-baggage-content">
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ’¼</span>
          <span class="baggage-text">Cabin Baggage: <strong>{{ flightSegments[0]?.cabin || '7 KG' }}</strong> / Adult</span>
        </div>
        <div class="mobile-baggage-item">
          <span class="baggage-icon">ðŸ§³</span>
          <span class="baggage-text">Check-In Baggage: <strong>{{ flightSegments[0]?.checkIn || '15 Kilograms (1 piece only)' }}</strong> / Adult</span>
        </div>
      </div>
      <div class="mobile-add-baggage multicity-add-baggage multicity-mobile-add-baggage" *ngIf="extraBaggageAvailable || extraBaggageAvailableReturn">
        <div class="mobile-add-baggage-content">
          <span class="add-baggage-icon">ðŸŽ’</span>
          <span class="add-baggage-text">Got excess baggage? Don't stress, buy extra check-in baggage allowance at fab rates!</span>
        </div>
        <button class="mobile-add-baggage-btn" (click)="showAddBaggageModal = true">
          ADD BAGGAGE
        </button>
      </div>
    </div>

    <!-- Cancellation & Rescheduling Policy Card - Mobile Only -->
    <div class="card cancellation-policy-card-mobile">
      <div class="section-title-row" (click)="showPolicyModal = true; activeTab = 'cancel'">
        <div class="section-title">Cancellation & Rescheduling Policy</div>
        <div class="section-arrow">â€º</div>
      </div>

      <!-- Tab Headers -->
      <div class="tab-header-scroll">
        <div
          *ngFor="let group of groupedFlightSegments; let i = index"
          class="tab-header"
          [class.active]="i === activeCancelTabIndex"
          (click)="activeCancelTabIndex = i"
        >
          {{ group[0]?.originCode }} -
          {{ group[group.length - 1]?.destinationCode }}
        </div>
      </div>

      <!-- Tab Body -->
      <div class="tab-body" *ngIf="groupedFlightSegments?.[activeCancelTabIndex]">
        <ng-container *ngFor="let segment of groupedFlightSegments[activeCancelTabIndex]">
          <div class="cancellation-row">
            <div class="flight-airline">
              <img [src]="'assets/images/flightimages/' + segment.code.split(' ')[0] + '.png'" class="logo" />
              <div class="name">{{ segment.airline }}</div>
              <div class="code">{{ segment.code }}</div>
            </div>

            <div class="criteria">
              <div class="left">Cancellation Criteria</div>
              <div class="right">Charges</div>
            </div>

            <div class="criteria-detail" *ngFor="let row of getCancellationRows(flightDataDeparture)">
              <div class="left">{{ row.range }}</div>
              <div class="right">{{ row.price }}</div>
            </div>
          </div>

          <hr class="baggage-divider" />
        </ng-container>
      </div>
    </div>

    <!-- GST Details Card -->
    <div class="card">
      <div class="section-title">GST - (Optional)</div>
      <div class="gst-box" (click)="openGSTModal()">
        <div class="icon"><i class="fas fa-building"></i></div>
        <div class="label">
          <span class="gst-label-text">
            {{
            gstDetails.companyName
            ? gstDetails.companyName
            : "Travelling for Business?"
            }}
          </span>
        </div>
        <button class="add-btn light small">
          {{ gstDetails.companyName ? "CHANGE" : "ADD" }}
        </button>
      </div>
    </div>

    <!-- Terms and Conditions Card (New) -->
    <div class="card">
      <div class="terms-section">
        <label class="terms-checkbox">
          <input type="checkbox" [(ngModel)]="termsAgreed" />
          <span class="checkmark"></span>
          <span class="terms-text">
            I understand and agree with the
            <span class="link-text" (click)="showFareRules = true"
              >Fare Rules</span
            >, the Privacy Policy, the User Agreement & the Terms of Service of
            Wizzride.
          </span>
        </label>
      </div>
    </div>

    <!-- Price Footer -->
    <div class="footer-bar">
      <div class="fare-summary-desktop">
        <div class="fare-summary-title">Fare Summary</div>
        
        <!-- Base Fare Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleBaseFare()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaseFareExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Base Fare</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalBaseFare) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaseFareExpanded">
            <div class="fare-accordion-detail" *ngIf="totalAdults > 0">
              <span>Adult(s) ({{ totalAdults }} X {{ formatCurrency(adultBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalChildren > 0">
              <span>Child(ren) ({{ totalChildren }} X {{ formatCurrency(childrenBaseFare) }})</span>
            </div>
            <div class="fare-accordion-detail" *ngIf="totalInfants > 0">
              <span>Infant(s) ({{ totalInfants }} X {{ formatCurrency(infantBaseFare) }})</span>
            </div>
          </div>
        </div>

        <!-- Taxes & Surcharges Accordion -->
        <div class="fare-accordion-item">
          <div class="fare-accordion-header" (click)="toggleTaxes()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isTaxesExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Taxes and Surcharges</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(totalTaxes) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isTaxesExpanded">
            <div class="fare-accordion-detail">
              <span>Airline Taxes and Surcharges</span>
            </div>
          </div>
        </div>

        <!-- Other Services Accordion (if baggage exists) -->
        <div class="fare-accordion-item" *ngIf="baggageTotal + baggageTotalReturn > 0">
          <div class="fare-accordion-header" (click)="toggleBaggage()">
            <div class="fare-accordion-left">
              <i class="fas" [ngClass]="isBaggageExpanded ? 'fa-minus-circle' : 'fa-plus-circle'"></i>
              <span>Other Services</span>
            </div>
            <span class="fare-accordion-amount">{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</span>
          </div>
          <div class="fare-accordion-content" [class.expanded]="isBaggageExpanded">
            <div class="fare-accordion-detail">
              <span>Extra Baggage</span>
            </div>
          </div>
        </div>

        <hr class="fare-summary-divider" />
        
        <!-- Total Amount -->
        <div class="fare-total-amount">
          <span class="fare-total-label">Total Amount</span>
          <span class="fare-total-value">{{ formatCurrency(finalAmount) }}</span>
        </div>
      </div>
      <button
        class="proceed-btn"
        [disabled]="!updateProceedButton()"
        (click)="finalProceed()"
      >
        Proceed
      </button>
    </div>
  </div>

  <!-- Modals and Popups -->
</div>

<!-- Fare Summary Modal -->
<div class="trip-overlay" *ngIf="showFareSummaryModal" (click)="closeFareSummary()"></div>
<div class="trip-popup fare-summary-modal" *ngIf="showFareSummaryModal">
  <div class="trip-header">
    <div>Fare Summary</div>
    <button class="close-btn" (click)="closeFareSummary()">Ã—</button>
  </div>
  <div class="trip-body">
    <div class="fare-summary-content">
      <div class="fare-line">
        <div>Base Fare</div>
        <div>{{ formatCurrency(totalBaseFare) }}</div>
      </div>
      <div class="fare-line">
        <div>Taxes & Surcharges</div>
        <div>{{ formatCurrency(totalTaxes) }}</div>
      </div>
      <div class="fare-line" *ngIf="baggageTotal + baggageTotalReturn > 0">
        <div>Baggage</div>
        <div>{{ formatCurrency(baggageTotal + baggageTotalReturn) }}</div>
      </div>
      <div class="fare-summary-divider"></div>
      <div class="fare-total-box">
        <div class="fare-total-label">â‚¹ Total Price</div>
        <div class="fare-total-amount">{{ finalAmount | number : "1.2-2" }}</div>
      </div>
    </div>
  </div>
  <div class="trip-footer">
    <button class="proceed-btn fare-proceed-btn" (click)="closeFareSummary()">PROCEED</button>
  </div>
</div>

<!-- Add Baggage Modal -->
<div class="trip-overlay" *ngIf="showAddBaggageModal" (click)="showAddBaggageModal = false"></div>
<div class="baggage-popup baggage-modal" *ngIf="showAddBaggageModal && tripType !== 'roundtrip'">
  <div class="trip-header">
    <div>Add Extra Baggage</div>
    <button class="close-btn" (click)="showAddBaggageModal = false">Ã—</button>
  </div>
  <div class="trip-body">
    <!-- Flight Route Indicator (Blue Pill - MMT Style) -->
    <div class="baggage-route-pill" *ngIf="flightSegments?.length">
      <div class="route-text">
        {{ flightSegments[0]?.from }}-{{ flightSegments[flightSegments.length - 1]?.to }}
      </div>
      <div class="route-status">Selection pending</div>
    </div>

    <!-- Included Baggage Info -->
    <div class="included-baggage-info">
      Included Check-in baggage per person - <span class="baggage-amount">15 KGS</span>
    </div>

    <!-- Baggage Options -->
    <ng-container *ngFor="let baggage of baggageOptions">
      <div class="baggage-option" *ngIf="(baggage.kgs || baggage.Weight) > 0">
        <div class="option-left">
          <i class="fas fa-suitcase-rolling"></i>
          <div class="baggage-text">
            <div class="baggage-weight">Additional {{ baggage.kgs || baggage.Weight }} KG</div>
          </div>
        </div>
        <div class="option-right">
          <div class="baggage-price">â‚¹ {{ baggage.price || baggage.Price }}</div>
          <div class="button-wrapper">
            <button class="add-option-btn" *ngIf="(baggageCounts[baggage.kgs || baggage.Code] || 0) === 0"
              (click)="incrementBaggage(baggage)">
              Add <i class="fas fa-plus"></i>
            </button>
            <div class="counter-wrapper" *ngIf="(baggageCounts[baggage.kgs || baggage.Code] || 0) > 0">
              <button class="counter-btn" (click)="decrementBaggage(baggage)">-</button>
              <div class="counter-value">
                {{ baggageCounts[baggage.kgs || baggage.Code] || 0 }}
              </div>
              <button class="counter-btn" (click)="incrementBaggage(baggage)"
                [disabled]="getTotalOneWayBaggageCount() >= maxAllowedBaggageCount">
                +
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="baggage-footer">
    <div class="baggage-count">{{ getTotalOneWayBaggageCount() }} of {{ maxAllowedBaggageCount }} Baggage(s) Selected</div>
    <div class="footer-right">
      <div class="fare-details">
        <div class="added-to-fare">Added to fare</div>
        <div class="total-price">â‚¹ {{ calculateBaggageTotal() | number : "1.2-2" }}</div>
      </div>
      <button class="baggage-done-btn" (click)="handleOneWayBaggageDone()">DONE</button>
    </div>
  </div>
</div>

<!-- Roundtrip Baggage Modal -->
<div class="baggage-popup baggage-modal" *ngIf="tripType === 'roundtrip' && showAddBaggageModal">
  <div class="trip-header">
    <div>Add Extra Baggage</div>
    <button class="close-btn" (click)="showAddBaggageModal = false">Ã—</button>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activeRoundBaggageTab === 'onward'" (click)="activeRoundBaggageTab = 'onward'">
      Onward
    </div>
    <div [class.active]="activeRoundBaggageTab === 'return'" (click)="activeRoundBaggageTab = 'return'">
      Return
    </div>
  </div>
  <div class="trip-body">
    <div class="tab-content-container">
      <div class="tab-content-wrapper" [class.return-active]="activeRoundBaggageTab === 'return'">
        <!-- Onward Tab -->
        <div class="tab-panel">
          <!-- Flight Route Indicator (Blue Pill - MMT Style) -->
          <div class="baggage-route-pill" *ngIf="flightSegments?.length">
            <div class="route-text">
              {{ flightSegments[0]?.from }}-{{ flightSegments[flightSegments.length - 1]?.to }}
            </div>
            <div class="route-status">{{ activeRoundBaggageTab === 'onward' ? '1 of 2 selected' : '2 of 2 selected' }}</div>
          </div>

          <!-- Included Baggage Info -->
          <div class="included-baggage-info">
            Included Check-in baggage per person - <span class="baggage-amount">15 KGS</span>
          </div>

          <!-- Baggage Options -->
          <ng-container *ngFor="let baggage of baggageOptions">
            <div class="baggage-option" *ngIf="(baggage.kgs || baggage.Weight) > 0">
              <div class="option-left">
                <i class="fas fa-suitcase-rolling"></i>
                <div class="baggage-text">
                  <div class="baggage-weight">Additional {{ baggage.kgs || baggage.Weight }} KG</div>
                </div>
              </div>
              <div class="option-right">
                <div class="baggage-price">â‚¹ {{ baggage.price || baggage.Price }}</div>
                <div class="button-wrapper">
                  <button class="add-option-btn" *ngIf="(onwardBaggageCounts[baggage.kgs || baggage.Code] || 0) === 0"
                    (click)="incrementRoundBaggage(baggage)">
                    Add <i class="fas fa-plus"></i>
                  </button>
                  <div class="counter-wrapper" *ngIf="(onwardBaggageCounts[baggage.kgs || baggage.Code] || 0) > 0">
                    <button class="counter-btn" (click)="decrementRoundBaggage(baggage)">-</button>
                    <div class="counter-value">
                      {{ onwardBaggageCounts[baggage.kgs || baggage.Code] || 0 }}
                    </div>
                    <button class="counter-btn" (click)="incrementRoundBaggage(baggage)"
                      [disabled]="!canAddMoreBaggage()">
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        
        <!-- Return Tab -->
        <div class="tab-panel">
          <!-- Flight Route Indicator (Blue Pill - MMT Style) -->
          <div class="baggage-route-pill" *ngIf="flightSegmentsReturn?.length">
            <div class="route-text">
              {{ flightSegmentsReturn[0]?.from }}-{{ flightSegmentsReturn[flightSegmentsReturn.length - 1]?.to }}
            </div>
            <div class="route-status">{{ activeRoundBaggageTab === 'onward' ? '1 of 2 selected' : '2 of 2 selected' }}</div>
          </div>

          <!-- Included Baggage Info -->
          <div class="included-baggage-info">
            Included Check-in baggage per person - <span class="baggage-amount">15 KGS</span>
          </div>

          <!-- Baggage Options -->
          <ng-container *ngFor="let baggage of baggageOptionsReturn">
            <div class="baggage-option" *ngIf="(baggage.kgs || baggage.Weight) > 0">
              <div class="option-left">
                <i class="fas fa-suitcase-rolling"></i>
                <div class="baggage-text">
                  <div class="baggage-weight">Additional {{ baggage.kgs || baggage.Weight }} KG</div>
                </div>
              </div>
              <div class="option-right">
                <div class="baggage-price">â‚¹ {{ baggage.price || baggage.Price }}</div>
                <div class="button-wrapper">
                  <button class="add-option-btn" *ngIf="(returnBaggageCounts[baggage.kgs || baggage.Code] || 0) === 0"
                    (click)="incrementRoundBaggage(baggage)">
                    Add <i class="fas fa-plus"></i>
                  </button>
                  <div class="counter-wrapper" *ngIf="(returnBaggageCounts[baggage.kgs || baggage.Code] || 0) > 0">
                    <button class="counter-btn" (click)="decrementRoundBaggage(baggage)">-</button>
                    <div class="counter-value">
                      {{ returnBaggageCounts[baggage.kgs || baggage.Code] || 0 }}
                    </div>
                    <button class="counter-btn" (click)="incrementRoundBaggage(baggage)"
                      [disabled]="!canAddMoreBaggage()">
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <div class="baggage-footer">
    <div class="baggage-count">{{ getTotalRoundTripBaggageCount() }} of {{ maxAllowedBaggageCount * 2 }} Baggage(s) Selected</div>
    <div class="footer-right">
      <div class="fare-details">
        <div class="added-to-fare">Added to fare</div>
        <div class="total-price">â‚¹ {{ calculateRoundTripBaggageTotal() | number : "1.2-2" }}</div>
      </div>
      <button class="baggage-done-btn" (click)="handleRoundTripBaggageDone()">DONE</button>
    </div>
  </div>
</div>

<!-- Policy Modal -->
<div class="trip-overlay" *ngIf="showPolicyModal" (click)="showPolicyModal = false"></div>
<div class="trip-popup" *ngIf="showPolicyModal && tripType !== 'roundtrip'">
  <div class="trip-header">
    <div>Cancellation & Rescheduling Policy</div>
    <button class="close-btn" (click)="showPolicyModal = false">Ã—</button>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activeTab === 'cancel'" (click)="activeTab = 'cancel'">
      CANCELLATION
    </div>
    <div [class.active]="activeTab === 'reschedule'" (click)="activeTab = 'reschedule'">
      RESCHEDULE
    </div>
  </div>
  <div class="trip-body">
    <div class="tab-content-container">
      <div class="tab-content-wrapper" [class.return-active]="activeTab === 'reschedule'">
        <div class="tab-panel">
          <div class="trip-flight" *ngFor="let seg of flightSegments">
            <div class="trip-airline">
              <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
              <div>{{ seg.airline }}</div>
              <div class="code">{{ seg.code }}</div>
            </div>
            <table class="policy-table" *ngIf="getCancellationRows(flightDataDeparture).length > 0">
              <tr *ngFor="let row of getCancellationRows(flightDataDeparture)">
                <td>{{ row.range }}</td>
                <td>{{ row.price }}</td>
              </tr>
            </table>
          </div>
        </div>
        <div class="tab-panel">
          <div class="trip-flight" *ngFor="let seg of flightSegments">
            <div class="trip-airline">
              <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
              <div>{{ seg.airline }}</div>
              <div class="code">{{ seg.code }}</div>
            </div>
            <table class="policy-table" *ngIf="getDateChangeRows(flightDataDeparture).length > 0">
              <tr *ngFor="let row of getDateChangeRows(flightDataDeparture)">
                <td>{{ row.range }}</td>
                <td>{{ row.price }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Roundtrip Policy Modal -->
<div class="trip-popup" *ngIf="showPolicyModal && tripType === 'roundtrip'">
  <div class="trip-header">
    <div>Cancellation & Rescheduling Policy</div>
    <button class="close-btn" (click)="showPolicyModal = false">Ã—</button>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activePolicyLeg === 'departure'" (click)="activePolicyLeg = 'departure'">
      DEPARTURE
    </div>
    <div [class.active]="activePolicyLeg === 'return'" (click)="activePolicyLeg = 'return'">
      RETURN
    </div>
  </div>
  <div class="policy-tabs">
    <div [class.active]="activePolicySubTab === 'cancel'" (click)="activePolicySubTab = 'cancel'">
      CANCELLATION
    </div>
    <div [class.active]="activePolicySubTab === 'reschedule'" (click)="activePolicySubTab = 'reschedule'">
      RESCHEDULE
    </div>
  </div>
  <div class="trip-body">
    <div class="tab-content-container">
      <div class="tab-content-wrapper" [class.return-active]="activePolicyLeg === 'return'">
        <div class="tab-panel">
          <div *ngIf="activePolicySubTab === 'cancel'">
            <div class="trip-flight" *ngFor="let seg of flightSegments">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getCancellationRows(flightDataDeparture).length > 0">
                <tr *ngFor="let row of getCancellationRows(flightDataDeparture)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
          <div *ngIf="activePolicySubTab === 'reschedule'">
            <div class="trip-flight" *ngFor="let seg of flightSegments">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getDateChangeRows(flightDataDeparture).length > 0">
                <tr *ngFor="let row of getDateChangeRows(flightDataDeparture)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="tab-panel">
          <div *ngIf="activePolicySubTab === 'cancel'">
            <div class="trip-flight" *ngFor="let seg of flightSegmentsReturn">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getCancellationRows(flightDataReturn).length > 0">
                <tr *ngFor="let row of getCancellationRows(flightDataReturn)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
          <div *ngIf="activePolicySubTab === 'reschedule'">
            <div class="trip-flight" *ngFor="let seg of flightSegmentsReturn">
              <div class="trip-airline">
                <img [src]="'assets/images/flightimages/' + seg.code.split(' ')[0] + '.png'" class="logo" />
                <div>{{ seg.airline }}</div>
                <div class="code">{{ seg.code }}</div>
              </div>
              <table class="policy-table" *ngIf="getDateChangeRows(flightDataReturn).length > 0">
                <tr *ngFor="let row of getDateChangeRows(flightDataReturn)">
                  <td>{{ row.range }}</td>
                  <td>{{ row.price }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GST Modal -->
<div class="trip-overlay" *ngIf="showGSTModal" (click)="closeGSTModal()"></div>
<div class="gst-popup" *ngIf="showGSTModal">
  <div class="gst-header">
    <div>Add GST Details</div>
    <button class="close-btn" (click)="closeGSTModal()">Ã—</button>
  </div>
  <div class="gst-body">
    <div class="gst-note">
      <div class="note-header">
        <i class="fas fa-info-circle"></i>
        <div>NOTE</div>
      </div>
      <div class="note-text">
        This is an optional section. Fill this if you wish to claim GST credit for this booking.
      </div>
    </div>
    <div class="form-group">
      <label>Company Name</label>
      <input type="text" [(ngModel)]="gstDetails.companyName" placeholder="Enter company name" />
    </div>
    <div class="form-group">
      <label>Company Billing Address</label>
      <textarea [(ngModel)]="gstDetails.companyAddress" placeholder="Enter billing address" rows="3"></textarea>
    </div>
    <div class="form-group">
      <label>Company Phone Number</label>
      <input type="tel" [(ngModel)]="gstDetails.companyPhone" placeholder="Enter phone number" />
    </div>
    <div class="form-group">
      <label>Company Email Address</label>
      <input type="email" [(ngModel)]="gstDetails.companyEmail" placeholder="Enter email address" />
    </div>
    <div class="form-group">
      <label>GST Number</label>
      <input type="text" [(ngModel)]="gstDetails.gstNumber" placeholder="Enter GST number" />
    </div>
  </div>
  <div class="gst-footer">
    <button class="proceed-btn" (click)="saveGSTDetails()">DONE</button>
  </div>
</div>

<!-- Passenger Details Modal (Mobile Only) -->
<div class="trip-overlay" *ngIf="showPassengerModal && isMobileView()" (click)="closePassengerModal()"></div>
<div class="trip-popup" *ngIf="showPassengerModal && isMobileView()">
  <div class="trip-header">
    <div>Add Passenger Details</div>
    <button class="close-btn" (click)="closePassengerModal()">Ã—</button>
  </div>
  <div class="trip-body">
    <div class="form-group">
      <label>First Name</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.firstName" placeholder="Enter first name" [class.error]="passengerValidationErrors.firstName" />
      <div class="error-message" *ngIf="passengerValidationErrors.firstName">{{ passengerValidationErrors.firstName }}</div>
    </div>
    <div class="form-group">
      <label>Last Name</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.lastName" placeholder="Enter last name" [class.error]="passengerValidationErrors.lastName" />
      <div class="error-message" *ngIf="passengerValidationErrors.lastName">{{ passengerValidationErrors.lastName }}</div>
    </div>
    <div class="form-group">
      <label>Gender</label>
      <select [(ngModel)]="currentPassengerDetails.gender" required [class.error]="passengerValidationErrors.gender">
        <option value="" disabled selected>Select gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <div class="error-message" *ngIf="passengerValidationErrors.gender">{{ passengerValidationErrors.gender }}</div>
    </div>
    <div class="form-group">
      <label>Date of Birth</label>
      <div class="input-group-row">
        <select [(ngModel)]="currentPassengerDetails.dobDay" [class.error]="passengerValidationErrors.dobDay">
          <option value="">DD</option>
          <option *ngFor="let day of days" [value]="day">{{ day }}</option>
        </select>
        <select [(ngModel)]="currentPassengerDetails.dobMonth" [class.error]="passengerValidationErrors.dobMonth">
          <option value="">MM</option>
          <option *ngFor="let month of months" [value]="month">{{ month }}</option>
        </select>
        <select [(ngModel)]="currentPassengerDetails.dobYear" [class.error]="passengerValidationErrors.dobYear">
          <option value="">YYYY</option>
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>
      </div>
      <div class="error-message" *ngIf="passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear">
        {{ passengerValidationErrors.dobDay || passengerValidationErrors.dobMonth || passengerValidationErrors.dobYear }}
      </div>
    </div>
    <div class="form-group" *ngIf="currentPassengerType === 'adult'">
      <label>Mobile Number</label>
      <div class="phone-row">
        <select class="dial-select" [(ngModel)]="currentPassengerDetails.mobileDialCode">
          <option value="+91">IN +91</option>
          <option value="+1">US +1</option>
          <option value="+44">UK +44</option>
          <option value="+61">AU +61</option>
          <option value="+971">AE +971</option>
          <option value="+65">SG +65</option>
          <option value="+60">MY +60</option>
          <option value="+66">TH +66</option>
          <option value="+62">ID +62</option>
          <option value="+63">PH +63</option>
          <option value="+84">VN +84</option>
          <option value="+86">CN +86</option>
          <option value="+81">JP +81</option>
          <option value="+82">KR +82</option>
          <option value="+33">FR +33</option>
          <option value="+49">DE +49</option>
          <option value="+39">IT +39</option>
          <option value="+34">ES +34</option>
          <option value="+31">NL +31</option>
          <option value="+32">BE +32</option>
          <option value="+41">CH +41</option>
          <option value="+43">AT +43</option>
          <option value="+46">SE +46</option>
          <option value="+47">NO +47</option>
          <option value="+45">DK +45</option>
          <option value="+358">FI +358</option>
          <option value="+353">IE +353</option>
          <option value="+351">PT +351</option>
          <option value="+30">GR +30</option>
          <option value="+48">PL +48</option>
          <option value="+420">CZ +420</option>
          <option value="+36">HU +36</option>
          <option value="+40">RO +40</option>
          <option value="+7">RU +7</option>
          <option value="+27">ZA +27</option>
          <option value="+20">EG +20</option>
          <option value="+52">MX +52</option>
          <option value="+55">BR +55</option>
          <option value="+54">AR +54</option>
          <option value="+56">CL +56</option>
          <option value="+57">CO +57</option>
          <option value="+51">PE +51</option>
          <option value="+64">NZ +64</option>
        </select>
        <input
        type="tel"
         name="contactMobile"
         #contactMobileInput
        [(ngModel)]="currentPassengerDetails.mobileNumber"
        placeholder="10-digit mobile starts 6-9"
        maxlength="10"
        [readonly]="isMobileView()"
        [attr.inputmode]="isMobileView() ? 'none' : 'numeric'"
        (click)="openPhoneDialer('primary', $event)"
        (focus)="isMobileView() && openPhoneDialer('primary', $event)"
        [class.error]="passengerValidationErrors.mobileNumber"
      />
      </div>
      <div class="error-message" *ngIf="passengerValidationErrors.mobileNumber">{{ passengerValidationErrors.mobileNumber }}</div>
    </div>
    <div class="form-group" *ngIf="currentPassengerType === 'adult'">
      <label>Email</label>
      <input type="email" [(ngModel)]="currentPassengerDetails.email" placeholder="Enter email" [class.error]="passengerValidationErrors.email" />
      <div class="error-message" *ngIf="passengerValidationErrors.email">{{ passengerValidationErrors.email }}</div>
    </div>
    <div class="form-group checkbox-group" *ngIf="currentPassengerType !== 'infant'">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="currentPassengerDetails.requiresWheelchair" />
        <span>Optional - This passenger requires a wheelchair</span>
      </label>
    </div>
    <div class="form-group" *ngIf="passportInfoRequired">
      <label>Passport Number</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.passportNumber" placeholder="Enter passport number" [class.error]="passengerValidationErrors.passportNumber" />
      <div class="error-message" *ngIf="passengerValidationErrors.passportNumber">{{ passengerValidationErrors.passportNumber }}</div>
    </div>
    <div class="form-group" *ngIf="panInfoRequired">
      <label>PAN Number</label>
      <input type="text" [(ngModel)]="currentPassengerDetails.panNumber" placeholder="Enter PAN number" [class.error]="passengerValidationErrors.panNumber" />
      <div class="error-message" *ngIf="passengerValidationErrors.panNumber">{{ passengerValidationErrors.panNumber }}</div>
    </div>
  </div>
  <div class="trip-footer">
    <button class="proceed-btn" (click)="savePassengerDetails(currentPassengerDetails)">SAVE</button>
  </div>
</div>

<!-- Fare Rules Modal -->
<div *ngIf="showFareRules" class="trip-overlay" (click)="showFareRules = false"></div>
<div *ngIf="showFareRules" class="trip-popup fare-summary-modal">
  <div class="trip-header">
    Fare Rules
    <button class="modal-close-btn" (click)="showFareRules = false">Ã—</button>
  </div>
  <div class="trip-body">
    <div class="fare-tabs" *ngIf="tripType === 'roundtrip'">
      <div class="fare-tab" [class.fare-tab-active]="fareTab === 'onward'" (click)="fareTab = 'onward'">
        Onward
      </div>
      <div class="fare-tab" [class.fare-tab-active]="fareTab === 'return'" (click)="fareTab = 'return'">
        Return
      </div>
    </div>
    <div *ngIf="tripType === 'roundtrip'" class="fare-tab-panels">
      <div *ngIf="fareTab === 'onward'" class="fare-tab-panel">
        <div class="fare-info-text" *ngIf="fareRuleText" [innerHTML]="fareRuleText"></div>
        <div class="fare-info-text" *ngIf="!fareRuleText">Fare rules not available.</div>
      </div>
      <div *ngIf="fareTab === 'return'" class="fare-tab-panel">
        <div class="fare-info-text" *ngIf="fareRuleTextReturn" [innerHTML]="fareRuleTextReturn"></div>
        <div class="fare-info-text" *ngIf="!fareRuleTextReturn">Fare rules not available.</div>
      </div>
    </div>
    <div *ngIf="tripType !== 'roundtrip'">
      <div class="fare-info-text" *ngIf="fareRuleText" [innerHTML]="fareRuleText"></div>
      <div class="fare-info-text" *ngIf="!fareRuleText">Fare rules not available.</div>
    </div>
  </div>
  <div class="trip-footer">
    <button class="proceed-btn" (click)="showFareRules = false">DONE</button>
  </div>
</div>


<app-phone-dialer
[isVisible]="showPhoneDialer"
[currentValue]="getCurrentDialerValue()"
[maxLength]="10"
(numberClick)="onDialerNumberClick($event)"
(backspaceClick)="onDialerBackspace()"
(doneClick)="onDialerDone()"
(closeDialer)="closePhoneDialer()"
></app-phone-dialer>