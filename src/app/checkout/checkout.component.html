<!-- Booking Summary Band - Desktop Version -->
<div class="booking-summary desktop-booking-summary" [class.sticky]="isHeaderSticky" *ngIf="bookingData">
  <div class="container">
    <div class="summary-content">
      <div class="summary-info">
        <div class="route-summary">
          <div class="route-locations">
            <div class="location-group">
              <span class="from">{{ bookingData.searchParams.from }}</span>
              <span class="location-detail" *ngIf="bookingData.searchParams.pickupLocation">{{ bookingData.searchParams.pickupLocation }}</span>
            </div>
            <i class="fas fa-arrow-right"></i>
            <div class="location-group">
              <span class="to">{{ bookingData.searchParams.to }}</span>
              <span class="location-detail" *ngIf="bookingData.searchParams.dropLocation">{{ bookingData.searchParams.dropLocation }}</span>
            </div>
          </div>
          <div class="journey-details">
            <span class="date">{{ formatDate(bookingData.searchParams.date) }}</span>
            <span class="pickup-time" *ngIf="bookingData.bookingType === 'reserved' && bookingData.searchParams.pickupTime">{{ formatPickupTime(bookingData.searchParams.pickupTime) }}</span>
            <span class="pickup-time" *ngIf="bookingData.bookingType === 'shared' && bookingData.vehicleDetails?.departureTime">{{ formatPickupTime(bookingData.vehicleDetails.departureTime) }}</span>
            <span class="passengers">{{ bookingData.searchParams.passengers }} seats</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Summary Band - Mobile Version -->
<div class="booking-summary mobile-booking-summary" [class.sticky]="isHeaderSticky" *ngIf="bookingData">
  <div class="container">
    <div class="summary-content">
      <div class="summary-info">
        <!-- Route Section -->
        <div class="route">
          <!-- Top Row: City Codes and Route Line -->
          <div class="route-top-row">
            <div class="route-column">
              <div class="route-code">{{ bookingData.vehicleDetails?.route?.from?.code || getLocationCode(bookingData.searchParams.from) }}</div>
            </div>

            <div class="route-visualization">
              <div class="route-line">
                <div class="route-node start-node"></div>
                <div class="route-car">
                  <img src="../../assets/images/bgremovecar.png" alt="Car">
                </div>
                <div class="route-node end-node"></div>
              </div>
            </div>

            <div class="route-column">
              <div class="route-code">{{ bookingData.vehicleDetails?.route?.to?.code || getLocationCode(bookingData.searchParams.to) }}</div>
            </div>
          </div>

          <!-- Bottom Row: Location Names -->
          <div class="route-bottom-row">
            <div class="route-column">
              <div class="location">{{ bookingData.searchParams.from }}</div>
              <div class="sub-location" *ngIf="bookingData.searchParams.pickupLocation">{{ bookingData.searchParams.pickupLocation }}</div>
            </div>

            <div class="route-visualization-spacer"></div>

            <div class="route-column">
              <div class="location">{{ bookingData.searchParams.to }}</div>
              <div class="sub-location" *ngIf="bookingData.searchParams.dropLocation">{{ bookingData.searchParams.dropLocation }}</div>
            </div>
          </div>
        </div>

        <!-- Journey Timing Section -->
        <div class="journey-timing">
          <div class="timing-item-left">
            <span class="date-text">{{ formatDate(bookingData.searchParams.date) }}</span>
            <span class="time-pill" *ngIf="bookingData.bookingType === 'reserved' && bookingData.searchParams.pickupTime">
              {{ formatPickupTime(bookingData.searchParams.pickupTime) }}
            </span>
            <span class="time-pill" *ngIf="bookingData.bookingType === 'shared' && bookingData.vehicleDetails?.departureTime">
              {{ formatPickupTime(bookingData.vehicleDetails.departureTime) }}
            </span>
          </div>
          <div class="timing-item-right">
            <span class="duration-label">Duration</span>
            <span class="duration-pill" *ngIf="bookingData.vehicleDetails?.duration">
              {{ formatDuration(bookingData.vehicleDetails.duration).replace(' ', '') }}
            </span>
          </div>
        </div>

        <!-- Vehicle and Seat Details Section -->
        <div class="vehicle-seat-section">
          <div class="vehicle-info">
            <img [src]="bookingData.vehicleDetails.image" [alt]="bookingData.vehicleDetails.name" *ngIf="bookingData.vehicleDetails">
            <div class="vehicle-name" *ngIf="bookingData.vehicleDetails">{{ bookingData.vehicleDetails.name }}</div>
          </div>
          <div class="seat-info">
            <span *ngIf="bookingData.bookingType === 'shared'">Seat No. Selected :{{ getSelectedSeats() }}</span>
            <span *ngIf="bookingData.bookingType === 'reserved'">Total Seats: {{ bookingData.searchParams.passengers }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="checkout-container">
  <div class="container">
    <div class="checkout-content">
      
      <!-- Left Column: Passenger Details Form -->
      <div class="left-column">
        <div class="form-card">
          <h2 class="form-title"> Primary Passenger Details</h2>
          
          <form (ngSubmit)="onSubmit()" #checkoutForm="ngForm">
            <div class="form-row">
              <div class="form-field">
                <label class="field-label">First Name</label>
                <input 
                  type="text" 
                  class="field-input" 
                  placeholder="Enter First Name of Primary Passenger."
                  [(ngModel)]="passengerDetails.firstName"
                  name="firstName"
                  required>
              </div>
              
              <div class="form-field">
                <label class="field-label">Last Name</label>
                <input 
                  type="text" 
                  class="field-input" 
                  placeholder="Enter Last Name of Primary Passenger."
                  [(ngModel)]="passengerDetails.lastName"
                  name="lastName"
                  required>
              </div>
            </div>
            
            <div class="form-field">
              <label class="field-label">Email ID</label>
              <input 
                type="email" 
                class="field-input" 
                placeholder="Enter Email ID of Primary Passenger (for e-ticket)."
                [(ngModel)]="passengerDetails.emailId"
                name="emailId"
                required>
            </div>
            
            <div class="form-field">
              <label class="field-label">Primary Contact No</label>
              <div class="contact-input-group">
                <select class="country-code-select" [(ngModel)]="passengerDetails.primaryCountryCode" name="primaryCountryCode">
                  <option *ngFor="let country of countryList" [value]="country.code">
                    {{ country.code }} - {{ country.name }}
                  </option>
                </select>
                <input 
                  type="tel" 
                  class="field-input phone-input" 
                  placeholder="Enter Primary Phone No."
                  [(ngModel)]="passengerDetails.primaryContactNo"
                  name="primaryContactNo"
                  maxlength="10"
                  pattern="[0-9]{10}"
                  required>
              </div>
            </div>
            
            <div class="form-field">
              <label class="field-label">Alternate Contact No</label>
              <div class="contact-input-group">
                <select class="country-code-select" [(ngModel)]="passengerDetails.alternateCountryCode" name="alternateCountryCode">
                  <option *ngFor="let country of countryList" [value]="country.code">
                    {{ country.code }} - {{ country.name }}
                  </option>
                </select>
                <input 
                  type="tel" 
                  class="field-input phone-input" 
                  placeholder="Enter Alternate Phone No."
                  [(ngModel)]="passengerDetails.alternateContactNo"
                  name="alternateContactNo"
                  maxlength="10"
                  pattern="[0-9]{10}">
              </div>
            </div>
          </form>
        </div>
      </div>
      
      <!-- Right Column -->
      <div class="right-column">
        
        <!-- Options Card -->
        <div class="options-card">
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="passengerDetails.isBusinessTravel"
                name="isBusinessTravel">
              <span class="checkmark"></span>
              Yes, I am travelling for Business.
            </label>
            
            <!-- GST Number Input Field (Conditional - shows when business travel is checked) -->
            <div class="gst-section" *ngIf="passengerDetails.isBusinessTravel">
              <div class="form-field">
                <label class="field-label">GST Number (Optional)</label>
                <input 
                  type="text" 
                  class="field-input" 
                  placeholder="Enter GST Number"
                  [(ngModel)]="gstNumber"
                  name="gstNumber">
              </div>
            </div>
            
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="passengerDetails.hasDiscountCoupon"
                name="hasDiscountCoupon">
              <span class="checkmark"></span>
              Yes, I have a Discount Coupon.
            </label>
            
            <!-- Coupon Code Input Field (Conditional) -->
            <div class="coupon-section" *ngIf="passengerDetails.hasDiscountCoupon">
              <div class="coupon-input-group">
                <input 
                  type="text" 
                  class="coupon-input" 
                  placeholder="Enter your coupon code"
                  [(ngModel)]="passengerDetails.couponCode"
                  name="couponCode">
                <button 
                  type="button" 
                  class="coupon-submit-btn"
                  (click)="onCouponSubmit()">
                  Apply
                </button>
              </div>
            </div>
            
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="passengerDetails.hasTravelInsurance"
                name="hasTravelInsurance"
                (change)="onTravelInsuranceChange()">
              <span class="checkmark"></span>
              Yes, I want to add Travel Insurance for ₹99.
            </label>
          </div>
        </div>
        
        <!-- Fare Details Card -->
        <div class="fare-card">
          <h3 class="fare-title">Fare Details</h3>
          
          <div class="fare-breakdown">
            <div class="fare-item">
              <span class="fare-label">Ride Fare (in Rs.):</span>
              <span class="fare-amount">₹ {{ rideFare.toFixed(2) }}</span>
            </div>
            
            <div class="fare-item">
              <span class="fare-label">Goods & Services Tax (in Rs.):</span>
              <span class="fare-amount">₹ {{ gstAmount.toFixed(2) }}</span>
            </div>
            
            <div class="fare-item" *ngIf="travelInsuranceCost > 0">
              <span class="fare-label">Travel Insurance (in Rs.):</span>
              <span class="fare-amount">₹ {{ travelInsuranceCost.toFixed(2) }}</span>
            </div>
            
            <div class="fare-item" *ngIf="deficitAmount > 0">
              <span class="fare-label">Deficit Amount (Previous Due) (in Rs.):</span>
              <span class="fare-amount">₹ {{ getRoundedDeficitAmount() }}</span>
            </div>
          </div>
          
          <div class="total-fare">
            <span class="total-label">Total Fare (in Rs.):</span>
            <span class="total-amount">₹ {{ getDisplayTotalFare() }}</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Legal Text and Payment Button -->
    <div class="legal-section">
      <p class="legal-text">
        By clicking on the PROCEED TO PAYMENT Button, you agree to our 
        <a href="https://wizzride.com/cancellationpolicy/termsandconditions" target="_blank" class="legal-link">Terms & Conditions</a> of Wizzride Shared Cabs and that you have read our 
        <a href="https://wizzride.com/cancellationpolicy/termsandconditions" target="_blank" class="legal-link">Privacy Policy</a> and 
        <a href="https://wizzride.com/cancellationpolicy/useragreement" target="_blank" class="legal-link">User Agreement</a>
      </p>
      <p class="legal-text">
        Also, please make sure to check our 
        <a href="https://wizzride.com/cancellationpolicy" target="_blank" class="legal-link">Cancellation Policy</a>.
      </p>
      
      <button 
        type="button"
        class="proceed-payment-btn" 
        (click)="onSubmit($event)"
        [disabled]="isCheckingDeficit">
        <span *ngIf="isCheckingDeficit">Checking...</span>
        <span *ngIf="!isCheckingDeficit">Proceed to Payment</span>
      </button>
    </div>
  </div>
</div>
