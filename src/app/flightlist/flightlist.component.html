<div class="flight-list-wrapper" *ngIf="isBrowser">
  <!-- Shimmer Loading -->
  <div *ngIf="loader">
    <div class="shimmer-container container">
      <!-- Sidebar Shimmer (Desktop) -->
      <div class="shimmer-sidebar" *ngIf="flightType !== 'multi'">
        <div class="shimmer-elem h-40 w-100" style="margin-bottom: 20px;"></div>
        <div class="shimmer-elem h-20 w-80" style="margin-bottom: 10px;"></div>
        <div class="shimmer-elem h-20 w-60" style="margin-bottom: 30px;"></div>
        <div class="shimmer-elem h-20 w-100" style="margin-bottom: 15px;"></div>
        <div class="shimmer-elem h-10 w-100" style="margin-bottom: 10px;"></div>
        <div class="shimmer-elem h-10 w-100" style="margin-bottom: 10px;"></div>
      </div>

      <!-- Results Shimmer -->
      <div class="shimmer-results">
        <!-- Date Slider Shimmer (Desktop) -->
        <div class="shimmer-elem h-60 w-100 desktophid" style="margin-bottom: 20px;" *ngIf="flightType === 'oneway'">
        </div>

        <!-- Flight Cards Shimmer Loop -->
        <div class="shimmer-card" *ngFor="let i of [1,2,3,4,5]">
          <!-- Desktop Layout -->
          <div class="desktop-shimmer-layout">
            <!-- Airline -->
            <div class="shimmer-col" style="width: 15%;">
              <div class="shimmer-row">
                <div class="shimmer-elem shimmer-circle h-40 w-40" style="width: 40px;"></div>
                <div class="shimmer-col flex-1">
                  <div class="shimmer-elem h-14 w-80"></div>
                  <div class="shimmer-elem h-10 w-60"></div>
                </div>
              </div>
            </div>

            <!-- Departure -->
            <div class="shimmer-col" style="width: 15%;">
              <div class="shimmer-elem h-20 w-60"></div>
              <div class="shimmer-elem h-14 w-80"></div>
              <div class="shimmer-elem h-14 w-40"></div>
            </div>

            <!-- Duration -->
            <div class="shimmer-col" style="width: 20%; align-items: center;">
              <div class="shimmer-elem h-14 w-40"></div>
              <div class="shimmer-elem h-10 w-80" style="margin: 5px 0;"></div>
              <div class="shimmer-elem h-14 w-60"></div>
            </div>

            <!-- Arrival -->
            <div class="shimmer-col" style="width: 15%;">
              <div class="shimmer-elem h-20 w-60"></div>
              <div class="shimmer-elem h-14 w-80"></div>
              <div class="shimmer-elem h-14 w-40"></div>
            </div>

            <!-- Price & Button -->
            <div class="shimmer-col" style="width: 20%; align-items: flex-end;">
              <div class="shimmer-elem h-24 w-60"></div>
              <div class="shimmer-elem h-10 w-40"></div>
              <div class="shimmer-elem h-40 w-100" style="margin-top: 10px; border-radius: 20px;"></div>
            </div>
          </div>

          <!-- Mobile Layout -->
          <div class="mobile-shimmer-layout">
            <!-- Header -->
            <div class="shimmer-row">
              <div class="shimmer-elem shimmer-circle h-30 w-30" style="width: 30px;"></div>
              <div class="shimmer-elem h-14 w-40"></div>
              <div class="shimmer-elem h-14 w-20" style="margin-left: auto;"></div>
            </div>

            <!-- Flight Row -->
            <div class="shimmer-row" style="justify-content: space-between;">
              <div class="shimmer-col">
                <div class="shimmer-elem h-20 w-60"></div>
                <div class="shimmer-elem h-14 w-80"></div>
              </div>

              <div class="shimmer-col" style="align-items: center;">
                <div class="shimmer-elem h-20 w-20"></div>
                <div class="shimmer-elem h-10 w-60"></div>
              </div>

              <div class="shimmer-col" style="align-items: flex-end;">
                <div class="shimmer-elem h-20 w-60"></div>
                <div class="shimmer-elem h-14 w-80"></div>
              </div>
            </div>

            <div class="shimmer-elem h-1" style="width: 100%; height: 1px; margin: 5px 0;"></div>

            <!-- Footer -->
            <div class="shimmer-row" style="justify-content: space-between;">
              <div class="shimmer-col">
                <div class="shimmer-elem h-20 w-80"></div>
              </div>
              <div class="shimmer-elem h-30 w-30" style="width: 100px; border-radius: 15px;"></div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loader">
    <!-- Search Summary Bar (matching booking-results design) -->
    <div class="search-summary" [class.sticky]="isHeaderSticky" *ngIf="flightInputData">
      <div class="container">
        <!-- Mobile Summary (new design) -->
        <div class="summary-content mobile-summary" [class.multicitysumm]="flightType === 'multi'">
          <section class="m-flight-summary">
            <!-- ROUTE BOX -->
            <div class="m-flight-box">
              <div class="m-flight-route-main">
                <!-- Multi-City Route Display -->
                <div class="m-flight-route"
                  *ngIf="flightType === 'multi' && multicityTabData && multicityTabData.length > 0">
                  <ng-container *ngFor="let segment of multicityTabData; let i = index">
                    <span>{{ getMultiCityRouteOrigin(i) }}</span>
                    âœˆ
                    <span>{{ getMultiCityRouteDestination(i) }}</span>
                    <span *ngIf="i < multicityTabData.length - 1" style="margin: 0 4px; color: #cbd5e1;">|</span>
                  </ng-container>
                </div>
                <!-- One-Way / Round-Trip Route Display -->
                <div class="m-flight-route" *ngIf="flightType !== 'multi'">
                  <span>
                    {{ flightInputData['fromCity'] || flightInputData['fromAirport'] }}
                    <small *ngIf="flightInputData['fromAirportCode']">({{ flightInputData['fromAirportCode'] }})</small>
                  </span>
                  âœˆ
                  <span>
                    {{ flightInputData['toCity'] || flightInputData['toAirport'] }}
                    <small *ngIf="flightInputData['toAirportCode']">({{ flightInputData['toAirportCode'] }})</small>
                  </span>
                </div>
                <button class="modify-btn" *ngIf="flightType !== 'multi'" (click)="showModifyForm = !showModifyForm"
                  title="Modify">
                  <i class="fas fa-edit"></i>
                </button>
              </div>

              <!-- Meta Pills -->
              <div class="m-flight-route-meta">
                <span class="m-flight-pill" *ngIf="flightType !== 'multi'">{{ flightInputData['departureDate'] | date :
                  "d MMM, yyyy" }}</span>
                <span class="m-flight-pill" *ngIf="flightType === 'round' && flightInputData['returnDate']">{{
                  flightInputData['returnDate'] | date : "d MMM, yyyy" }}</span>
                <span class="m-flight-pill">{{ totalPassengers }} {{ totalPassengers > 1 ? 'Passenger' : 'Passenger'
                  }}</span>
                <span class="m-flight-pill" *ngIf="modifySearchForm.get('travelClass')?.value">{{
                  modifySearchForm.get('travelClass')?.value }}</span>
              </div>
            </div>

            <!-- FILTERS BOX - Only for non-multi-city flights -->
            <div class="m-flight-box m-flight-filter-box" *ngIf="flightType !== 'multi'">
              <span class="m-flight-filter-chip" [class.active]="selectedStops.includes(0)"
                (click)="toggleNonStopFilter()">Non Stop</span>
              <span class="m-flight-filter-chip" [class.active]="showRefundableOnly"
                (click)="toggleRefundableFilter()">Refundable</span>
              <span class="m-flight-filter-chip" [class.active]="selectedAirlines.length > 0"
                (click)="showMobileFilter = true; mobileFilterActiveTab = 'filter'">Airlines</span>
              <button class="mobile-filter-icon-btn" (click)="showMobileFilter = !showMobileFilter">
                <i class="fas fa-sliders-h"></i>
              </button>
            </div>

            <!-- DATE STRIP - Only for one-way flights -->
            <div class="m-flight-box m-flight-date-box"
              *ngIf="flightType === 'oneway' && datePrices && datePrices.length > 0">
              <div class="m-flight-date-strip-wrapper">
                <div class="m-flight-date-strip">
                  <!-- Month pill at the start -->
                  <div class="m-flight-month-pill">
                    {{ flightInputData['departureDate'] | date : "MMM" | uppercase }}
                  </div>

                  <!-- Date chips -->
                  <button class="m-flight-date-chip" *ngFor="let item of datePrices?.slice(0, 7); let i = index"
                    [class.active]="item.date === highlightedDate" (click)="selectDateFromSlider(item.date, i)">
                    <span class="m-flight-date-text">{{ item.date | date : "EEE, MMM d" }}</span>
                    <span class="m-flight-price" [ngClass]="item.date === highlightedDate ? 'blue' : 'green'">â‚¹ {{
                      item.price | number : "1.0-0"
                      }}</span>
                  </button>

                  <!-- Calendar icon button -->
                  <!-- <button class="m-flight-calendar-chip" title="Open Calendar">
                    <div class="m-flight-calendar-grid">
                      <span></span><span></span><span></span><span></span>
                      <span></span><span></span><span></span><span></span>
                      <span></span><span></span><span></span><span></span>
                    </div>
                  </button> -->
                </div>
              </div>
            </div>

            <!-- INFO BOX - Only for non-multi-city flights -->
            <div class="m-flight-box m-flight-info-box" *ngIf="flightType !== 'multi'">
              <span class="m-flight-sort-pill">{{ getMobileVisibleFlightsCount() }} Flights Found</span>
              <span class="m-flight-sort-pill" (click)="showMobileFilter = true; mobileFilterActiveTab = 'sort'">
                {{ selectedSort || 'Cheapest First' }}
              </span>
            </div>

            <!-- NOTE -->
            <!-- <p class="m-flight-note" *ngIf="flightType !== 'multi'">
              ðŸ”” Wizzride doesn't charge any convenience fee or service charge.
            </p> -->
          </section>
        </div>

        <!-- Desktop Neomorphism Summary (new design) -->
        <div class="desktop-summary-card" *ngIf="flightType !== 'multi'">
          <div class="summary-section city-select" (click)="toggleEditField('from'); $event.stopPropagation()"
            [class.editing]="editField === 'from'">
            <div class="summary-label">From</div>
            <div class="summary-value" *ngIf="editField !== 'from'">{{ flightInputData['fromCity'] ||
              flightInputData['fromAirport'] }}</div>
            <div class="input-with-icon" *ngIf="editField === 'from'" (click)="$event.stopPropagation()">
              <i class="fas fa-location-dot input-icon"></i>
              <input type="text" class="summary-input city-input" [value]="flightInputData['fromCity'] || ''"
                placeholder="Type city or airport" (focus)="showCitySuggestionsOnFocus('summary-from')"
                (input)="onFromInputChange($any($event.target).value); $event.stopPropagation(); $event.preventDefault()"
                (keydown.enter)="$event.preventDefault(); $event.stopPropagation()" (keydown)="$event.stopPropagation()"
                (blur)="onFromBlur()" autofocus />
            </div>
            <div class="city-suggestions" [class.active]="editField === 'from'" *ngIf="editField === 'from'">
              <ng-container
                *ngIf="isCityArray(activeSuggestions['summary-from']) && activeSuggestions['summary-from'].length > 0">
                <div *ngFor="let city of activeSuggestions['summary-from']" class="city-suggestion"
                  (mousedown)="$event.preventDefault()"
                  (click)="selectCity(city.name, city.code, 'summary-from', $event); $event.stopPropagation()">
                  <i class="fas fa-plane-departure city-suggestion-icon"></i>
                  <div class="city-suggestion-content">
                    <div class="city-suggestion-city-country">{{city.name}}, {{city.country || city.state || ''}}</div>
                    <div class="city-suggestion-airport-name">{{city.airport || city.name}}</div>
                  </div>
                  <span class="city-suggestion-code">[ {{city.code}} ]</span>
                </div>
              </ng-container>
              <div
                *ngIf="!isCityArray(activeSuggestions['summary-from']) || activeSuggestions['summary-from']?.length === 0"
                class="city-suggestion" style="padding: 20px; text-align: center; color: #9ca3af;">
                <i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>
                Loading airports...
              </div>
            </div>
            <div class="summary-detail" *ngIf="editField !== 'from'">
              {{ flightInputData['fromCity'] || flightInputData['fromAirport'] }}{{ flightInputData['fromAirportCode'] ?
              ', ' + flightInputData['fromAirportCode'] : '' }}
            </div>
          </div>
          <div class="summary-divider"></div>
          <div class="summary-section city-select" (click)="toggleEditField('to'); $event.stopPropagation()"
            [class.editing]="editField === 'to'" [class.field-open]="editField === 'to'">
            <div class="summary-label">To</div>
            <div class="summary-value" *ngIf="editField !== 'to'">{{ flightInputData['toCity'] ||
              flightInputData['toAirport'] }}</div>
            <div class="input-with-icon" *ngIf="editField === 'to'" (click)="$event.stopPropagation()">
              <i class="fas fa-location-dot input-icon"></i>
              <input type="text" class="summary-input city-input" [value]="flightInputData['toCity'] || ''"
                placeholder="Type city or airport" (focus)="showCitySuggestionsOnFocus('summary-to')"
                (input)="onToInputChange($any($event.target).value); $event.stopPropagation(); $event.preventDefault()"
                (keydown.enter)="$event.preventDefault(); $event.stopPropagation()" (keydown)="$event.stopPropagation()"
                (blur)="onToBlur()" autofocus />
            </div>
            <div class="city-suggestions" [class.active]="editField === 'to'" *ngIf="editField === 'to'">
              <ng-container
                *ngIf="isCityArray(activeSuggestions['summary-to']) && activeSuggestions['summary-to'].length > 0">
                <div *ngFor="let city of activeSuggestions['summary-to']" class="city-suggestion"
                  (mousedown)="$event.preventDefault()"
                  (click)="selectCity(city.name, city.code, 'summary-to', $event); $event.stopPropagation()">
                  <i class="fas fa-plane-arrival city-suggestion-icon"></i>
                  <div class="city-suggestion-content">
                    <div class="city-suggestion-city-country">{{city.name}}, {{city.country || city.state || ''}}</div>
                    <div class="city-suggestion-airport-name">{{city.airport || city.name}}</div>
                  </div>
                  <span class="city-suggestion-code">[ {{city.code}} ]</span>
                </div>
              </ng-container>
            </div>
            <div class="summary-detail" *ngIf="editField !== 'to'">
              {{ flightInputData['toCity'] || flightInputData['toAirport'] }}{{ flightInputData['toAirportCode'] ? ', '
              + flightInputData['toAirportCode'] : '' }}
            </div>
          </div>
          <div class="summary-divider"></div>
          <div class="summary-section date-select" (click)="toggleEditField('departure'); $event.stopPropagation()"
            [class.editing]="editField === 'departure'">
            <div class="summary-label">Departure</div>
            <div class="summary-value" *ngIf="editField !== 'departure'">{{ flightInputData['departureDate'] | date :
              "dd MMM'yy" }}</div>
            <div *ngIf="editField === 'departure'" (click)="$event.stopPropagation()" class="calendar-wrapper">
              <app-custom-calendar #flightlistDepartureCalendar
                [selectedDate]="modifySearchForm.get('departureDate')?.value" [minDate]="getTodayDate()"
                placeholder="Select Departure Date"
                (dateSelected)="onModifyDepartureDateSelected($event); editField = null"
                (calendarOpened)="onCalendarOpened()" (calendarClosed)="onCalendarClosed(); editField = null">
              </app-custom-calendar>
            </div>
            <div class="summary-detail" *ngIf="editField !== 'departure'">{{ flightInputData['departureDate'] | date :
              "EEEE" }}</div>
          </div>
          <div class="summary-divider"></div>
          <div class="summary-section travelers-dropdown"
            (click)="toggleEditField('travellers'); $event.stopPropagation()"
            [class.editing]="editField === 'travellers'">
            <div class="summary-label">Travellers & Class</div>
            <div class="summary-value" *ngIf="editField !== 'travellers'">{{ getTravelersText() }}</div>
            <div class="summary-detail" *ngIf="editField !== 'travellers'">{{ modifySearchForm.get('travelClass')?.value
              || 'Economy' }}</div>
            <div *ngIf="editField === 'travellers'" (click)="$event.stopPropagation()">
              <button class="travelers-btn" (click)="toggleTravelersPanel(); $event.stopPropagation()">
                <span>{{ getTravelersText() }}</span>
              </button>
              <div class="travelers-panel" [class.active]="isTravelersOpen">
                <h3>Travellers</h3>
                <div class="traveler-row">
                  <div class="traveler-info">
                    <h4>Adults</h4>
                    <p>12 yrs or above</p>
                  </div>
                  <div class="counter">
                    <button class="counter-btn" [disabled]="!canDecrease('adults')" [class.active]="counts.adults > 1"
                      (click)="updateCount('adults', -1)">-</button>
                    <span class="counter-value">{{counts.adults}}</span>
                    <button class="counter-btn" (click)="updateCount('adults', 1)">+</button>
                  </div>
                </div>
                <div class="traveler-row">
                  <div class="traveler-info">
                    <h4>Children</h4>
                    <p>2 - 12 yrs</p>
                  </div>
                  <div class="counter">
                    <button class="counter-btn" [disabled]="!canDecrease('children')"
                      [class.active]="counts.children > 0" (click)="updateCount('children', -1)">-</button>
                    <span class="counter-value">{{counts.children}}</span>
                    <button class="counter-btn" (click)="updateCount('children', 1)">+</button>
                  </div>
                </div>
                <div class="traveler-row">
                  <div class="traveler-info">
                    <h4>Infants</h4>
                    <p>0 - 2 yrs</p>
                  </div>
                  <div class="counter">
                    <button class="counter-btn" [disabled]="!canDecrease('infants')" [class.active]="counts.infants > 0"
                      (click)="updateCount('infants', -1)">-</button>
                    <span class="counter-value">{{counts.infants}}</span>
                    <button class="counter-btn" (click)="updateCount('infants', 1)">+</button>
                  </div>
                </div>
                <div class="class-selection">
                  <h3>Class</h3>
                  <div class="class-options">
                    <button class="class-option" [class.active]="selectedClass === 'economy'"
                      (click)="updateClass('economy')">Economy</button>
                    <button class="class-option" [class.active]="selectedClass === 'business'"
                      (click)="updateClass('business')">Business</button>
                    <button class="class-option" [class.active]="selectedClass === 'first'"
                      (click)="updateClass('first')">First</button>
                  </div>
                </div>
                <div class="panel-actions">
                  <button class="done-btn" (click)="closeTravelersPanel()">Done</button>
                </div>
              </div>
            </div>
          </div>
          <div class="summary-divider"></div>
          <div class="summary-section summary-actions">
            <button class="modify-search-btn" (click)="onModifySearch(); $event.stopPropagation()"
              title="Modify Search">
              MODIFY SEARCH
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>

        <!-- Desktop Trip Summary for Multi-city -->
        <div class="desktop-summary-card" *ngIf="flightType === 'multi' && flightInputData?.multiCitySegment?.length">

          <!-- Route Section -->
          <div class="summary-section" style="flex: 2; cursor: default;">
            <div class="summary-label">Route</div>
            <div class="summary-value"
              style="font-size: 16px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
              <ng-container *ngFor="let segment of flightInputData['multiCitySegment']; let i = index">
                <span>{{ getMultiCityRouteOrigin(i) }} <i class="fas fa-long-arrow-alt-right"
                    style="font-size: 14px; color: #008b8b; margin: 0 4px;"></i> {{ getMultiCityRouteDestination(i)
                  }}</span>
                <span *ngIf="i < (flightInputData['multiCitySegment'].length - 1)"
                  style="color: #cbd5e1; font-weight: 300;">|</span>
              </ng-container>
            </div>
            <div class="summary-detail">


              {{ totalPassengers }} {{ totalPassengers > 1 ?
              'Travellers' : 'Traveller' }}
            </div>
          </div>

          <div class="summary-divider"></div>

          <!-- Dates Section -->
          <div class="summary-section" style="cursor: default;">
            <div class="summary-label">Dates</div>
            <div class="summary-value" style="font-size: 16px;">
              <ng-container *ngFor="let segment of flightInputData['multiCitySegment']; let i = index; let last = last">
                {{ getMultiCityRouteDate(i) | date : "dd MMM" }}<span *ngIf="!last">, </span>
              </ng-container>
            </div>
            <div class="summary-detail">
              {{ modifySearchForm.get('travelClass')?.value || 'Economy' }}
            </div>
          </div>

          <!-- <div class="summary-divider"></div> -->

          <!-- Modify Button -->
          <div class="summary-section summary-actions">
            <!-- <button
  class="modify-search-btn"
  (click)="onModifySearch(); $event.stopPropagation()"
  title="Modify Search"
>
  MODIFY SEARCH
  <i class="fas fa-search"></i>
</button>
-->
          </div>
        </div>
      </div>
    </div>

    <!-- Modify Search Form (Desktop - Collapsible) -->
    <div class="modify-search-section desktop-modify-form" [class.visible]="showModifyForm"
      *ngIf="flightType !== 'multi'">
      <div class="container">
        <form [formGroup]="modifySearchForm" (ngSubmit)="onModifySearch()" class="modify-search-form">
          <div class="form-row">
            <div class="form-group">
              <label>From:</label>
              <!-- Typable airport input with suggestions -->
              <input type="text" formControlName="from" list="airportList"
                placeholder="Type city or airport (e.g. Delhi, DEL)" />
            </div>
            <div class="form-group">
              <label>To:</label>
              <!-- Typable airport input with suggestions -->
              <input type="text" formControlName="to" list="airportList"
                placeholder="Type city or airport (e.g. Mumbai, BOM)" />
            </div>
            <!-- Shared datalist for airport suggestions -->
            <datalist id="airportList">
              <option *ngFor="let city of flightAirports" [value]="city.code">
                {{ city.name }} ({{ city.code }})
              </option>
            </datalist>
            <div class="form-group">
              <label>Departure Date:</label>
              <app-custom-calendar [selectedDate]="modifySearchForm.get('departureDate')?.value"
                [minDate]="getTodayDate()" placeholder="Select Departure Date"
                (dateSelected)="onModifyDepartureDateSelected($event)" (calendarOpened)="onCalendarOpened()"
                (calendarClosed)="onCalendarClosed()">
              </app-custom-calendar>
            </div>
            <div class="form-group" *ngIf="flightType === 'round'">
              <label>Return Date:</label>
              <app-custom-calendar [selectedDate]="modifySearchForm.get('returnDate')?.value"
                [minDate]="getReturnMinDate()" placeholder="Select Return Date"
                (dateSelected)="onModifyReturnDateSelected($event)" (calendarOpened)="onCalendarOpened()"
                (calendarClosed)="onCalendarClosed()">
              </app-custom-calendar>
              <div class="validation-error" *ngIf="returnDateError">
                {{ returnDateError }}
              </div>
            </div>
            <div class="form-group passenger-dropdown-wrapper">
              <label>Passengers:</label>
              <div class="passenger-display" (click)="togglePassengerDropdown(); $event.stopPropagation()">
                {{ totalPassengers }} Passenger{{ totalPassengers > 1 ? "s" : "" }}
                <i class="fas fa-chevron-down" [class.rotated]="showPassengerDropdown"></i>
              </div>
              <div class="passenger-dropdown" *ngIf="showPassengerDropdown" (click)="$event.stopPropagation()">
                <div class="passenger-type-row" *ngFor="let type of passengerTypes">
                  <div class="label">{{ type.label }}</div>
                  <div class="controls">
                    <button type="button" (click)="decrement(type.key)">âˆ’</button>
                    <span>{{ modifySearchForm.get(type.key)?.value }}</span>
                    <button type="button" (click)="increment(type.key)">+</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Class:</label>
              <select formControlName="travelClass">
                <option value="">Select class</option>
                <option *ngFor="let cls of travelClasses" [value]="cls">{{ cls }}</option>
              </select>
            </div>
            <div class="form-group">
              <button type="submit" class="modify-search-btn">Modify Search</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Mobile Modify Search Drawer (Slides from left) -->
    <div class="mobile-modify-drawer" [class.open]="showModifyForm" (click)="showModifyForm = false"
      *ngIf="flightType !== 'multi'">
      <div class="mobile-modify-drawer-content" (click)="$event.stopPropagation()">
        <button class="mobile-modify-drawer-close" (click)="showModifyForm = false">Ã—</button>
        <form [formGroup]="modifySearchForm" (ngSubmit)="onModifySearch()" class="mobile-modify-search-form">
          <div class="mobile-form-group">
            <label>From:</label>
            <input type="text" formControlName="from" list="airportListMobile"
              placeholder="Type city or airport (e.g. Delhi, DEL)" />
          </div>
          <div class="mobile-form-group">
            <label>To:</label>
            <input type="text" formControlName="to" list="airportListMobile"
              placeholder="Type city or airport (e.g. Mumbai, BOM)" />
          </div>
          <!-- Shared datalist for airport suggestions -->
          <datalist id="airportListMobile">
            <option *ngFor="let city of flightAirports" [value]="city.code">
              {{ city.name }} ({{ city.code }})
            </option>
          </datalist>
          <div class="mobile-form-group">
            <label>Departure Date:</label>
            <app-custom-calendar [selectedDate]="modifySearchForm.get('departureDate')?.value"
              [minDate]="getTodayDate()" placeholder="Select Departure Date"
              (dateSelected)="onModifyDepartureDateSelected($event)" (calendarOpened)="onCalendarOpened()"
              (calendarClosed)="onCalendarClosed()">
            </app-custom-calendar>
          </div>
          <div class="mobile-form-group" *ngIf="flightType === 'round'">
            <label>Return Date:</label>
            <app-custom-calendar [selectedDate]="modifySearchForm.get('returnDate')?.value"
              [minDate]="getReturnMinDate()" placeholder="Select Return Date"
              (dateSelected)="onModifyReturnDateSelected($event)" (calendarOpened)="onCalendarOpened()"
              (calendarClosed)="onCalendarClosed()">
            </app-custom-calendar>
            <div class="validation-error" *ngIf="returnDateError"
              style="margin-top: 8px; color: #ef4444; font-size: 12px;">
              {{ returnDateError }}
            </div>
          </div>
          <div class="mobile-form-group mobile-passenger-dropdown-wrapper">
            <label>Passengers:</label>
            <div class="mobile-passenger-display" (click)="togglePassengerDropdown(); $event.stopPropagation()">
              {{ totalPassengers }} Passenger{{ totalPassengers > 1 ? "s" : "" }}
              <i class="fas fa-chevron-down" [class.rotated]="showPassengerDropdown"></i>
            </div>
            <div class="mobile-passenger-dropdown" *ngIf="showPassengerDropdown" (click)="$event.stopPropagation()">
              <div class="mobile-passenger-type-row" *ngFor="let type of passengerTypes">
                <div class="label">{{ type.label }}</div>
                <div class="controls">
                  <button type="button" (click)="decrement(type.key)">âˆ’</button>
                  <span>{{ modifySearchForm.get(type.key)?.value }}</span>
                  <button type="button" (click)="increment(type.key)">+</button>
                </div>
              </div>
            </div>
          </div>
          <div class="mobile-form-group">
            <label>Class:</label>
            <select formControlName="travelClass">
              <option value="">Select class</option>
              <option *ngFor="let cls of travelClasses" [value]="cls">{{ cls }}</option>
            </select>
          </div>
          <div class="mobile-form-group">
            <button type="submit" class="mobile-modify-search-btn">Modify Search</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main Content Area -->
    <main class="results-main">
      <div class="container">

        <!-- <div class="date-slider-bar desktophid" *ngIf="flightType === 'oneway'">
          <div class="date-slider-wrapper">
        <button class="date-slider-arrow date-slider-arrow-left" *ngIf="canScrollLeft"
          (click)="scrollDateSlider('left')" aria-label="Scroll left">
          <i class="fas fa-chevron-left"></i>
        </button>

        <div class="date-slider-scroll-wrapper" #scrollContainer (scroll)="onDateSliderScroll()">
          <div class="date-slider-container">
        <div class="date-card" *ngFor="let item of datePrices; let i = index"
          [class.selected]="item.date === highlightedDate" (click)="selectDateFromSlider(item.date, i)"
          [title]="item.date | date : 'fullDate'">
          <div class="date-label">{{ item.date | date : "d MMM" }}</div>
          <div class="date-price">â‚¹ {{ item.price | number : "1.0-0" }}</div>
        </div>
        <div *ngIf="datePrices.length === 0 && !isLoadingMore" class="date-slider-empty">
          Loading dates...
        </div>
        <div *ngIf="isLoadingMore" class="date-slider-loading">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      </div>
  </div>

  <button class="date-slider-arrow date-slider-arrow-right" *ngIf="canScrollRight" (click)="scrollDateSlider('right')"
    aria-label="Scroll right">
    <i class="fas fa-chevron-right"></i>
  </button>
</div>
</div> -->

        <!-- Mobile Filter Chips and Button (only visible on mobile) -->
        <div class="mobile-filter-chips-wrapper"
          *ngIf="flightType === 'oneway' || flightType === 'round' || flightType === 'multi'">
          <div class="mobile-filter-chips">
            <button class="mobile-filter-chip" [class.active]="selectedStops.includes(0)"
              (click)="toggleNonStopFilter()">
              Non Stop
            </button>
            <button class="mobile-filter-chip" [class.active]="showRefundableOnly" (click)="toggleRefundableFilter()">
              Refundable
            </button>
            <button class="mobile-filter-chip" [class.active]="selectedAirlines.length > 0"
              (click)="showMobileFilter = true; mobileFilterActiveTab = 'filter'">
              Airlines
            </button>
          </div>
          <button class="mobile-filter-icon-btn" (click)="showMobileFilter = !showMobileFilter">
            <i class="fas fa-sliders-h"></i>
          </button>
        </div>

        <!-- Mobile "flights found" & sort pills (only visible on mobile via CSS) -->
        <div class="mobile-results-summary"
          *ngIf="flightType === 'oneway' || flightType === 'round' || flightType === 'multi'">
          <div class="mobile-results-pill mobile-results-count">
            {{ getMobileVisibleFlightsCount() }} Flights Found
          </div>
          <button type="button" class="mobile-results-pill mobile-results-sort"
            (click)="showMobileFilter = true; mobileFilterActiveTab = 'sort'">
            {{ selectedSort || 'Cheapest First' }}
          </button>
        </div>

        <!-- Mobile Filter Popup -->
        <div class="mobile-filter-backdrop" *ngIf="showMobileFilter" (click)="showMobileFilter = false"></div>
        <div class="mobile-filter-popup" [class.active]="showMobileFilter" *ngIf="showMobileFilter">
          <div class="mobile-filter-content" (click)="$event.stopPropagation()">
            <div class="mobile-filter-header">
              <span class="title">Refine Your Search</span>
              <button class="mobile-filter-close-btn" (click)="showMobileFilter = false">&times;</button>
            </div>

            <div class="mobile-filter-tabs">
              <span class="mobile-filter-tab" [class.highlighted]="mobileFilterActiveTab === 'sort'"
                (click)="mobileFilterActiveTab = 'sort'">Sort</span>
              <span class="mobile-filter-tab" [class.highlighted]="mobileFilterActiveTab === 'filter'"
                (click)="mobileFilterActiveTab = 'filter'">Filter</span>
            </div>

            <!-- Sort Section -->
            <div *ngIf="mobileFilterActiveTab === 'sort'" class="mobile-filter-section">
              <div class="mobile-filter-block">
                <label class="mobile-filter-block-title">Sort By</label>
                <div class="mobile-checkbox-row" *ngFor="let sortOption of sortOptions || []">
                  <input type="radio" name="mobileSort" [value]="sortOption" [checked]="selectedSort === sortOption"
                    (change)="selectedSort = sortOption; applySort()" />
                  <label>{{ sortOption }}</label>
                </div>
              </div>
            </div>

            <!-- Filter Section -->
            <div *ngIf="mobileFilterActiveTab === 'filter'" class="mobile-filter-section">
              <!-- Stops Filter -->
              <div class="mobile-filter-block" *ngIf="dynamicFilters?.stops && dynamicFilters.stops.length > 0">
                <label class="mobile-filter-block-title">Stops</label>
                <div class="mobile-checkbox-wrap">
                  <label class="mobile-checkbox-inline" *ngFor="let stop of dynamicFilters?.stops || []">
                    <input type="checkbox" [value]="stop" (change)="onStopFilterChange($event)"
                      [checked]="selectedStops.includes(stop)" />
                    {{ stop === 0 ? "Non-stop" : stop + " Stop" + (stop > 1 ? "s" : "") }}
                  </label>
                </div>
              </div>
              <hr class="mobile-filter-hr" *ngIf="dynamicFilters?.stops && dynamicFilters.stops.length > 0" />

              <!-- Airlines Filter -->
              <div class="mobile-filter-block" *ngIf="dynamicFilters?.airlines && dynamicFilters.airlines.length > 0">
                <label class="mobile-filter-block-title">Airlines</label>
                <div class="mobile-checkbox-wrap">
                  <label class="mobile-checkbox-inline" *ngFor="let airline of dynamicFilters?.airlines || []">
                    <input type="checkbox" [value]="airline" (change)="onAirlineFilterChange($event)"
                      [checked]="selectedAirlines.includes(airline)" />
                    {{ airline }}
                  </label>
                </div>
              </div>
              <hr class="mobile-filter-hr" *ngIf="dynamicFilters?.airlines && dynamicFilters.airlines.length > 0" />

              <!-- Refundability Filter -->
              <div class="mobile-filter-block">
                <label class="mobile-filter-block-title">Refundable</label>
                <div class="mobile-checkbox-wrap">
                  <label class="mobile-checkbox-inline">
                    <input type="checkbox" value="refundable" (change)="onRefundabilityChange($event)" />
                    Partially Refundable
                  </label>
                  <label class="mobile-checkbox-inline">
                    <input type="checkbox" value="non-refundable" (change)="onRefundabilityChange($event)" />
                    Non-refundable
                  </label>
                </div>
              </div>
              <hr class="mobile-filter-hr" />

              <!-- Departure Timings Filter -->
              <div class="mobile-filter-block" *ngIf="departureTimeSlots && departureTimeSlots.length > 0">
                <label class="mobile-filter-block-title">Departure Timings</label>
                <div class="mobile-departure-time-filter">
                  <div class="mobile-time-slot" *ngFor="let slot of departureTimeSlots"
                    [class.selected]="slot.label && selectedDepartureSlots.has(slot.label)"
                    (click)="toggleDepartureSlot(slot.label)">
                    <i [class]="slot.iconClass"></i>
                    <div class="label">{{ slot.label }}</div>
                  </div>
                </div>
              </div>

              <!-- Price Range Filter -->
              <div class="mobile-filter-block" *ngIf="dynamicFilters.min_price && dynamicFilters.max_price">
                <label class="mobile-filter-block-title">Price Range</label>
                <input type="range" [min]="dynamicFilters?.min_price || 0" [max]="dynamicFilters?.max_price || 0"
                  [(ngModel)]="priceRange" class="mobile-filter-price-range" (input)="onPriceChange()" />
                <div class="mobile-filter-price-range-label">
                  â‚¹{{ (dynamicFilters.min_price || 0) | number : "1.0-0" }} - â‚¹{{ priceRange | number : "1.0-0" }}
                </div>
              </div>

              <div class="mobile-filter-button-row">
                <button class="mobile-filter-clear-btn" (click)="clearAllFilters()">
                  Clear All Filters
                </button>
                <button class="mobile-filter-apply-btn" (click)="applyMobileFilters()">
                  Apply Filter
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="results-layout">
          <!-- Filter Sidebar -->
          <div class="filter-sidebar-column" *ngIf="flightType === 'oneway'">
            <div class="filter-card">
              <h2 class="filter-heading">Filter Flights</h2>

              <!-- Airlines Filter -->
              <div class="filter-section">
                <h3 class="filter-subheading">Airlines</h3>
                <label class="filter-option" *ngFor="let airline of dynamicFilters.airlines">
                  <input type="checkbox" [value]="airline" (change)="onAirlineFilterChange($event)" />
                  {{ airline }}
                </label>
              </div>

              <!-- Price Range Filter -->
              <div class="filter-section">
                <h3 class="filter-subheading">Price Range</h3>
                <input type="range" [min]="dynamicFilters.min_price" [max]="dynamicFilters.max_price"
                  [(ngModel)]="priceRange" class="price-range" (input)="onPriceChange()" />
                <div class="price-range-label">
                  â‚¹{{ dynamicFilters.min_price | number : "1.0-0" }} - â‚¹{{ priceRange | number : "1.0-0" }}
                </div>
              </div>

              <!-- Number of Stops Filter -->
              <div class="filter-section">
                <h3 class="filter-subheading">Number of Stops</h3>
                <label class="filter-option" *ngFor="let stop of dynamicFilters.stops">
                  <input type="checkbox" [value]="stop" (change)="onStopFilterChange($event)" />
                  {{ stop === 0 ? "Non-stop" : stop + " Stop" + (stop > 1 ? "s" : "") }}
                </label>
              </div>

              <!-- Departure Time Filter -->
              <div class="filter-section">
                <h3 class="filter-subheading">Departure From {{ flightInputData['fromCity'] }}</h3>
                <div class="departure-time-filter">
                  <div class="time-slot" *ngFor="let slot of departureTimeSlots"
                    (click)="toggleDepartureSlot(slot.label)" [class.selected]="selectedDepartureSlots.has(slot.label)">
                    <i [class]="slot.iconClass"></i>
                    <div class="label">{{ slot.label }}</div>
                  </div>
                </div>
              </div>

              <!-- Refundability Filter -->
              <div class="filter-section">
                <h3 class="filter-subheading">Refundability</h3>
                <label class="filter-option">
                  <input type="checkbox" value="refundable" (change)="onRefundabilityChange($event)" />
                  Partially Refundable
                </label>
                <label class="filter-option">
                  <input type="checkbox" value="non-refundable" (change)="onRefundabilityChange($event)" />
                  Non-refundable
                </label>
              </div>
            </div>
          </div>

          <!-- Round Trip Filters -->
          <div class="filter-sidebar-column" *ngIf="flightType === 'round'">
            <div class="filter-card">
              <!-- Onward Filters -->
              <h2 class="filter-heading">Filter Onward Flights</h2>

              <!-- Airlines -->
              <div class="filter-section">
                <h3 class="filter-subheading">Airlines</h3>
                <!--<div class="filter-buttons">
                  <button class="btn-link" (click)="roundtripSelectAllAirlines('onward')">Select All</button>
                  <button class="btn-link danger" (click)="roundtripResetAirlines('onward')">Reset</button>
                </div>-->
                <label class="filter-option" *ngFor="let airline of roundtripDynamicFiltersOnward.airlines">
                  <input type="checkbox" [value]="airline" (change)="roundtripOnAirlineFilterChange($event, 'onward')"
                    [checked]="roundtripSelectedAirlinesOnward.includes(airline)" />
                  {{ airline }}
                </label>
              </div>

              <!-- Price -->
              <div class="filter-section">
                <h3 class="filter-subheading">Price Range</h3>
                <input type="range" [min]="roundtripDynamicFiltersOnward.min_price"
                  [max]="roundtripDynamicFiltersOnward.max_price" [(ngModel)]="roundtripPriceRangeOnward"
                  class="price-range" (input)="roundtripOnPriceChange('onward')" />
                <div class="price-range-label">
                  â‚¹{{ roundtripDynamicFiltersOnward.min_price | number : "1.0-0" }} - â‚¹{{ roundtripPriceRangeOnward |
                  number : "1.0-0" }}
                </div>
              </div>

              <!-- Stops -->
              <div class="filter-section">
                <h3 class="filter-subheading">Number of Stops</h3>
                <!-- <div class="filter-buttons">
                 <button class="btn-link" (click)="roundtripSelectAllStops('onward')">Select All</button>
                  <button class="btn-link danger" (click)="roundtripResetStops('onward')">Reset</button>
                </div>-->
                <label class="filter-option" *ngFor="let stop of roundtripDynamicFiltersOnward.stops">
                  <input type="checkbox" [value]="stop" (change)="roundtripOnStopFilterChange($event, 'onward')"
                    [checked]="roundtripSelectedStopsOnward.includes(stop)" />
                  {{ stop === 0 ? "Non-stop" : stop + " Stop" + (stop > 1 ? "s" : "") }}
                </label>
              </div>

              <!-- Time -->
              <div class="filter-section">
                <h3 class="filter-subheading">Departure from {{ flightInputData['fromCity'] }}</h3>
                <!-- <div class="filter-buttons">
                      <button class="btn-link" (click)="roundtripSelectAllDepartureSlots('onward')">Select All</button>
                  <button class="btn-link danger" (click)="roundtripResetDepartureSlots('onward')">Reset</button>
                </div> -->
                <div class="departure-time-filter">
                  <div class="time-slot" *ngFor="let slot of departureTimeSlots"
                    (click)="roundtripToggleDepartureSlot(slot.label, 'onward')"
                    [class.selected]="roundtripSelectedDepartureSlotsOnward.has(slot.label)">
                    <i [class]="slot.iconClass"></i>
                    <div class="label">{{ slot.label }}</div>
                  </div>
                </div>
              </div>

              <!-- Refundability -->
              <div class="filter-section">
                <h3 class="filter-subheading">Refundability</h3>
                <!-- <div class="filter-buttons">
                   <button class="btn-link" (click)="selectAllRefundability('onward')">Select All</button>
                  <button class="btn-link danger" (click)="resetRefundability('onward')">Reset</button>
                </div>-->
                <label class="filter-option">
                  <input type="checkbox" [(ngModel)]="showRefundableOnward" (change)="roundtripApplyAllFilters()" />
                  Partially Refundable
                </label>
                <label class="filter-option">
                  <input type="checkbox" [(ngModel)]="showNonRefundableOnward" (change)="roundtripApplyAllFilters()" />
                  Non-refundable
                </label>
              </div>

              <hr />

              <!-- Return Filters -->
              <h2 class="filter-heading">Filter Return Flights</h2>

              <!-- Airlines -->
              <div class="filter-section">
                <h3 class="filter-subheading">Airlines</h3>
                <!-- <div class="filter-buttons">
                  <button class="btn-link" (click)="roundtripSelectAllAirlines('return')">Select All</button>
                  <button class="btn-link danger" (click)="roundtripResetAirlines('return')">Reset</button>
                </div>-->
                <label class="filter-option" *ngFor="let airline of roundtripDynamicFiltersReturn.airlines">
                  <input type="checkbox" [value]="airline" (change)="roundtripOnAirlineFilterChange($event, 'return')"
                    [checked]="roundtripSelectedAirlinesReturn.includes(airline)" />
                  {{ airline }}
                </label>
              </div>

              <!-- Price -->
              <div class="filter-section">
                <h3 class="filter-subheading">Price Range</h3>
                <input type="range" [min]="roundtripDynamicFiltersReturn.min_price"
                  [max]="roundtripDynamicFiltersReturn.max_price" [(ngModel)]="roundtripPriceRangeReturn"
                  class="price-range" (input)="roundtripOnPriceChange('return')" />
                <div class="price-range-label">
                  â‚¹{{ roundtripDynamicFiltersReturn.min_price | number : "1.0-0" }} - â‚¹{{ roundtripPriceRangeReturn |
                  number : "1.0-0" }}
                </div>
              </div>

              <!-- Stops -->
              <div class="filter-section">
                <h3 class="filter-subheading">Number of Stops</h3>
                <!-- <div class="filter-buttons">
                  <button class="btn-link" (click)  ="roundtripSelectAllStops('return')">Select All</button>
                  <button class="btn-link danger" (click)="roundtripResetStops('return')">Reset</button>
                </div>-->
                <label class="filter-option" *ngFor="let stop of roundtripDynamicFiltersReturn.stops">
                  <input type="checkbox" [value]="stop" (change)="roundtripOnStopFilterChange($event, 'return')"
                    [checked]="roundtripSelectedStopsReturn.includes(stop)" />
                  {{ stop === 0 ? "Non-stop" : stop + " Stop" + (stop > 1 ? "s" : "") }}
                </label>
              </div>

              <!-- Time -->
              <div class="filter-section">
                <h3 class="filter-subheading">Departure from {{ flightInputData['toCity'] }}</h3>
                <div class="filter-buttons">
                  <!-- <button class="btn-link" (click)="roundtripSelectAllDepartureSlots('return')">Select
                    All</button>
                  <button class="btn-link danger" (click)="roundtripResetDepartureSlots('return')">Reset</button>-->
                </div>
                <div class="departure-time-filter">
                  <div class="time-slot" *ngFor="let slot of departureTimeSlots"
                    (click)="roundtripToggleDepartureSlot(slot.label, 'return')"
                    [class.selected]="roundtripSelectedDepartureSlotsReturn.has(slot.label)">
                    <i [class]="slot.iconClass"></i>
                    <div class="label">{{ slot.label }}</div>
                  </div>
                </div>
              </div>

              <!-- Refundability -->
              <div class="filter-section">
                <h3 class="filter-subheading">Refundability</h3>
                <div class="filter-buttons">
                  <!-- <button class="btn-link" (click)="selectAllRefundability('return')">Select All</button>
                  <button class="btn-link danger" (click)="resetRefundability('return')">Reset</button> -->
                </div>
                <label class="filter-option">
                  <input type="checkbox" [(ngModel)]="showRefundableReturn" (change)="roundtripApplyAllFilters()" />
                  Partially Refundable
                </label>
                <label class="filter-option">
                  <input type="checkbox" [(ngModel)]="showNonRefundableReturn" (change)="roundtripApplyAllFilters()" />
                  Non-refundable
                </label>
              </div>
            </div>
          </div>

          <!-- Left Column - Flight Results -->
          <div class="results-column">
            <div class="date-slider-bar mobilehid" *ngIf="flightType === 'oneway'">
              <div class="date-slider-wrapper">
                <!-- Left Arrow Button (Desktop Only) -->
                <button class="date-slider-arrow date-slider-arrow-left" *ngIf="canScrollLeft"
                  (click)="scrollDateSlider('left')" aria-label="Scroll left">
                  <i class="fas fa-chevron-left"></i>
                </button>

                <div class="date-slider-scroll-wrapper" #scrollContainer (scroll)="onDateSliderScroll()">
                  <div class="date-slider-container">
                    <!-- Month pill at the start -->
                    <div class="desktop-flight-month-pill">
                      {{ flightInputData['departureDate'] | date : "MMM" | uppercase }}
                    </div>

                    <!-- Date chips -->
                    <div class="date-card" *ngFor="let item of datePrices; let i = index"
                      [class.selected]="item.date === highlightedDate" (click)="selectDateFromSlider(item.date, i)"
                      [title]="item.date | date : 'fullDate'">
                      <div class="date-text">{{ item.date | date : "EEE, MMM d" }}</div>
                      <div class="date-price">â‚¹ {{ item.price | number : "1.0-0" }}</div>
                    </div>
                    <div *ngIf="datePrices.length === 0 && !isLoadingMore" class="date-slider-empty">
                      Loading dates...
                    </div>
                    <div *ngIf="isLoadingMore" class="date-slider-loading">
                      <i class="fas fa-spinner fa-spin"></i>
                    </div>
                  </div>
                </div>

                <!-- Right Arrow Button (Desktop Only) -->
                <button class="date-slider-arrow date-slider-arrow-right" *ngIf="canScrollRight"
                  (click)="scrollDateSlider('right')" aria-label="Scroll right">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            <!-- One Way Flights -->
            <div *ngIf="flightType === 'oneway'" class="flight-list-container">
              <!-- Debug Info (remove after testing) -->
              <!-- <div style="padding: 20px; background: #f0f0f0; margin: 10px 0;">
                <p>Debug: flightType = {{ flightType }}</p>
                <p>Debug: groupedFlights length = {{ groupedFlights?.length || 0 }}</p>
                <p>Debug: loader = {{ loader }}</p>
              </div> -->

              <!-- Flight Count Header -->
              <div class="flight-count-header" *ngIf="groupedFlights && groupedFlights.length > 0">
                <h2 class="flight-count-text">
                  {{ groupedFlights.length }} {{ groupedFlights.length === 1 ? 'Flight Found' : 'Flights Found' }}
                </h2>
                <div class="flight-announcement">
                  <div class="announceicobox">

                    <i class="fas fa-bullhorn announcement-icon"></i>
                  </div>
                  <span>Wizzride doesn't charge any convenience fee or service charge.</span>
                </div>

                <h2 class="flight-count-text">
                  Cheapest Flights First
                </h2>
              </div>

              <!-- Flight Cards (matching booking-results card design) -->
              <div class="flight-cards" *ngIf="groupedFlights && groupedFlights.length > 0">
                <div class="card mobile-flight-card-new" [class.card-expanded]="flightDetailsExpanded[i]"
                  (click)="toggleCardExpansion(i, $event)" *ngFor="let flight of groupedFlights; let i = index">
                  <div class="fltop">

                    <!-- DESKTOP SINGLE ROW LAYOUT -->
                    <div class="desktop-flight-row">
                      <!-- Airline Section -->
                      <div class="desktop-airline-section">
                        <img class="desktop-airline-logo"
                          [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                          [alt]="flight.Segments[0][0].Airline.AirlineName"
                          onerror="this.src='assets/images/default-airline.png'" />
                        <div class="desktop-airline-info">
                          <div class="desktop-airline-name">{{ flight.Segments[0][0].Airline.AirlineName }}</div>
                          <div class="desktop-flight-number">{{ flight.Segments[0][0].Airline.AirlineCode }} {{
                            flight.Segments[0][0].Airline.FlightNumber }}</div>
                          <div class="desktop-aircraft-type">{{ flight.Segments[0][0].Craft || 'Aircraft' }}</div>
                        </div>

                      </div>

                      <!-- Departure Section -->
                      <div class="desktop-departure-section">
                        <div class="desktop-time">{{ flight.Segments[0][0].Origin.DepTime | date : "HH:mm" }}</div>
                        <div class="desktop-date">{{ flight.Segments[0][0].Origin.DepTime | date : "EEE, dd MMM" }}
                        </div>
                        <div class="desktop-airport">{{ flight.Segments[0][0].Origin.Airport.CityName }}</div>
                      </div>

                      <!-- Duration & Stops Section -->
                      <div class="desktop-duration-section">
                        <div class="desktop-duration-text">{{ getTotalDuration(flight.Segments[0]) }}</div>
                        <div class="desktop-stops-text" (mouseenter)="hoveredIndex = i"
                          (mouseleave)="hoveredIndex = -1">
                          {{ getStopsCount(flight) === 0 ? 'Non Stop' :
                          getStopsCount(flight) + (getStopsCount(flight) === 1 ? ' Stop via ' : ' Stops via ') +
                          getLayoverCity(flight) }}

                          <div class="layover-tooltip" *ngIf="hoveredIndex === i && getStopsCount(flight) > 0">
                            <div *ngFor="let info of getLayoverInfos(flight)" class="layover-item">
                              <div class="layover-header">Plane change</div>
                              <div class="layover-details">
                                {{ info.city }} ({{ info.code }}) | {{ info.duration }} Layover
                              </div>
                              <div class="layover-timeline">
                                <div class="dot"></div>
                              </div>
                              <div class="layover-timeline-text">
                                {{ getStopsCount(flight) === 1 ? '1 stop' : 'Stop' }} via {{ info.city }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Arrival Section -->
                      <div class="desktop-arrival-section">
                        <div class="desktop-time">{{ flight.Segments[0][flight.Segments[0].length -
                          1].Destination.ArrTime
                          | date : "HH:mm" }}</div>
                        <div class="desktop-date">{{ flight.Segments[0][flight.Segments[0].length -
                          1].Destination.ArrTime
                          | date : "EEE, dd MMM" }}</div>
                        <div class="desktop-airport">{{ flight.Segments[0][flight.Segments[0].length -
                          1].Destination.Airport.CityName }}</div>
                        <div class="desktop-day-diff"
                          *ngIf="getDayDiff(flight.Segments[0][0].Origin.DepTime, flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime) > 0">
                          +{{ getDayDiff(flight.Segments[0][0].Origin.DepTime,
                          flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime) }} day
                        </div>
                      </div>

                      <!-- Price & Button Section -->
                      <div class="desktop-price-section">
                        <div class="desktop-price-amount">â‚¹ {{ flight.price | number : "1.0-0" }}</div>
                        <div class="desktop-price-label">per Adult</div>
                        <button class="desktop-view-prices-btn"
                          (click)="openFareOptionsModal(flight); $event.stopPropagation()">
                          View Prices
                        </button>
                      </div>
                    </div>
                    <div class="flbot">
                      <button class="expand-card-btn" (click)="toggleCardExpansion(i, $event)">View Flight
                        Details</button>
                      <p *ngIf="false">{{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                      <p [ngClass]="{ 'refundable': flight.isRefundable, 'non-refundable': !flight.isRefundable }">
                        {{ flight.isRefundable ? "Partially Refundable" : "Non-refundable" }}</p>

                    </div>
                  </div>


                  <!-- END DESKTOP SINGLE ROW LAYOUT -->

                  <!-- NEW MOBILE FLIGHT CARD DESIGN -->
                  <ng-container *ngIf="flight.Segments.length > 1; else singleSegmentBlock">
                    <section class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                      aria-label="Flight Option" (click)="openFareOptionsModal(flight); $event.stopPropagation()">
                      <ng-container *ngFor="let group of flight.Segments; let groupIndex = index">
                        <ng-container *ngFor="let segment of group; let i = index">
                          <!-- Flight Segment -->
                          <div class="flight-card-component__flight-leg">
                            <div class="flight-card-component__leg-header">
                              <img class="flight-card-component__airline-logo"
                                [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                [alt]="segment.Airline.AirlineName + ' logo'"
                                onerror="this.src='assets/images/default-airline.png'" />
                              <div class="flight-card-component__airline-info">
                                <div class="flight-card-component__airline-name">
                                  {{ segment.Airline.AirlineName }}
                                </div>
                                <div class="flight-card-component__flight-code">
                                  {{ segment.Airline.AirlineCode }}
                                  {{ segment.Airline.FlightNumber }}
                                </div>
                              </div>
                              <div class="flight-card-component__pill">
                                {{ segment.Craft || 'Aircraft' }}
                              </div>
                            </div>

                            <div class="flight-card-component__flight-row">
                              <div class="flight-card-component__flight-left">
                                <div class="flight-card-component__time">
                                  {{ segment.Origin.DepTime | date : "HH:mm" }}
                                </div>
                                <div class="flight-card-component__date">
                                  {{ segment.Origin.DepTime | date : "EEE, dd MMM" }}
                                </div>
                                <div class="flight-card-component__location">
                                  {{ segment.Origin.Airport.CityName }}
                                  <div class="flight-card-component_country-name">
                                    {{ segment.Origin.Airport.CountryName }}
                                  </div>
                                </div>
                              </div>

                              <div class="flight-card-component__flight-icon">
                                <i class="fas fa-plane-departure"></i>
                                <div class="flight-card-component__duration">
                                  {{ formatMinutesToHrMin(segment.Duration) }}
                                </div>
                              </div>

                              <div class="flight-card-component__flight-right">
                                <div class="flight-card-component__day-diff"
                                  *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">
                                  +{{ getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }}
                                  day
                                </div>
                                <div class="flight-card-component__time">
                                  {{ segment.Destination.ArrTime | date : "HH:mm" }}
                                </div>
                                <div class="flight-card-component__date">
                                  {{ segment.Destination.ArrTime | date : "EEE, dd MMM" }}
                                </div>
                                <div class="flight-card-component__location">
                                  {{ segment.Destination.Airport.CityName }}
                                  <div class="flight-card-component_country-name">
                                    {{ segment.Destination.Airport.CountryName }}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Layover Section -->
                          <div *ngIf="i < group.length - 1" class="flight-card-component__layover-row">
                            <div class="flight-card-component__dotted-line"></div>
                            <div class="flight-card-component__layover">
                              <div class="flight-card-component__layover-day">
                                {{ getLayoverDayText(group[i], group[i + 1]) }}
                              </div>
                              <div class="flight-card-component__layover-time">
                                {{ getLayoverDuration(group[i], group[i + 1]) }}
                              </div>
                            </div>
                            <div class="flight-card-component__dotted-line"></div>
                          </div>
                        </ng-container>

                        <div class="flight-card-component__badges__intreturn" *ngIf="group?.length">
                          <span class="flight-card-component__pill">
                            {{ group.length - 1 === 0 ? "Non Stop" : group.length - 1 + " Stop" }}
                          </span>
                          <span class="flight-card-component__pill">
                            {{ getGroupDuration(group) }}
                          </span>
                        </div>

                        <!-- Separator Between Segment Groups -->
                        <div *ngIf="groupIndex < flight.Segments.length - 1"
                          class="flight-card-component__group-separator">
                          <div class="flight-card-component__dotted-line"></div>
                        </div>
                      </ng-container>

                      <!-- Footer -->
                      <div class="flight-card-component__footer">
                        <div class="flight-card-component__badges">
                        </div>
                        <div class="flight-card-component__price">
                          <div class="flight-card-component__amount">
                            â‚¹ {{ flight.price | number : "1.0-0" }}
                          </div>
                          <div class="flight-card-component__per">per Adult</div>
                        </div>
                        <button class="flight-card-component__view-prices-btn desktop-only"
                          (click)="openFareOptionsModal(flight); $event.stopPropagation()">
                          View Prices
                        </button>
                      </div>
                      <div class="refundability-tag"
                        [ngClass]="{ 'refundable': flight.isRefundable, 'non-refundable': !flight.isRefundable }">
                        {{ flight.isRefundable ? "Partially Refundable" : "Non-refundable" }}
                      </div>
                    </section>
                  </ng-container>

                  <!-- Single Segment Block - Clean Mobile Design -->
                  <ng-template #singleSegmentBlock>
                    <section class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                      aria-label="Flight Option" (click)="openFareOptionsModal(flight); $event.stopPropagation()">
                      <ng-container *ngFor="let segment of flight.Segments[0]; let i = index">
                        <div class="flight-card-component__flight-leg">
                          <div class="flight-card-component__leg-header">
                            <img class="flight-card-component__airline-logo"
                              [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                              [alt]="segment.Airline.AirlineName + ' logo'"
                              onerror="this.src='assets/images/default-airline.png'" />
                            <div class="flight-card-component__airline-info">
                              <div class="flight-card-component__airline-name">
                                {{ segment.Airline.AirlineName }}
                              </div>
                              <div class="flight-card-component__flight-code">
                                {{ segment.Airline.AirlineCode }} {{ segment.Airline.FlightNumber }}
                              </div>
                            </div>
                            <div class="flight-card-component__pill">
                              {{ segment.Craft || 'Aircraft' }}
                            </div>
                          </div>

                          <div class="flight-card-component__flight-row">
                            <div class="flight-card-component__flight-left">
                              <div class="flight-card-component__time">
                                {{ segment.Origin.DepTime | date : "HH:mm" }}
                              </div>
                              <div class="flight-card-component__date">
                                {{ segment.Origin.DepTime | date : "EEE, dd MMM" }}
                              </div>
                              <div class="flight-card-component__location">
                                {{ segment.Origin.Airport.CityName }}
                              </div>
                            </div>

                            <div class="flight-card-component__flight-icon">
                              <i class="fas fa-plane-departure"></i>

                              <div class="flight-card-component__duration">
                                {{ formatMinutesToHrMin(segment.Duration) }}
                              </div>
                            </div>

                            <div class="flight-card-component__flight-right">
                              <div class="flight-card-component__day-diff"
                                *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">
                                +{{ getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }}
                                day
                              </div>
                              <div class="flight-card-component__time">
                                {{ segment.Destination.ArrTime | date : "HH:mm" }}
                              </div>
                              <div class="flight-card-component__date">
                                {{ segment.Destination.ArrTime | date : "EEE, dd MMM" }}
                              </div>
                              <div class="flight-card-component__location">
                                {{ segment.Destination.Airport.CityName }}
                              </div>
                            </div>
                          </div>
                        </div>

                        <div *ngIf="i < flight.Segments[0].length - 1" class="flight-card-component__layover-row">
                          <div class="flight-card-component__dotted-line"></div>
                          <div class="flight-card-component__layover">
                            <div class="flight-card-component__layover-day">
                              {{ getLayoverDayText(flight.Segments[0][i], flight.Segments[0][i + 1]) }}
                            </div>
                            <div class="flight-card-component__layover-time">
                              {{ getLayoverDuration(flight.Segments[0][i], flight.Segments[0][i + 1]) }}
                            </div>
                          </div>
                          <div class="flight-card-component__dotted-line"></div>
                        </div>
                      </ng-container>

                      <div class="flight-card-component__footer">
                        <div class="flight-card-component__badges">
                          <span class="flight-card-component__pill">
                            {{ flight.Segments[0].length - 1 === 0 ? "Non Stop" : flight.Segments[0].length - 1 + "
                            Stop"
                            }}
                          </span>
                          <span class="flight-card-component__pill">
                            {{ getTotalDuration(flight.Segments[0]) }}
                          </span>
                        </div>
                        <div class="flight-card-component__price">
                          <div class="flight-card-component__amount">
                            â‚¹ {{ flight.price | number : "1.0-0" }}
                          </div>
                          <div class="flight-card-component__per">per Adult</div>
                        </div>
                        <button class="flight-card-component__view-prices-btn desktop-only"
                          (click)="openFareOptionsModal(flight); $event.stopPropagation()">
                          View Prices
                        </button>
                      </div>
                      <div class="refundability-tag"
                        [ngClass]="{ 'refundable': flight.isRefundable, 'non-refundable': !flight.isRefundable }">
                        {{ flight.isRefundable ? "Partially Refundable" : "Non-refundable" }}
                      </div>
                    </section>
                  </ng-template>
                  <!-- END NEW MOBILE FLIGHT CARD DESIGN -->

                  <!-- Date Hanger -->
                  <div class="date-hanger">
                    <div class="date-content">
                      <span class="date-text">{{ flightInputData['departureDate'] | date : "d MMM, yyyy" }}</span>
                    </div>
                  </div>

                  <!-- Route -->
                  <div class="route">
                    <div class="vehicle">
                      <img [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                        [alt]="flight.Segments[0][0].Airline.AirlineName"
                        onerror="this.src='assets/images/default-airline.png'" />
                    </div>

                    <div class="route-column">
                      <div class="route-code">{{ flight.Segments[0][0].Origin.Airport.AirportCode }}</div>
                      <div class="location">{{ flight.Segments[0][0].Origin.Airport.CityName }}</div>
                    </div>

                    <div class="route-visualization">
                      <div></div>
                      <div class="route-line">
                        <div class="route-node start-node"></div>
                        <div class="route-car">
                          <i class="fas fa-plane-departure" style="font-size: 24px; color: #008b8b;"></i>
                        </div>
                        <div class="route-node end-node"></div>
                      </div>
                      <div class="route-details">
                        <div class="time">{{ flight.Segments[0][0].Origin.DepTime | date : "HH:mm" }} - {{
                          flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime | date : "HH:mm" }}
                        </div>
                        <div class="duration">{{ getTotalDuration(flight.Segments[0]) }}</div>
                      </div>
                    </div>

                    <div class="route-column">
                      <div class="route-code">{{ flight.Segments[0][flight.Segments[0].length -
                        1].Destination.Airport.AirportCode }}</div>
                      <div class="location">{{ flight.Segments[0][flight.Segments[0].length -
                        1].Destination.Airport.CityName }}</div>
                    </div>
                  </div>

                  <!-- Mobile Amenities + Airline Display -->
                  <div class="mobile-amenities">
                    <div class="amenities-list">
                      <div class="amenity">
                        <i class="fas fa-plane-departure"></i>
                        <span>{{ getStopsCount(flight) === 0 ? 'Non-stop' : getStopsCount(flight) + ' Stop' +
                          (getStopsCount(flight) > 1 ? 's' : '') }}</span>
                      </div>
                      <div class="amenity">
                        <i class="fas fa-suitcase"></i>
                        <span>Baggage</span>
                      </div>
                      <div class="amenity">
                        <i class="fas fa-ban"></i>
                        <span>Policy</span>
                      </div>
                    </div>
                    <div class="mobile-vehicle-visual">
                      <img [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                        [alt]="flight.Segments[0][0].Airline.AirlineName"
                        onerror="this.src='assets/images/default-airline.png'" />
                      <div class="mobile-vehicle-name">{{ flight.Segments[0][0].Airline.AirlineName }}</div>
                    </div>
                  </div>

                  <!-- Mobile Price Row -->
                  <div class="mobile-price-row">
                    <div class="mobile-seats-left">
                      <i class="fas fa-users"></i>
                      <span>Available</span>
                    </div>
                    <div class="mobile-start-price">
                      <span>Starts </span>
                      <span class="mobile-price">â‚¹ {{ flight.price | number : "1.0-0" }}</span>
                    </div>
                  </div>

                  <!-- Mobile Booking Button -->
                  <div class="mobile-booking-row">
                    <button class="btn mobile-book-btn"
                      (click)="openFareOptionsModal(flight); $event.stopPropagation()">
                      View Prices
                    </button>
                  </div>

                  <!-- Options -->
                  <div class="options">
                    <!-- Column 1: Stops/Amenities -->
                    <div class="option-item">
                      <div class="default-amenities">
                        <div class="amenity-item">
                          <i class="fas fa-plane-departure"></i>
                          <span>{{ getStopsCount(flight) === 0 ? 'Non-stop' : getStopsCount(flight) + ' Stop' +
                            (getStopsCount(flight) > 1 ? 's' : '') }}</span>
                        </div>
                      </div>
                      <div class="hover-dropdowns">
                        <div class="dropdown">
                          <i class="fas fa-list-alt"></i>
                          <span>Flight Details</span>
                          <div class="dropdown-content">
                            {{ getStopsSummary(flight) }} - Duration: {{ getTotalDuration(flight.Segments[0]) }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Column 2: Baggage/Instructions -->
                    <div class="option-item">
                      <div class="default-amenities">
                        <div class="amenity-item">
                          <i class="fas fa-suitcase"></i>
                          <span>Baggage</span>
                        </div>
                      </div>
                      <div class="hover-dropdowns">
                        <div class="dropdown">
                          <i class="fas fa-info-circle"></i>
                          <span>Details</span>
                          <div class="dropdown-content">
                            Check-in: {{ selectedFareOptions[i]?.Segments?.[0]?.[0]?.Baggage || '15kg' }}<br>
                            Cabin: {{ selectedFareOptions[i]?.Segments?.[0]?.[0]?.CabinBaggage || '7kg' }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Column 3: Policy/Cancellation Policy -->
                    <div class="option-item">
                      <div class="default-amenities">
                        <div class="amenity-item">
                          <i class="fas fa-ban"></i>
                          <span>Policy</span>
                        </div>
                      </div>
                      <div class="hover-dropdowns">
                        <div class="dropdown">
                          <i class="fas fa-ban"></i>
                          <span>Cancellation</span>
                          <div class="dropdown-content">
                            {{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Column 4: Price & View Prices Button -->
                    <div class="select-btn-card">
                      <div class="desktop-price-display">
                        <span class="price-label">Starts from</span>
                        <span class="price-value">â‚¹ {{ flight.price | number : "1.0-0" }}</span>
                      </div>
                      <button class="btn" (click)="openFareOptionsModal(flight); $event.stopPropagation()">View
                        Prices</button>
                    </div>
                  </div>

                  <!-- Expandable Details -->
                  <div class="flight-details-expanded" *ngIf="flightDetailsExpanded[i]"
                    (click)="$event.stopPropagation()">
                    <div class="flight-tabs">
                      <div class="tab" *ngFor="let tab of tabs" [class.active]="activeTabs[i] === tab.id"
                        (click)="selectTab(i, tab.id); $event.stopPropagation()">
                        {{ tab.label }}
                      </div>
                    </div>

                    <!-- Flight Details Tab -->
                    <div class="tab-content" *ngIf="activeTabs[i] === 'flight'">
                      <ng-container *ngFor="let segment of flight.Segments[0]; let segIndex = index">
                        <div class="flight-details-card-new">
                          <div class="fd-header">
                            <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                              [alt]="segment.Airline.AirlineName" class="fd-logo"
                              onerror="this.src='assets/images/default-airline.png'" />
                            <div class="fd-airline-text">
                              <span class="fd-name">{{ segment.Airline.AirlineName }}</span>
                              <span class="fd-code">{{ segment.Airline.AirlineCode }} | {{ segment.Airline.FlightNumber
                                }}</span>
                              <span class="fd-craft pill">{{ segment.Craft || 'Aircraft' }}</span>
                            </div>
                          </div>

                          <div class="fd-body">
                            <div class="fd-col fd-dep">
                              <div class="fd-time">{{ segment.Origin.DepTime | date : "HH:mm" }}</div>
                              <div class="fd-date">{{ segment.Origin.DepTime | date : "EEE, dd MMM" }}</div>
                              <div class="fd-place">{{ segment.Origin.Airport.CityName }}</div>
                              <div class="fd-terminal" *ngIf="segment.Origin.Airport.Terminal">Terminal {{
                                segment.Origin.Airport.Terminal }}</div>
                            </div>
                            <div class="durnew">
                              <div class="fd-col fd-dur">
                                <div class="fd-duration-text">{{ getFormattedDuration(segment.Duration) }}</div>
                                <div class="fd-bar"></div>
                              </div>
                            </div>
                            <div class="fd-col fd-arr">
                              <div class="fd-time">{{ segment.Destination.ArrTime | date : "HH:mm" }}</div>
                              <div class="fd-date">{{ segment.Destination.ArrTime | date : "EEE, dd MMM" }}</div>
                              <div class="fd-place">{{ segment.Destination.Airport.CityName }}</div>
                              <div class="fd-terminal" *ngIf="segment.Destination.Airport.Terminal">Terminal {{
                                segment.Destination.Airport.Terminal }}</div>
                            </div>

                            <div class="fd-col fd-bag">
                              <div class="fd-bag-group">
                                <span class="fd-label">CHECK-IN</span>
                                <span class="fd-val">{{ (selectedFareOptions[i]?.Segments?.[0]?.[0]?.Baggage) || '15
                                  Kgs'
                                  }} (1 piece)</span>
                              </div>



                            </div>
                            <div class="fd-bag-group">
                              <span class="fd-label">CABIN</span>
                              <span class="fd-val">{{ (selectedFareOptions[i]?.Segments?.[0]?.[0]?.CabinBaggage) || '7
                                Kgs' }} (1 piece)</span>
                            </div>
                          </div>

                          <!-- <div class="fd-footer">
                          <div class="fd-amenity">
                            <i class="fas fa-chair"></i> 3-3 Layout
                          </div>
                          <div class="fd-amenity">
                            <i class="fas fa-coffee"></i> Beverage Available
                          </div>
                          <div class="fd-amenity">
                            <i class="fas fa-video"></i> Streaming Entertainment
                          </div>
                        </div>-->

                        </div>

                        <!-- Layover Separator -->
                        <div class="layover-container" *ngIf="segIndex < flight.Segments[0].length - 1">
                          <div class="layover-line"></div>
                          <div class="layover-badge">
                            <span class="change-planes">Change of planes</span>
                            <span class="layover-detail">{{ getLayoverDuration(segment, flight.Segments[0][segIndex +
                              1]) }} in {{ segment.Destination.Airport.CityName }}</span>
                          </div>
                        </div>
                      </ng-container>
                    </div>

                    <!-- Fare Summary Tab -->
                    <div class="tab-content" *ngIf="activeTabs[i] === 'fare'">
                      <div class="fare-summary-card-new">
                        <div class="fs-header">Fare breakup</div>
                        <div class="cancellation-table-container">
                          <div class="c-row">
                            <div class="c-cell">Base Fare</div>
                            <div class="c-cell" style="text-align: right; color: #000; font-weight: 500;">
                              â‚¹ {{ selectedFareOptions[i]?.Fare?.BaseFare | number : "1.0-0" }}
                            </div>
                          </div>
                          <div class="c-row">
                            <div class="c-cell">Surcharges</div>
                            <div class="c-cell" style="text-align: right; color: #000; font-weight: 500;">
                              â‚¹ {{ selectedFareOptions[i]?.Fare?.Tax | number : "1.0-0" }}
                            </div>
                          </div>
                          <div class="c-row" style="border-bottom: none;">
                            <div class="c-cell" style="font-weight: 700; color: #000;">TOTAL</div>
                            <div class="c-cell" style="text-align: right; font-weight: 700; color: #000;">
                              â‚¹ {{ selectedFareOptions[i]?.Fare?.PublishedFare | number : "1.0-0" }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Cancellation Tab -->
                    <div class="tab-content" *ngIf="activeTabs[i] === 'cancellation'">
                      <div class="cancellation-table-container"
                        *ngIf="getCancellationRows(selectedFareOptions[i] || flight.FareOptions[0]).length > 0; else noCancelPolicy">
                        <div class="c-row c-header">
                          <div class="c-cell">
                            <div class="c-cell-header-content">
                              <span class="c-title">Time frame</span>
                              <span class="c-subtitle">(From Scheduled Flight departure)</span>
                            </div>
                          </div>
                          <div class="c-cell">
                            <div class="c-cell-header-content">
                              <span class="c-title">Airline Fee </span>
                              <span class="c-subtitle">(Per passenger)</span>
                            </div>
                          </div>
                        </div>
                        <div class="c-row"
                          *ngFor="let row of getCancellationRows(selectedFareOptions[i] || flight.FareOptions[0])">
                          <div class="c-cell">{{ row.range }}</div>
                          <div class="c-cell" style="color: #000; font-weight: 500;">
                            {{ row.price }}
                          </div>
                        </div>
                      </div>
                      <ng-template #noCancelPolicy>
                        <div class="policy-content">
                          <p>{{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                        </div>
                      </ng-template>
                    </div>

                    <!-- Date Change Tab -->
                    <div class="tab-content" *ngIf="activeTabs[i] === 'dateChange'">
                      <div class="cancellation-table-container"
                        *ngIf="getDateChangeRows(selectedFareOptions[i] || flight.FareOptions[0]).length > 0; else noDateChangePolicy">
                        <div class="c-row c-header">
                          <div class="c-cell">
                            <div class="c-cell-header-content">
                              <span class="c-title">Time frame</span>
                              <span class="c-subtitle">(From Scheduled Flight departure)</span>
                            </div>
                          </div>
                          <div class="c-cell">
                            <div class="c-cell-header-content">
                              <span class="c-title">Airline Fee + Fare difference</span>
                              <span class="c-subtitle">(Per passenger)</span>
                            </div>
                          </div>
                        </div>
                        <div class="c-row"
                          *ngFor="let row of getDateChangeRows(selectedFareOptions[i] || flight.FareOptions[0])">
                          <div class="c-cell">{{ row.range }}</div>
                          <div class="c-cell" style="color: #000; font-weight: 500;">
                            {{ row.policyText }}
                          </div>
                        </div>
                      </div>
                      <ng-template #noDateChangePolicy>
                        <div class="policy-content">
                          <p>{{ getDateChangeRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                        </div>
                      </ng-template>
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Flights Message -->
              <div class="no-flights" *ngIf="(!groupedFlights || groupedFlights.length === 0) && !loader">
                <p>No flights found for your search criteria. Please try modifying your search.</p>
              </div>
            </div>

            <!-- Round Trip Flights -->
            <div *ngIf="flightType === 'round'" class="roundtrip-results-page">
              <!-- Tab Bar -->
              <div class="roundtrip-tab-bar" #tabBar>
                <div class="tab-item" [class.active]="activeTab === 'onward'" (click)="switchTab('onward')" #onwardTab>
                  <div class="tab-sector">
                    {{ flightInputData['fromAirportCode'] || flightInputData['fromCity'] }}
                    <i class="fas fa-plane-departure"></i>
                    {{ flightInputData['toAirportCode'] || flightInputData['toCity'] }}
                  </div>
                  <div class="tab-date">
                    Onward : {{ flightInputData['departureDate'] | date : "EEE, dd MMM" }}
                  </div>
                </div>
                <div class="tab-item" [class.active]="activeTab === 'return'" (click)="switchTab('return')" #returnTab>
                  <div class="tab-sector">
                    {{ flightInputData['toAirportCode'] || flightInputData['toCity'] }}
                    <i class="fas fa-plane-arrival"></i>
                    {{ flightInputData['fromAirportCode'] || flightInputData['fromCity'] }}
                  </div>
                  <div class="tab-date">
                    Return : {{ flightInputData['returnDate'] | date : "EEE, dd MMM" }}
                  </div>
                </div>
                <div class="tab-underline" [ngStyle]="underlineStyle"></div>
              </div>

              <!-- Scrollable Tab Content -->
              <div class="tab-scroll-container" #scrollContainer>
                <div class="tab-pane">
                  <!-- Onward Tab Content -->
                  <div class="tab-content" *ngIf="activeTab === 'onward'">
                    <!-- Flight Count Header -->
                    <div class="flight-count-header" *ngIf="groupedFlights && groupedFlights.length > 0">
                      <h2 class="flight-count-text">
                        {{ groupedFlights.length }} {{ groupedFlights.length === 1 ? 'Flight Found' : 'Flights Found' }}
                      </h2>
                      <div class="flight-announcement">
                        <div class="announceicobox">

                          <i class="fas fa-bullhorn announcement-icon"></i>
                        </div>
                        <span>Wizzride doesn't charge any convenience fee or service charge.</span>
                      </div>
                      <h2 class="flight-count-text">
                        Cheapest Flights First
                      </h2>
                    </div>
                    <div class="flight-cards roundnospace">
                      <div class="card mobile-flight-card-new" [class.roundtrip-selected]="selectedOutboundIndex === i"
                        *ngFor="let flight of groupedFlights; let i = index">
                        <label class="flight-radio-wrapper" (click)="toggleCardExpansion(i, $event)">
                          <input type="radio" name="outboundFlight" [value]="flight" [(ngModel)]="selectedOutbound" />

                          <div class="fltop">
                            <!-- DESKTOP SINGLE ROW LAYOUT -->
                            <div class="desktop-flight-row">
                              <!-- Airline Section -->
                              <div class="desktop-airline-section">
                                <img class="desktop-airline-logo"
                                  [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                                  [alt]="flight.Segments[0][0].Airline.AirlineName"
                                  onerror="this.src='assets/images/default-airline.png'" />
                                <div class="desktop-airline-info">
                                  <div class="desktop-airline-name">{{ flight.Segments[0][0].Airline.AirlineName }}
                                  </div>
                                  <div class="desktop-flight-number">{{ flight.Segments[0][0].Airline.AirlineCode }} {{
                                    flight.Segments[0][0].Airline.FlightNumber }}</div>
                                  <div class="desktop-aircraft-type">{{ flight.Segments[0][0].Craft || 'Aircraft' }}
                                  </div>
                                </div>
                              </div>

                              <!-- Departure Section -->
                              <div class="desktop-departure-section">
                                <div class="desktop-time">{{ flight.Segments[0][0].Origin.DepTime | date : "HH:mm" }}
                                </div>
                                <div class="desktop-date">{{ flight.Segments[0][0].Origin.DepTime | date : "EEE, dd MMM"
                                  }}</div>
                                <div class="desktop-airport">{{ flight.Segments[0][0].Origin.Airport.CityName }}</div>
                              </div>

                              <!-- Duration & Stops Section -->
                              <div class="desktop-duration-section">
                                <div class="desktop-duration-text">{{ getTotalDuration(flight.Segments[0]) }}</div>
                                <div class="desktop-stops-text" (mouseenter)="hoveredIndex = i"
                                  (mouseleave)="hoveredIndex = -1">
                                  {{ getStopsCount(flight) === 0 ? 'Non Stop' :
                                  getStopsCount(flight) + (getStopsCount(flight) === 1 ? ' Stop via ' : ' Stops via ') +
                                  getLayoverCity(flight) }}

                                  <div class="layover-tooltip" *ngIf="hoveredIndex === i && getStopsCount(flight) > 0">
                                    <div *ngFor="let info of getLayoverInfos(flight)" class="layover-item">
                                      <div class="layover-header">Plane change</div>
                                      <div class="layover-details">
                                        {{ info.city }} ({{ info.code }}) | {{ info.duration }} Layover
                                      </div>
                                      <div class="layover-timeline">
                                        <div class="dot"></div>
                                      </div>
                                      <div class="layover-timeline-text">
                                        {{ getStopsCount(flight) === 1 ? '1 stop' : 'Stop' }} via {{ info.city }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <!-- Arrival Section -->
                              <div class="desktop-arrival-section">
                                <div class="desktop-time">{{ flight.Segments[0][flight.Segments[0].length -
                                  1].Destination.ArrTime | date : "HH:mm" }}</div>
                                <div class="desktop-date">{{ flight.Segments[0][flight.Segments[0].length -
                                  1].Destination.ArrTime | date : "EEE, dd MMM" }}</div>
                                <div class="desktop-airport">{{ flight.Segments[0][flight.Segments[0].length -
                                  1].Destination.Airport.CityName }}</div>
                                <div class="desktop-day-diff"
                                  *ngIf="getDayDiff(flight.Segments[0][0].Origin.DepTime, flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime) > 0">
                                  +{{ getDayDiff(flight.Segments[0][0].Origin.DepTime,
                                  flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime) }} day
                                </div>
                              </div>

                              <!-- Price & Button Section -->
                              <div class="desktop-price-section">
                                <div class="desktop-price-amount">â‚¹ {{ flight.price | number : "1.0-0" }}</div>
                                <div class="desktop-price-label">per Adult</div>
                                <button class="desktop-view-prices-btn"
                                  (click)="selectFlightForRoundTrip(flight, i, 'onward'); $event.stopPropagation()"
                                  *ngIf="selectedOutboundIndex !== i">
                                  SELECT
                                </button>
                                <button class="desktop-view-prices-btn" (click)="$event.stopPropagation()"
                                  *ngIf="selectedOutboundIndex === i"
                                  style="background-color: #2e7d32; border-color: #2e7d32; cursor: default;">
                                  SELECTED
                                </button>
                              </div>

                            </div>

                          </div>

                          <!-- END DESKTOP SINGLE ROW LAYOUT -->

                          <!-- NEW MOBILE FLIGHT CARD DESIGN -->
                          <ng-container *ngIf="flight.Segments.length > 1; else singleSegmentBlockOnward">
                            <section class="flight-card-component__flight-card mobile-flight-card-clean"
                              aria-label="Flight Option">
                              <ng-container *ngFor="let group of flight.Segments; let groupIndex = index">
                                <ng-container *ngFor="let segment of group; let j = index">
                                  <div class="flight-card-component__flight-leg">
                                    <div class="flight-card-component__leg-header">
                                      <img class="flight-card-component__airline-logo"
                                        [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                        [alt]="segment.Airline.AirlineName + ' logo'"
                                        onerror="this.src='assets/images/default-airline.png'" />
                                      <div class="flight-card-component__airline-info">
                                        <div class="flight-card-component__airline-name">{{ segment.Airline.AirlineName
                                          }}
                                        </div>
                                        <div class="flight-card-component__flight-code">{{ segment.Airline.AirlineCode
                                          }}
                                          {{ segment.Airline.FlightNumber }}</div>
                                      </div>
                                      <div class="flight-card-component__pill">{{ segment.Craft || 'Aircraft' }}</div>
                                    </div>
                                    <div class="flight-card-component__flight-row">
                                      <div class="flight-card-component__flight-left">
                                        <div class="flight-card-component__time">{{ segment.Origin.DepTime | date :
                                          "HH:mm" }}</div>
                                        <div class="flight-card-component__date">{{ segment.Origin.DepTime | date :
                                          "EEE, dd MMM" }}</div>
                                        <div class="flight-card-component__location">{{ segment.Origin.Airport.CityName
                                          }}<div class="flight-card-component_country-name">{{
                                            segment.Origin.Airport.CountryName }}</div>
                                        </div>
                                      </div>
                                      <div class="flight-card-component__flight-icon">
                                        <i class="fas fa-plane-departure"></i>
                                        <div class="flight-card-component__duration">{{
                                          formatMinutesToHrMin(segment.Duration) }}</div>
                                      </div>
                                      <div class="flight-card-component__flight-right">
                                        <div class="flight-card-component__day-diff"
                                          *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">
                                          +{{ getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }} day
                                        </div>
                                        <div class="flight-card-component__time">{{ segment.Destination.ArrTime | date :
                                          "HH:mm" }}</div>
                                        <div class="flight-card-component__date">{{ segment.Destination.ArrTime | date :
                                          "EEE, dd MMM" }}</div>
                                        <div class="flight-card-component__location">{{
                                          segment.Destination.Airport.CityName }}<div
                                            class="flight-card-component_country-name">{{
                                            segment.Destination.Airport.CountryName }}</div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div *ngIf="j < group.length - 1" class="flight-card-component__layover-row">
                                    <div class="flight-card-component__dotted-line"></div>
                                    <div class="flight-card-component__layover">
                                      <div class="flight-card-component__layover-day">{{ getLayoverDayText(group[j],
                                        group[j + 1]) }}</div>
                                      <div class="flight-card-component__layover-time">{{ getLayoverDuration(group[j],
                                        group[j + 1]) }}</div>
                                    </div>
                                    <div class="flight-card-component__dotted-line"></div>
                                  </div>
                                </ng-container>
                                <div class="flight-card-component__badges__intreturn" *ngIf="group?.length">
                                  <span class="flight-card-component__pill">{{ group.length - 1 === 0 ? "Non Stop" :
                                    group.length - 1 + " Stop" }}</span>
                                  <span class="flight-card-component__pill">{{ getGroupDuration(group) }}</span>
                                </div>
                                <div *ngIf="groupIndex < flight.Segments.length - 1"
                                  class="flight-card-component__group-separator">
                                  <div class="flight-card-component__dotted-line"></div>
                                </div>
                              </ng-container>
                              <div class="flight-card-component__footer">
                                <div class="flight-card-component__badges">
                                </div>
                                <div class="flight-card-component__price">
                                  <div class="flight-card-component__amount">â‚¹ {{ flight.price | number : "1.0-0" }}
                                  </div>
                                  <div class="flight-card-component__per">per Adult</div>
                                </div>
                                <button class="flight-card-component__view-prices-btn desktop-only"
                                  (click)="openFareOptionsModalForRoundTrip(flight, i, 'onward'); $event.stopPropagation()">
                                  View Prices
                                </button>
                              </div>
                            </section>
                          </ng-container>
                          <ng-template #singleSegmentBlockOnward>
                            <section
                              class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                              aria-label="Flight Option"
                              (click)="openFareOptionsModalForRoundTrip(flight, i, 'onward'); $event.stopPropagation()">
                              <ng-container *ngFor="let segment of flight.Segments[0]; let j = index">
                                <div class="flight-card-component__flight-leg">
                                  <div class="flight-card-component__leg-header">
                                    <img class="flight-card-component__airline-logo"
                                      [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                      [alt]="segment.Airline.AirlineName + ' logo'"
                                      onerror="this.src='assets/images/default-airline.png'" />
                                    <div class="flight-card-component__airline-info">
                                      <div class="flight-card-component__airline-name">{{ segment.Airline.AirlineName }}
                                      </div>
                                      <div class="flight-card-component__flight-code">{{ segment.Airline.AirlineCode }}
                                        {{
                                        segment.Airline.FlightNumber }}</div>
                                    </div>
                                    <div class="flight-card-component__pill">{{ segment.Craft || 'Aircraft' }}</div>
                                  </div>
                                  <div class="flight-card-component__flight-row">
                                    <div class="flight-card-component__flight-left">
                                      <div class="flight-card-component__time">{{ segment.Origin.DepTime | date :
                                        "HH:mm" }}</div>
                                      <div class="flight-card-component__date">{{ segment.Origin.DepTime | date : "EEE,
                                        dd MMM" }}</div>
                                      <div class="flight-card-component__location">{{ segment.Origin.Airport.CityName }}
                                      </div>
                                    </div>
                                    <div class="flight-card-component__flight-icon">
                                      <i class="fas fa-plane-departure"></i>
                                      <div class="flight-card-component__duration">{{
                                        formatMinutesToHrMin(segment.Duration) }}</div>
                                    </div>
                                    <div class="flight-card-component__flight-right">
                                      <div class="flight-card-component__day-diff"
                                        *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">+{{
                                        getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }} day</div>
                                      <div class="flight-card-component__time">{{ segment.Destination.ArrTime | date :
                                        "HH:mm" }}</div>
                                      <div class="flight-card-component__date">{{ segment.Destination.ArrTime | date :
                                        "EEE, dd MMM" }}</div>
                                      <div class="flight-card-component__location">{{
                                        segment.Destination.Airport.CityName }}</div>
                                    </div>
                                  </div>
                                </div>
                                <div *ngIf="j < flight.Segments[0].length - 1"
                                  class="flight-card-component__layover-row">
                                  <div class="flight-card-component__dotted-line"></div>
                                  <div class="flight-card-component__layover">
                                    <div class="flight-card-component__layover-day">{{
                                      getLayoverDayText(flight.Segments[0][j], flight.Segments[0][j + 1]) }}</div>
                                    <div class="flight-card-component__layover-time">{{
                                      getLayoverDuration(flight.Segments[0][j], flight.Segments[0][j + 1]) }}</div>
                                  </div>
                                  <div class="flight-card-component__dotted-line"></div>
                                </div>
                              </ng-container>
                              <div class="flight-card-component__footer">
                                <div class="flight-card-component__badges">
                                  <span class="flight-card-component__pill">{{ flight.Segments[0].length - 1 === 0 ?
                                    "Non
                                    Stop" : flight.Segments[0].length - 1 + " Stop" }}</span>
                                  <span class="flight-card-component__pill">{{ getTotalDuration(flight.Segments[0])
                                    }}</span>
                                </div>
                                <div class="flight-card-component__price">
                                  <div class="flight-card-component__amount">â‚¹ {{ flight.price | number : "1.0-0" }}
                                  </div>
                                  <div class="flight-card-component__per">per Adult</div>
                                </div>
                                <button class="flight-card-component__view-prices-btn desktop-only"
                                  (click)="openFareOptionsModalForRoundTrip(flight, i, 'onward'); $event.stopPropagation()">
                                  View Prices
                                </button>
                              </div>
                            </section>
                          </ng-template>
                          <!-- END NEW MOBILE FLIGHT CARD DESIGN -->

                          <div class="refundability-tag"
                            [ngClass]="{ 'refundable': flight.isRefundable, 'non-refundable': !flight.isRefundable }">
                            {{ flight.isRefundable ? "Partially Refundable" : "Non-refundable" }}
                          </div>
                          <!-- Date Hanger -->
                          <div class="date-hanger">
                            <div class="date-content">
                              <span class="date-text">{{ flightInputData['departureDate'] | date : "d MMM, yyyy"
                                }}</span>
                            </div>
                          </div>

                          <!-- Route -->
                          <div class="route">
                            <div class="vehicle">
                              <img
                                [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                                [alt]="flight.Segments[0][0].Airline.AirlineName"
                                onerror="this.src='assets/images/default-airline.png'" />
                            </div>

                            <div class="route-column">
                              <div class="route-code">{{ flight.Segments[0][0].Origin.Airport.AirportCode }}</div>
                              <div class="location">{{ flight.Segments[0][0].Origin.Airport.CityName }}</div>
                            </div>

                            <div class="route-visualization">
                              <div></div>
                              <div class="route-line">
                                <div class="route-node start-node"></div>
                                <div class="route-car">
                                  <i class="fas fa-plane-departure" style="font-size: 24px; color: #008b8b;"></i>
                                </div>
                                <div class="route-node end-node"></div>
                              </div>
                              <div class="route-details">
                                <div class="time">{{ flight.Segments[0][0].Origin.DepTime | date : "HH:mm" }} - {{
                                  flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime | date : "HH:mm"
                                  }}</div>
                                <div class="duration">{{ getTotalDuration(flight.Segments[0]) }}</div>
                              </div>
                            </div>

                            <div class="route-column">
                              <div class="route-code">{{ flight.Segments[0][flight.Segments[0].length -
                                1].Destination.Airport.AirportCode }}</div>
                              <div class="location">{{ flight.Segments[0][flight.Segments[0].length -
                                1].Destination.Airport.CityName }}</div>
                            </div>
                          </div>

                          <!-- Mobile Amenities + Airline Display -->
                          <div class="mobile-amenities">
                            <div class="amenities-list">
                              <div class="amenity">
                                <i class="fas fa-plane-departure"></i>
                                <span>{{ getStopsCount(flight) === 0 ? 'Non-stop' : getStopsCount(flight) + ' Stop' +
                                  (getStopsCount(flight) > 1 ? 's' : '') }}</span>
                              </div>
                              <div class="amenity">
                                <i class="fas fa-suitcase"></i>
                                <span>Baggage</span>
                              </div>
                              <div class="amenity">
                                <i class="fas fa-ban"></i>
                                <span>Policy</span>
                              </div>
                            </div>
                            <div class="mobile-vehicle-visual">
                              <img
                                [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                                [alt]="flight.Segments[0][0].Airline.AirlineName"
                                onerror="this.src='assets/images/default-airline.png'" />
                              <div class="mobile-vehicle-name">{{ flight.Segments[0][0].Airline.AirlineName }}</div>
                            </div>
                          </div>

                          <!-- Mobile Price Row -->
                          <div class="mobile-price-row">
                            <div class="mobile-seats-left">
                              <i class="fas fa-users"></i>
                              <span>Available</span>
                            </div>
                            <div class="mobile-start-price">
                              <span>Starts </span>
                              <span class="mobile-price">â‚¹ {{ flight.price | number : "1.0-0" }}</span>
                            </div>
                          </div>

                          <!-- Mobile Booking Button -->
                          <div class="mobile-booking-row">
                            <button class="btn mobile-book-btn"
                              (click)="openFareOptionsModalForRoundTrip(flight, i, activeTab); $event.stopPropagation()">
                              View Prices
                            </button>
                          </div>

                          <!-- Options -->
                          <div class="options">
                            <!-- Column 1: Stops/Amenities -->
                            <div class="option-item">
                              <div class="default-amenities">
                                <div class="amenity-item">
                                  <i class="fas fa-plane-departure"></i>
                                  <span>{{ getStopsCount(flight) === 0 ? 'Non-stop' : getStopsCount(flight) + ' Stop' +
                                    (getStopsCount(flight) > 1 ? 's' : '') }}</span>
                                </div>
                              </div>
                              <div class="hover-dropdowns">
                                <div class="dropdown">
                                  <i class="fas fa-list-alt"></i>
                                  <span>Flight Details</span>
                                  <div class="dropdown-content">
                                    {{ getStopsSummary(flight) }} - Duration: {{ getTotalDuration(flight.Segments[0]) }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Column 2: Baggage/Instructions -->
                            <div class="option-item">
                              <div class="default-amenities">
                                <div class="amenity-item">
                                  <i class="fas fa-suitcase"></i>
                                  <span>Baggage</span>
                                </div>
                              </div>
                              <div class="hover-dropdowns">
                                <div class="dropdown">
                                  <i class="fas fa-info-circle"></i>
                                  <span>Details</span>
                                  <div class="dropdown-content">
                                    Check-in: {{ selectedFareOptions[i]?.Segments?.[0]?.[0]?.Baggage || '15kg' }}<br>
                                    Cabin: {{ selectedFareOptions[i]?.Segments?.[0]?.[0]?.CabinBaggage || '7kg' }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Column 3: Policy/Cancellation Policy -->
                            <div class="option-item">
                              <div class="default-amenities">
                                <div class="amenity-item">
                                  <i class="fas fa-ban"></i>
                                  <span>Policy</span>
                                </div>
                              </div>
                              <div class="hover-dropdowns">
                                <div class="dropdown">
                                  <i class="fas fa-ban"></i>
                                  <span>Cancellation</span>
                                  <div class="dropdown-content">
                                    {{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Column 4: Price & View Prices Button -->
                            <div class="select-btn-card">
                              <div class="desktop-price-display">
                                <span class="price-label">Starts from</span>
                                <span class="price-value">â‚¹ {{ flight.price | number : "1.0-0" }}</span>
                              </div>
                              <button class="btn"
                                (click)="openFareOptionsModalForRoundTrip(flight, i, 'onward'); $event.stopPropagation()">View
                                Prices</button>
                            </div>
                          </div>
                        </label>

                        <!-- Expandable Details -->
                        <div class="flight-details-expanded" *ngIf="flightDetailsExpanded[i]"
                          (click)="$event.stopPropagation()">
                          <div class="flight-tabs">
                            <div class="tab" *ngFor="let tab of tabs" [class.active]="activeTabs[i] === tab.id"
                              (click)="selectTab(i, tab.id); $event.stopPropagation()">
                              {{ tab.label }}
                            </div>
                          </div>

                          <!-- Flight Details Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'flight'">
                            <ng-container *ngFor="let segment of flight.Segments[0]; let segIndex = index">
                              <div class="segment-details">
                                <div class="flight-segment-layout">
                                  <div class="flight-info-compact">
                                    <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                      [alt]="segment.Airline.AirlineName" width="60" height="60"
                                      onerror="this.src='assets/images/default-airline.png'" />
                                    <div class="flight-name-number">
                                      <strong>{{ segment.Airline.AirlineName }}</strong> {{ segment.Airline.FlightNumber
                                      }}
                                    </div>
                                  </div>
                                  <div class="timing-info">
                                    <div class="time-block">
                                      <div class="time">{{ segment.Origin.DepTime | date : "HH:mm" }}</div>
                                      <div class="airport">{{ segment.Origin.Airport.CityName }} ({{
                                        segment.Origin.Airport.AirportCode }})</div>
                                    </div>
                                    <div class="duration">{{ getFormattedDuration(segment.Duration) }}</div>
                                    <div class="time-block">
                                      <div class="time">{{ segment.Destination.ArrTime | date : "HH:mm" }}</div>
                                      <div class="airport">{{ segment.Destination.Airport.CityName }} ({{
                                        segment.Destination.Airport.AirportCode }})</div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <!-- Layover Separator -->
                              <div class="layover-container" *ngIf="segIndex < flight.Segments[0].length - 1">
                                <div class="layover-line"></div>
                                <div class="layover-badge">
                                  <span class="change-planes">Change of planes</span>
                                  <span class="layover-detail">{{ getLayoverDuration(segment,
                                    flight.Segments[0][segIndex +
                                    1]) }} in {{ segment.Destination.Airport.CityName }}</span>
                                </div>
                              </div>
                            </ng-container>
                          </div>

                          <!-- Fare Summary Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'fare'">
                            <div class="fare-summary-card-new">
                              <div class="fs-header">Fare breakup</div>
                              <div class="fs-body">
                                <div class="fs-row total-row">
                                  <span class="fs-label">TOTAL</span>
                                  <span class="fs-value">â‚¹ {{ selectedFareOptions[i]?.Fare?.PublishedFare | number :
                                    "1.0-0" }}</span>
                                </div>
                                <div class="fs-row">
                                  <span class="fs-label">Base Fare</span>
                                  <span class="fs-value">â‚¹ {{ selectedFareOptions[i]?.Fare?.BaseFare | number : "1.0-0"
                                    }}</span>
                                </div>
                                <div class="fs-row">
                                  <span class="fs-label">Surcharges</span>
                                  <span class="fs-value">â‚¹ {{ selectedFareOptions[i]?.Fare?.Tax | number : "1.0-0"
                                    }}</span>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Cancellation Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'cancellation'">
                            <div class="cancellation-table-container"
                              *ngIf="getCancellationRows(selectedFareOptions[i] || flight.FareOptions[0]).length > 0; else noCancelPolicy">
                              <div class="c-row c-header">
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Time frame</span>
                                    <span class="c-subtitle">(From Scheduled Flight departure)</span>
                                  </div>
                                </div>
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Airline Fee </span>
                                    <span class="c-subtitle">(Per passenger)</span>
                                  </div>
                                </div>
                              </div>
                              <div class="c-row"
                                *ngFor="let row of getCancellationRows(selectedFareOptions[i] || flight.FareOptions[0])">
                                <div class="c-cell">{{ row.range }}</div>
                                <div class="c-cell" style="color: #000; font-weight: 500;">
                                  ADULT : {{ row.price }}
                                </div>
                              </div>
                            </div>
                            <ng-template #noCancelPolicy>
                              <div class="policy-content">
                                <p>{{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                              </div>
                            </ng-template>
                          </div>

                          <!-- Date Change Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'dateChange'">
                            <div class="cancellation-table-container"
                              *ngIf="getDateChangeRows(selectedFareOptions[i] || flight.FareOptions[0]).length > 0; else noDateChangePolicy">
                              <div class="c-row c-header">
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Time frame</span>
                                    <span class="c-subtitle">(From Scheduled Flight departure)</span>
                                  </div>
                                </div>
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Airline Fee + Fare difference</span>
                                    <span class="c-subtitle">(Per passenger)</span>
                                  </div>
                                </div>
                              </div>
                              <div class="c-row"
                                *ngFor="let row of getDateChangeRows(selectedFareOptions[i] || flight.FareOptions[0])">
                                <div class="c-cell">{{ row.range }}</div>
                                <div class="c-cell" style="color: #000; font-weight: 500;">
                                  ADULT : {{ row.policyText }}
                                </div>
                              </div>
                            </div>
                            <ng-template #noDateChangePolicy>
                              <div class="policy-content">
                                <p>{{ getDateChangeRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                              </div>
                            </ng-template>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="tab-pane">
                  <!-- Return Tab Content -->
                  <div class="tab-content return-tab-content" *ngIf="activeTab === 'return'">
                    <!-- Flight Count Header -->
                    <div class="flight-count-header"
                      *ngIf="groupedFlightsOutbound && groupedFlightsOutbound.length > 0">
                      <h2 class="flight-count-text">
                        {{ groupedFlightsOutbound.length }} {{ groupedFlightsOutbound.length === 1 ? 'Flight found' :
                        'Flights found' }}
                      </h2>
                      <div class="flight-announcement">
                        <div class="announceicobox">

                          <i class="fas fa-bullhorn announcement-icon"></i>
                        </div>
                        <span>Wizzride doesn't charge any convenience fee or service charge.</span>
                      </div>
                      <h2 class="flight-count-text">
                        Cheapest Flights First
                      </h2>
                    </div>
                    <div class="flight-cards roundnospace">
                      <div class="card mobile-flight-card-new" [class.roundtrip-selected]="selectedReturnIndex === i"
                        *ngFor="let flight of groupedFlightsOutbound; let i = index">
                        <label class="flight-radio-wrapper" (click)="toggleCardExpansion(i, $event)">
                          <input type="radio" name="returnFlight" [value]="flight" [(ngModel)]="selectedReturn" />

                          <div class="fltop">

                            <!-- DESKTOP SINGLE ROW LAYOUT -->
                            <div class="desktop-flight-row">
                              <!-- Airline Section -->
                              <div class="desktop-airline-section">
                                <img class="desktop-airline-logo"
                                  [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                                  [alt]="flight.Segments[0][0].Airline.AirlineName"
                                  onerror="this.src='assets/images/default-airline.png'" />
                                <div class="desktop-airline-info">
                                  <div class="desktop-airline-name">{{ flight.Segments[0][0].Airline.AirlineName }}
                                  </div>
                                  <div class="desktop-flight-number">{{ flight.Segments[0][0].Airline.AirlineCode }} {{
                                    flight.Segments[0][0].Airline.FlightNumber }}</div>
                                  <div class="desktop-aircraft-type">{{ flight.Segments[0][0].Craft || 'Aircraft' }}
                                  </div>
                                </div>
                              </div>

                              <!-- Departure Section -->
                              <div class="desktop-departure-section">
                                <div class="desktop-time">{{ flight.Segments[0][0].Origin.DepTime | date : "HH:mm" }}
                                </div>
                                <div class="desktop-date">{{ flight.Segments[0][0].Origin.DepTime | date : "EEE, dd MMM"
                                  }}</div>
                                <div class="desktop-airport">{{ flight.Segments[0][0].Origin.Airport.CityName }}</div>
                              </div>

                              <!-- Duration & Stops Section -->
                              <div class="desktop-duration-section">
                                <div class="desktop-duration-text">{{ getTotalDuration(flight.Segments[0]) }}</div>
                                <div class="desktop-stops-text" (mouseenter)="hoveredIndex = i"
                                  (mouseleave)="hoveredIndex = -1">
                                  {{ getStopsCount(flight) === 0 ? 'Non Stop' :
                                  getStopsCount(flight) + (getStopsCount(flight) === 1 ? ' Stop via ' : ' Stops via ') +
                                  getLayoverCity(flight) }}

                                  <div class="layover-tooltip" *ngIf="hoveredIndex === i && getStopsCount(flight) > 0">
                                    <div *ngFor="let info of getLayoverInfos(flight)" class="layover-item">
                                      <div class="layover-header">Plane change</div>
                                      <div class="layover-details">
                                        {{ info.city }} ({{ info.code }}) | {{ info.duration }} Layover
                                      </div>
                                      <div class="layover-timeline">
                                        <div class="dot"></div>
                                      </div>
                                      <div class="layover-timeline-text">
                                        {{ getStopsCount(flight) === 1 ? '1 stop' : 'Stop' }} via {{ info.city }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <!-- Arrival Section -->
                              <div class="desktop-arrival-section">
                                <div class="desktop-time">{{ flight.Segments[0][flight.Segments[0].length -
                                  1].Destination.ArrTime | date : "HH:mm" }}</div>
                                <div class="desktop-date">{{ flight.Segments[0][flight.Segments[0].length -
                                  1].Destination.ArrTime | date : "EEE, dd MMM" }}</div>
                                <div class="desktop-airport">{{ flight.Segments[0][flight.Segments[0].length -
                                  1].Destination.Airport.CityName }}</div>
                                <div class="desktop-day-diff"
                                  *ngIf="getDayDiff(flight.Segments[0][0].Origin.DepTime, flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime) > 0">
                                  +{{ getDayDiff(flight.Segments[0][0].Origin.DepTime,
                                  flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime) }} day
                                </div>
                              </div>

                              <!-- Price & Button Section -->
                              <div class="desktop-price-section">
                                <div class="desktop-price-amount">â‚¹ {{ flight.price | number : "1.0-0" }}</div>
                                <div class="desktop-price-label">per Adult</div>
                                <button class="desktop-view-prices-btn"
                                  (click)="selectFlightForRoundTrip(flight, i, 'return'); $event.stopPropagation()"
                                  *ngIf="selectedReturnIndex !== i">
                                  SELECT
                                </button>
                                <button class="desktop-view-prices-btn" (click)="$event.stopPropagation()"
                                  *ngIf="selectedReturnIndex === i"
                                  style="background-color: #2e7d32; border-color: #2e7d32; cursor: default;">
                                  SELECTED
                                </button>
                              </div>
                            </div>

                          </div>
                          <!-- END DESKTOP SINGLE ROW LAYOUT -->

                          <!-- NEW MOBILE FLIGHT CARD DESIGN -->
                          <ng-container *ngIf="flight.Segments.length > 1; else singleSegmentBlockReturn">
                            <section
                              class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                              aria-label="Flight Option"
                              (click)="openFareOptionsModalForRoundTrip(flight, i, 'return'); $event.stopPropagation()">
                              <ng-container *ngFor="let group of flight.Segments; let groupIndex = index">
                                <ng-container *ngFor="let segment of group; let j = index">
                                  <div class="flight-card-component__flight-leg">
                                    <div class="flight-card-component__leg-header">
                                      <img class="flight-card-component__airline-logo"
                                        [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                        [alt]="segment.Airline.AirlineName + ' logo'"
                                        onerror="this.src='assets/images/default-airline.png'" />
                                      <div class="flight-card-component__airline-info">
                                        <div class="flight-card-component__airline-name">{{ segment.Airline.AirlineName
                                          }}
                                        </div>
                                        <div class="flight-card-component__flight-code">{{ segment.Airline.AirlineCode
                                          }}
                                          {{ segment.Airline.FlightNumber }}</div>
                                      </div>
                                      <div class="flight-card-component__pill">{{ segment.Craft || 'Aircraft' }}</div>
                                    </div>
                                    <div class="flight-card-component__flight-row">
                                      <div class="flight-card-component__flight-left">
                                        <div class="flight-card-component__time">{{ segment.Origin.DepTime | date :
                                          "HH:mm" }}</div>
                                        <div class="flight-card-component__date">{{ segment.Origin.DepTime | date :
                                          "EEE, dd MMM" }}</div>
                                        <div class="flight-card-component__location">{{ segment.Origin.Airport.CityName
                                          }}<div class="flight-card-component_country-name">{{
                                            segment.Origin.Airport.CountryName }}</div>
                                        </div>
                                      </div>
                                      <div class="flight-card-component__flight-icon">
                                        <i class="fas fa-plane-departure"></i>
                                        <div class="flight-card-component__duration">{{
                                          formatMinutesToHrMin(segment.Duration) }}</div>
                                      </div>
                                      <div class="flight-card-component__flight-right">
                                        <div class="flight-card-component__day-diff"
                                          *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">
                                          +{{ getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }} day
                                        </div>
                                        <div class="flight-card-component__time">{{ segment.Destination.ArrTime | date :
                                          "HH:mm" }}</div>
                                        <div class="flight-card-component__date">{{ segment.Destination.ArrTime | date :
                                          "EEE, dd MMM" }}</div>
                                        <div class="flight-card-component__location">{{
                                          segment.Destination.Airport.CityName }}<div
                                            class="flight-card-component_country-name">{{
                                            segment.Destination.Airport.CountryName }}</div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div *ngIf="j < group.length - 1" class="flight-card-component__layover-row">
                                    <div class="flight-card-component__dotted-line"></div>
                                    <div class="flight-card-component__layover">
                                      <div class="flight-card-component__layover-day">{{ getLayoverDayText(group[j],
                                        group[j + 1]) }}</div>
                                      <div class="flight-card-component__layover-time">{{ getLayoverDuration(group[j],
                                        group[j + 1]) }}</div>
                                    </div>
                                    <div class="flight-card-component__dotted-line"></div>
                                  </div>
                                </ng-container>
                                <div class="flight-card-component__badges__intreturn " *ngIf="group?.length">
                                  <span class="flight-card-component__pill">{{ group.length - 1 === 0 ? "Non Stop" :
                                    group.length - 1 + " Stop" }}</span>
                                  <span class="flight-card-component__pill">{{ getGroupDuration(group) }}</span>
                                </div>
                                <div *ngIf="groupIndex < flight.Segments.length - 1"
                                  class="flight-card-component__group-separator">
                                  <div class="flight-card-component__dotted-line"></div>
                                </div>
                              </ng-container>
                              <div class="flight-card-component__footer">
                                <div class="flight-card-component__badges">
                                </div>
                                <div class="flight-card-component__price">
                                  <div class="flight-card-component__amount">â‚¹ {{ flight.price | number : "1.0-0" }}
                                  </div>
                                  <div class="flight-card-component__per">per Adult</div>
                                </div>
                                <button class="desktop-select-btn desktop-only"
                                  (click)="selectFlightForRoundTrip(flight, i, 'return'); $event.stopPropagation()"
                                  *ngIf="selectedReturnIndex !== i">
                                  SELECT
                                </button>
                                <button class="desktop-select-btn desktop-only selected"
                                  (click)="$event.stopPropagation()" *ngIf="selectedReturnIndex === i">
                                  SELECTED
                                </button>
                              </div>
                            </section>
                          </ng-container>
                          <ng-template #singleSegmentBlockReturn>
                            <section
                              class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                              aria-label="Flight Option"
                              (click)="openFareOptionsModalForRoundTrip(flight, i, 'return'); $event.stopPropagation()">
                              <ng-container *ngFor="let segment of flight.Segments[0]; let j = index">
                                <div class="flight-card-component__flight-leg">
                                  <div class="flight-card-component__leg-header">
                                    <img class="flight-card-component__airline-logo"
                                      [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                      [alt]="segment.Airline.AirlineName + ' logo'"
                                      onerror="this.src='assets/images/default-airline.png'" />
                                    <div class="flight-card-component__airline-info">
                                      <div class="flight-card-component__airline-name">{{ segment.Airline.AirlineName }}
                                      </div>
                                      <div class="flight-card-component__flight-code">{{ segment.Airline.AirlineCode }}
                                        {{
                                        segment.Airline.FlightNumber }}</div>
                                    </div>
                                    <div class="flight-card-component__pill">{{ segment.Craft || 'Aircraft' }}</div>
                                  </div>
                                  <div class="flight-card-component__flight-row">
                                    <div class="flight-card-component__flight-left">
                                      <div class="flight-card-component__time">{{ segment.Origin.DepTime | date :
                                        "HH:mm" }}</div>
                                      <div class="flight-card-component__date">{{ segment.Origin.DepTime | date : "EEE,
                                        dd MMM" }}</div>
                                      <div class="flight-card-component__location">{{ segment.Origin.Airport.CityName }}
                                      </div>
                                    </div>
                                    <div class="flight-card-component__flight-icon">
                                      <i class="fas fa-plane-departure"></i>
                                      <div class="flight-card-component__duration">{{
                                        formatMinutesToHrMin(segment.Duration) }}</div>
                                    </div>
                                    <div class="flight-card-component__flight-right">
                                      <div class="flight-card-component__day-diff"
                                        *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">+{{
                                        getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }} day</div>
                                      <div class="flight-card-component__time">{{ segment.Destination.ArrTime | date :
                                        "HH:mm" }}</div>
                                      <div class="flight-card-component__date">{{ segment.Destination.ArrTime | date :
                                        "EEE, dd MMM" }}</div>
                                      <div class="flight-card-component__location">{{
                                        segment.Destination.Airport.CityName }}</div>
                                    </div>
                                  </div>
                                </div>
                                <div *ngIf="j < flight.Segments[0].length - 1"
                                  class="flight-card-component__layover-row">
                                  <div class="flight-card-component__dotted-line"></div>
                                  <div class="flight-card-component__layover">
                                    <div class="flight-card-component__layover-day">{{
                                      getLayoverDayText(flight.Segments[0][j], flight.Segments[0][j + 1]) }}</div>
                                    <div class="flight-card-component__layover-time">{{
                                      getLayoverDuration(flight.Segments[0][j], flight.Segments[0][j + 1]) }}</div>
                                  </div>
                                  <div class="flight-card-component__dotted-line"></div>
                                </div>
                              </ng-container>
                              <div class="flight-card-component__footer">
                                <div class="flight-card-component__badges">
                                  <span class="flight-card-component__pill">{{ flight.Segments[0].length - 1 === 0 ?
                                    "Non
                                    Stop" : flight.Segments[0].length - 1 + " Stop" }}</span>
                                  <span class="flight-card-component__pill">{{ getTotalDuration(flight.Segments[0])
                                    }}</span>
                                </div>
                                <div class="flight-card-component__price">
                                  <div class="flight-card-component__amount">â‚¹ {{ flight.price | number : "1.0-0" }}
                                  </div>
                                  <div class="flight-card-component__per">per Adult</div>
                                </div>
                                <button class="flight-card-component__view-prices-btn desktop-only"
                                  (click)="openFareOptionsModalForRoundTrip(flight, i, 'return'); $event.stopPropagation()">
                                  View Prices
                                </button>
                              </div>
                            </section>
                          </ng-template>
                          <!-- END NEW MOBILE FLIGHT CARD DESIGN -->

                          <div class="refundability-tag"
                            [ngClass]="{ 'refundable': flight.isRefundable, 'non-refundable': !flight.isRefundable }">
                            {{ flight.isRefundable ? "Partially Refundable" : "Non-refundable" }}
                          </div>
                          <!-- Date Hanger -->
                          <div class="date-hanger">
                            <div class="date-content">
                              <span class="date-text">{{ flightInputData['returnDate'] | date : "d MMM, yyyy" }}</span>
                            </div>
                          </div>

                          <!-- Route -->
                          <div class="route">
                            <div class="vehicle">
                              <img
                                [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                                [alt]="flight.Segments[0][0].Airline.AirlineName"
                                onerror="this.src='assets/images/default-airline.png'" />
                            </div>

                            <div class="route-column">
                              <div class="route-code">{{ flight.Segments[0][0].Origin.Airport.AirportCode }}</div>
                              <div class="location">{{ flight.Segments[0][0].Origin.Airport.CityName }}</div>
                            </div>

                            <div class="route-visualization">
                              <div></div>
                              <div class="route-line">
                                <div class="route-node start-node"></div>
                                <div class="route-car">
                                  <i class="fas fa-plane-departure" style="font-size: 24px; color: #008b8b;"></i>
                                </div>
                                <div class="route-node end-node"></div>
                              </div>
                              <div class="route-details">
                                <div class="time">{{ flight.Segments[0][0].Origin.DepTime | date : "HH:mm" }} - {{
                                  flight.Segments[0][flight.Segments[0].length - 1].Destination.ArrTime | date : "HH:mm"
                                  }}</div>
                                <div class="duration">{{ getTotalDuration(flight.Segments[0]) }}</div>
                              </div>
                            </div>

                            <div class="route-column">
                              <div class="route-code">{{ flight.Segments[0][flight.Segments[0].length -
                                1].Destination.Airport.AirportCode }}</div>
                              <div class="location">{{ flight.Segments[0][flight.Segments[0].length -
                                1].Destination.Airport.CityName }}</div>
                            </div>
                          </div>

                          <!-- Mobile Amenities + Airline Display -->
                          <div class="mobile-amenities">
                            <div class="amenities-list">
                              <div class="amenity">
                                <i class="fas fa-plane-departure"></i>
                                <span>{{ getStopsCount(flight) === 0 ? 'Non-stop' : getStopsCount(flight) + ' Stop' +
                                  (getStopsCount(flight) > 1 ? 's' : '') }}</span>
                              </div>
                              <div class="amenity">
                                <i class="fas fa-suitcase"></i>
                                <span>Baggage</span>
                              </div>
                              <div class="amenity">
                                <i class="fas fa-ban"></i>
                                <span>Policy</span>
                              </div>
                            </div>
                            <div class="mobile-vehicle-visual">
                              <img
                                [src]="'assets/images/flightimages/' + flight.Segments[0][0].Airline.AirlineCode + '.png'"
                                [alt]="flight.Segments[0][0].Airline.AirlineName"
                                onerror="this.src='assets/images/default-airline.png'" />
                              <div class="mobile-vehicle-name">{{ flight.Segments[0][0].Airline.AirlineName }}</div>
                            </div>
                          </div>

                          <!-- Mobile Price Row -->
                          <div class="mobile-price-row">
                            <div class="mobile-seats-left">
                              <i class="fas fa-users"></i>
                              <span>Available</span>
                            </div>
                            <div class="mobile-start-price">
                              <span>Starts </span>
                              <span class="mobile-price">â‚¹ {{ flight.price | number : "1.0-0" }}</span>
                            </div>
                          </div>

                          <!-- Mobile Booking Button -->
                          <div class="mobile-booking-row">
                            <button class="btn mobile-book-btn"
                              (click)="openFareOptionsModalForRoundTrip(flight, i, activeTab); $event.stopPropagation()">
                              View Prices
                            </button>
                          </div>

                          <!-- Options -->
                          <div class="options">
                            <!-- Column 1: Stops/Amenities -->
                            <div class="option-item">
                              <div class="default-amenities">
                                <div class="amenity-item">
                                  <i class="fas fa-plane-departure"></i>
                                  <span>{{ getStopsCount(flight) === 0 ? 'Non-stop' : getStopsCount(flight) + ' Stop' +
                                    (getStopsCount(flight) > 1 ? 's' : '') }}</span>
                                </div>
                              </div>
                              <div class="hover-dropdowns">
                                <div class="dropdown">
                                  <i class="fas fa-list-alt"></i>
                                  <span>Flight Details</span>
                                  <div class="dropdown-content">
                                    {{ getStopsSummary(flight) }} - Duration: {{ getTotalDuration(flight.Segments[0]) }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Column 2: Baggage/Instructions -->
                            <div class="option-item">
                              <div class="default-amenities">
                                <div class="amenity-item">
                                  <i class="fas fa-suitcase"></i>
                                  <span>Baggage</span>
                                </div>
                              </div>
                              <div class="hover-dropdowns">
                                <div class="dropdown">
                                  <i class="fas fa-info-circle"></i>
                                  <span>Details</span>
                                  <div class="dropdown-content">
                                    Check-in: {{ selectedFareOptions[i]?.Segments?.[0]?.[0]?.Baggage || '15kg' }}<br>
                                    Cabin: {{ selectedFareOptions[i]?.Segments?.[0]?.[0]?.CabinBaggage || '7kg' }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Column 3: Policy/Cancellation Policy -->
                            <div class="option-item">
                              <div class="default-amenities">
                                <div class="amenity-item">
                                  <i class="fas fa-ban"></i>
                                  <span>Policy</span>
                                </div>
                              </div>
                              <div class="hover-dropdowns">
                                <div class="dropdown">
                                  <i class="fas fa-ban"></i>
                                  <span>Cancellation</span>
                                  <div class="dropdown-content">
                                    {{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Column 4: Price & View Prices Button -->
                            <div class="select-btn-card">
                              <div class="desktop-price-display">
                                <span class="price-label">Starts from</span>
                                <span class="price-value">â‚¹ {{ flight.price | number : "1.0-0" }}</span>
                              </div>
                              <button class="btn"
                                (click)="openFareOptionsModalForRoundTrip(flight, i, 'return'); $event.stopPropagation()">View
                                Prices</button>
                            </div>
                          </div>
                        </label>

                        <!-- Expandable Details -->
                        <div class="flight-details-expanded" *ngIf="flightDetailsExpanded[i]"
                          (click)="$event.stopPropagation()">
                          <div class="flight-tabs">
                            <div class="tab" *ngFor="let tab of tabs" [class.active]="activeTabs[i] === tab.id"
                              (click)="selectTab(i, tab.id); $event.stopPropagation()">
                              {{ tab.label }}
                            </div>
                          </div>

                          <!-- Flight Details Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'flight'">
                            <ng-container *ngFor="let segment of flight.Segments[0]; let segIndex = index">
                              <div class="segment-details">
                                <div class="flight-segment-layout">
                                  <div class="flight-info-compact">
                                    <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                      [alt]="segment.Airline.AirlineName" width="60" height="60"
                                      onerror="this.src='assets/images/default-airline.png'" />
                                    <div class="flight-name-number">
                                      <strong>{{ segment.Airline.AirlineName }}</strong> {{ segment.Airline.FlightNumber
                                      }}
                                    </div>
                                  </div>
                                  <div class="timing-info">
                                    <div class="time-block">
                                      <div class="time">{{ segment.Origin.DepTime | date : "HH:mm" }}</div>
                                      <div class="airport">{{ segment.Origin.Airport.CityName }} ({{
                                        segment.Origin.Airport.AirportCode }})</div>
                                    </div>
                                    <div class="duration">{{ getFormattedDuration(segment.Duration) }}</div>
                                    <div class="time-block">
                                      <div class="time">{{ segment.Destination.ArrTime | date : "HH:mm" }}</div>
                                      <div class="airport">{{ segment.Destination.Airport.CityName }} ({{
                                        segment.Destination.Airport.AirportCode }})</div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <!-- Layover Separator -->
                              <div class="layover-container" *ngIf="segIndex < flight.Segments[0].length - 1">
                                <div class="layover-line"></div>
                                <div class="layover-badge">
                                  <span class="change-planes">Change of planes</span>
                                  <span class="layover-detail">{{ getLayoverDuration(segment,
                                    flight.Segments[0][segIndex +
                                    1]) }} in {{ segment.Destination.Airport.CityName }}</span>
                                </div>
                              </div>
                            </ng-container>
                          </div>

                          <!-- Fare Summary Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'fare'">
                            <div class="fare-summary-card-new">
                              <div class="fs-header">Fare breakup</div>
                              <div class="fs-body">
                                <div class="fs-row total-row">
                                  <span class="fs-label">TOTAL</span>
                                  <span class="fs-value">â‚¹ {{ selectedFareOptions[i]?.Fare?.PublishedFare | number :
                                    "1.0-0" }}</span>
                                </div>
                                <div class="fs-row">
                                  <span class="fs-label">Base Fare</span>
                                  <span class="fs-value">â‚¹ {{ selectedFareOptions[i]?.Fare?.BaseFare | number : "1.0-0"
                                    }}</span>
                                </div>
                                <div class="fs-row">
                                  <span class="fs-label">Surcharges</span>
                                  <span class="fs-value">â‚¹ {{ selectedFareOptions[i]?.Fare?.Tax | number : "1.0-0"
                                    }}</span>
                                </div>
                              </div>
                            </div>
                          </div>

                          <!-- Cancellation Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'cancellation'">
                            <div class="cancellation-table-container"
                              *ngIf="getCancellationRows(selectedFareOptions[i] || flight.FareOptions[0]).length > 0; else noCancelPolicy">
                              <div class="c-row c-header">
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Time frame</span>
                                    <span class="c-subtitle">(From Scheduled Flight departure)</span>
                                  </div>
                                </div>
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Airline Fee </span>
                                    <span class="c-subtitle">(Per passenger)</span>
                                  </div>
                                </div>
                              </div>
                              <div class="c-row"
                                *ngFor="let row of getCancellationRows(selectedFareOptions[i] || flight.FareOptions[0])">
                                <div class="c-cell">{{ row.range }}</div>
                                <div class="c-cell" style="color: #000; font-weight: 500;">
                                  ADULT : {{ row.price }}
                                </div>
                              </div>
                            </div>
                            <ng-template #noCancelPolicy>
                              <div class="policy-content">
                                <p>{{ getCancellationRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                              </div>
                            </ng-template>
                          </div>

                          <!-- Date Change Tab -->
                          <div class="tab-content" *ngIf="activeTabs[i] === 'dateChange'">
                            <div class="cancellation-table-container"
                              *ngIf="getDateChangeRows(selectedFareOptions[i] || flight.FareOptions[0]).length > 0; else noDateChangePolicy">
                              <div class="c-row c-header">
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Time frame</span>
                                    <span class="c-subtitle">(From Scheduled Flight departure)</span>
                                  </div>
                                </div>
                                <div class="c-cell">
                                  <div class="c-cell-header-content">
                                    <span class="c-title">Airline Fee + Fare difference</span>
                                    <span class="c-subtitle">(Per passenger)</span>
                                  </div>
                                </div>
                              </div>
                              <div class="c-row"
                                *ngFor="let row of getDateChangeRows(selectedFareOptions[i] || flight.FareOptions[0])">
                                <div class="c-cell">{{ row.range }}</div>
                                <div class="c-cell" style="color: #000; font-weight: 500;">
                                  ADULT : {{ row.policyText }}
                                </div>
                              </div>
                            </div>
                            <ng-template #noDateChangePolicy>
                              <div class="policy-content">
                                <p>{{ getDateChangeRule(selectedFareOptions[i] || flight.FareOptions[0]) }}</p>
                              </div>
                            </ng-template>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Footer for Selected Onward Flight -->
                    <div class="selected-flight-card-dark"
                      *ngIf="flightType === 'round' && activeTab === 'return' && selectedOutboundFooter && !selectedReturn">
                      <div class="flight-row-header">âœ… Selected Onward Flight</div>

                      <!-- Loop over segments -->
                      <div class="segment-list">
                        <div class="segment-row" *ngFor="
                            let seg of selectedOutboundFooter.Segments[0];
                            let i = index;
                            let last = last
                          ">
                          <div class="segment-left">
                            <img [src]="'assets/images/flightimages/' + seg?.Airline?.AirlineCode + '.png'"
                              class="airline-logo" alt="logo" onerror="this.src='assets/images/default-airline.png'" />
                            <span class="flight-code">
                              {{ seg?.Airline?.AirlineCode }}
                              {{ seg?.Airline?.FlightNumber }}
                            </span>
                            <span>
                              {{ seg?.Origin?.Airport?.AirportCode }}
                              <i class="fas fa-plane-arrival planemargin"></i>
                              {{ seg?.Destination?.Airport?.AirportCode }}
                            </span>

                            <!-- Only show Stop & Duration on last row -->
                            <span *ngIf="last" class="stop-duration-inline">
                              &nbsp;
                              {{ selectedOutboundFooter.Segments[0].length - 1 > 0 ?
                              (selectedOutboundFooter.Segments[0].length - 1) + ' Stop |' : '0 Stop |' }}
                              <strong>Duration:</strong>
                              {{ getTotalDurationForFlight(selectedOutboundFooter) }}
                            </span>
                          </div>

                          <!-- First segment gets Dep Time -->
                          <div class="segment-right" *ngIf="i === 0">
                            <strong>Dep. Time:</strong>
                            {{ seg?.Origin?.DepTime | date : "HH:mm" }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- No Flights Messages -->
                    <div class="no-flights"
                      *ngIf="(!groupedFlightsOutbound || groupedFlightsOutbound.length === 0) && !loader">
                      <h3>No Return Flights Found</h3>
                      <p>No return flights found for your search criteria. Please try modifying your search.</p>
                    </div>
                  </div>
                </div>

                <!-- Round Trip Selection Bottom Strip (inside scroll area so it appears below flight list) -->
                <div class="roundtrip-selection-strip"
                  *ngIf="flightType === 'round' && selectedOutbound && selectedReturn">
                  <div class="strip-container">
                    <!-- Onward Flight Info -->
                    <div class="flight-info-section">
                      <div class="section-header">Departure â€¢ {{ selectedOutbound.Segments[0][0].Airline.AirlineName }}
                      </div>
                      <div class="section-body">
                        <img
                          [src]="'assets/images/flightimages/' + selectedOutbound.Segments[0][0].Airline.AirlineCode + '.png'"
                          class="strip-airline-logo" onerror="this.src='assets/images/default-airline.png'">
                        <div class="flight-details-mid">
                          <div class="flight-route-time">
                            {{ selectedOutbound.Segments[0][0].Origin.DepTime | date:'HH:mm' }} &rarr;
                            {{ selectedOutbound.Segments[0][selectedOutbound.Segments[0].length-1].Destination.ArrTime |
                            date:'HH:mm' }}
                          </div>
                          <div class="flight-details-link"
                            (click)="openRoundTripFlightDetails(selectedOutbound, 'onward'); $event.stopPropagation()">
                            Flight
                            Details</div>
                        </div>
                        <div class="section-price">
                          â‚¹ {{ (selectedOutbound.selectedFareOption?.Fare?.PublishedFare || selectedOutbound.price) |
                          number:'1.0-0' }}
                        </div>
                      </div>
                    </div>

                    <div class="divider-vertical"></div>

                    <!-- Return Flight Info -->
                    <div class="flight-info-section">
                      <div class="section-header">Return â€¢ {{ selectedReturn.Segments[0][0].Airline.AirlineName }}</div>
                      <div class="section-body">
                        <img
                          [src]="'assets/images/flightimages/' + selectedReturn.Segments[0][0].Airline.AirlineCode + '.png'"
                          class="strip-airline-logo" onerror="this.src='assets/images/default-airline.png'">
                        <div class="flight-details-mid">
                          <div class="flight-route-time">
                            {{ selectedReturn.Segments[0][0].Origin.DepTime | date:'HH:mm' }} &rarr;
                            {{ selectedReturn.Segments[0][selectedReturn.Segments[0].length-1].Destination.ArrTime |
                            date:'HH:mm' }}
                          </div>
                          <div class="flight-details-link"
                            (click)="openRoundTripFlightDetails(selectedReturn, 'return'); $event.stopPropagation()">
                            Flight
                            Details</div>
                        </div>
                        <div class="section-price">
                          â‚¹ {{ (selectedReturn.selectedFareOption?.Fare?.PublishedFare || selectedReturn.price) |
                          number:'1.0-0' }}
                        </div>
                      </div>
                    </div>

                    <div class="divider-vertical show-desktop"></div>

                    <!-- Total & Action -->
                    <div class="strip-actions">
                      <div class="total-price-block">
                        <div class="price-row">
                          <span class="currency">â‚¹</span>
                          <span class="amount">{{ ((selectedOutbound.selectedFareOption?.Fare?.PublishedFare ||
                            selectedOutbound.price || 0) + (selectedReturn.selectedFareOption?.Fare?.PublishedFare ||
                            selectedReturn.price || 0)) | number:'1.0-0' }}</span>
                        </div>
                        <div class="price-subtitle">/adult</div>
                        <div class="fare-details-container" style="position: relative;">
                          <div class="fare-details-link" (click)="toggleFareDetailsTooltip(); $event.stopPropagation()">
                            Fare Details</div>

                          <div class="fare-details-tooltip" *ngIf="showFareDetailsTooltip"
                            (click)="$event.stopPropagation()">
                            <div class="tooltip-header">Fare Summary</div>
                            <div class="tooltip-content">
                              <div class="tooltip-row">
                                <span class="label">Total base fare</span>
                                <span class="value">â‚¹ {{ getTotalBaseFare() | number:'1.0-0' }}</span>
                              </div>
                              <div class="tooltip-row">
                                <span class="label">Total Surcharges</span>
                                <span class="value">â‚¹ {{ getTotalSurcharges() | number:'1.0-0' }}</span>
                              </div>
                              <div class="tooltip-divider"></div>
                              <div class="tooltip-row total-row">
                                <span class="label">Total Amount</span>
                                <span class="value">â‚¹ {{ getTotalAmount() | number:'1.0-0' }}</span>
                              </div>
                            </div>
                            <div class="tooltip-arrow"></div>
                          </div>
                        </div>
                      </div>
                      <div class="action-buttons">
                        <button class="book-now-btn" (click)="finalizeRoundTripBooking()">
                          BOOK NOW
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Mobile Round Trip Selected Flight Strip -->
                <div class="mobile-round-trip-selected-strip" *ngIf="flightType === 'round'">
                  <!-- Show Onward when on Return Tab -->
                  <div class="mr-selected-card" *ngIf="activeTab === 'return' && selectedOutbound"
                    (click)="switchTab('onward')">
                    <div class="mr-header">
                      <i class="fas fa-check-square"></i> Selected Onward Flight
                    </div>
                    <div class="mr-body">
                      <div class="mr-left-col">
                        <div class="mr-airline-row">
                          <img
                            [src]="'assets/images/flightimages/' + selectedOutbound.Segments[0][0].Airline.AirlineCode + '.png'"
                            class="mr-logo" onerror="this.src='assets/images/default-airline.png'">
                          <div class="mr-flight-texts">
                            <span class="mr-airline-code">{{ selectedOutbound.Segments[0][0].Airline.AirlineCode }} {{
                              selectedOutbound.Segments[0][0].Airline.FlightNumber }}</span>
                            <span class="mr-airline-name">{{ selectedOutbound.Segments[0][0].Airline.AirlineName
                              }}</span>
                          </div>
                        </div>
                      </div>

                      <div class="mr-mid-col">
                        <div class="mr-time-row">
                          <div class="mr-time-block">
                            <span class="mr-time">{{ selectedOutbound.Segments[0][0].Origin.DepTime | date:'HH:mm'
                              }}</span>
                            <span class="mr-airport">{{ selectedOutbound.Segments[0][0].Origin.Airport.AirportCode
                              }}</span>
                          </div>
                          <div class="mr-icon-block">
                            <i class="fas fa-plane"></i>
                            <span class="mr-dur">{{ getTotalDuration(selectedOutbound.Segments[0]) }}</span>
                          </div>
                          <div class="mr-time-block">
                            <span class="mr-time">{{
                              selectedOutbound.Segments[0][selectedOutbound.Segments[0].length-1].Destination.ArrTime
                              | date:'HH:mm' }}</span>
                            <span class="mr-airport">{{
                              selectedOutbound.Segments[0][selectedOutbound.Segments[0].length-1].Destination.Airport.AirportCode
                              }}</span>
                          </div>
                        </div>
                      </div>

                      <div class="mr-right-col">
                        <div class="mr-price">â‚¹ {{ (selectedOutbound.selectedFareOption?.Fare?.PublishedFare ||
                          selectedOutbound.price) | number:'1.0-0' }}</div>
                        <div class="mr-per-adult">per Adult</div>
                      </div>
                    </div>
                  </div>

                  <!-- Show Return when on Onward Tab (if selected) -->
                  <div class="mr-selected-card" *ngIf="activeTab === 'onward' && selectedReturn"
                    (click)="switchTab('return')">
                    <div class="mr-header">
                      <i class="fas fa-check-square"></i> Selected Return Flight
                    </div>
                    <div class="mr-body">
                      <div class="mr-left-col">
                        <div class="mr-airline-row">
                          <img
                            [src]="'assets/images/flightimages/' + selectedReturn.Segments[0][0].Airline.AirlineCode + '.png'"
                            class="mr-logo" onerror="this.src='assets/images/default-airline.png'">
                          <div class="mr-flight-texts">
                            <span class="mr-airline-code">{{ selectedReturn.Segments[0][0].Airline.AirlineCode }} {{
                              selectedReturn.Segments[0][0].Airline.FlightNumber }}</span>
                            <span class="mr-airline-name">{{ selectedReturn.Segments[0][0].Airline.AirlineName
                              }}</span>
                          </div>
                        </div>
                      </div>

                      <div class="mr-mid-col">
                        <div class="mr-time-row">
                          <div class="mr-time-block">
                            <span class="mr-time">{{ selectedReturn.Segments[0][0].Origin.DepTime | date:'HH:mm'
                              }}</span>
                            <span class="mr-airport">{{ selectedReturn.Segments[0][0].Origin.Airport.AirportCode
                              }}</span>
                          </div>
                          <div class="mr-icon-block">
                            <i class="fas fa-plane"></i>
                            <span class="mr-dur">{{ getTotalDuration(selectedReturn.Segments[0]) }}</span>
                          </div>
                          <div class="mr-time-block">
                            <span class="mr-time">{{
                              selectedReturn.Segments[0][selectedReturn.Segments[0].length-1].Destination.ArrTime |
                              date:'HH:mm' }}</span>
                            <span class="mr-airport">{{
                              selectedReturn.Segments[0][selectedReturn.Segments[0].length-1].Destination.Airport.AirportCode
                              }}</span>
                          </div>
                        </div>
                      </div>

                      <div class="mr-right-col">
                        <div class="mr-price">â‚¹ {{ (selectedReturn.selectedFareOption?.Fare?.PublishedFare ||
                          selectedReturn.price) | number:'1.0-0' }}</div>
                        <div class="mr-per-adult">per Adult</div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="flight-details-popup" [class.active]="showFlightDetailsPopup">

                  <!-- Header -->
                  <div class="popup-header-row">
                    <!-- Onward Summary -->
                    <div class="popup-flight-summary" [class.active]="activePopupTab === 'onward'"
                      (click)="switchPopupTab('onward')">
                      <div class="summary-label-row">
                        <span>ONWARD</span>
                        <span *ngIf="popupFlightOnward">{{ popupFlightOnward.Segments[0][0].Origin.Airport.CityName }} -
                          {{
                          popupFlightOnward.Segments[0][popupFlightOnward.Segments[0].length-1].Destination.Airport.CityName
                          }}</span>
                      </div>
                      <div *ngIf="popupFlightOnward">
                        <div class="summary-airline">{{ popupFlightOnward.Segments[0][0].Airline.AirlineName }}</div>
                        <div class="summary-route-row">
                          <div class="summary-times">
                            {{ popupFlightOnward.Segments[0][0].Origin.DepTime | date:'HH:mm' }} -
                            {{ popupFlightOnward.Segments[0][popupFlightOnward.Segments[0].length -
                            1].Destination.ArrTime |
                            date:'HH:mm' }}
                          </div>
                          <div class="summary-price">â‚¹ {{ popupFlightOnward.price | number:'1.0-0' }}</div>
                        </div>
                        <a href="javascript:void(0)" class="flight-details-link">Flight Details</a>
                      </div>
                      <div *ngIf="!popupFlightOnward" style="color: #ccc; margin-top: 10px;">Select onward flight</div>
                    </div>

                    <!-- Return Summary -->
                    <div class="popup-flight-summary" [class.active]="activePopupTab === 'return'"
                      (click)="switchPopupTab('return')">
                      <div class="summary-label-row">
                        <span>RETURN</span>
                        <span *ngIf="popupFlightReturn">{{ popupFlightReturn.Segments[0][0].Origin.Airport.CityName }} -
                          {{
                          popupFlightReturn.Segments[0][popupFlightReturn.Segments[0].length-1].Destination.Airport.CityName
                          }}</span>
                      </div>
                      <div *ngIf="popupFlightReturn">
                        <div class="summary-airline">{{ popupFlightReturn.Segments[0][0].Airline.AirlineName }}</div>
                        <div class="summary-route-row">
                          <div class="summary-times">
                            {{ popupFlightReturn.Segments[0][0].Origin.DepTime | date:'HH:mm' }} -
                            {{ popupFlightReturn.Segments[0][popupFlightReturn.Segments[0].length -
                            1].Destination.ArrTime |
                            date:'HH:mm' }}
                          </div>
                          <div class="summary-price">â‚¹ {{ popupFlightReturn.price | number:'1.0-0' }}</div>
                        </div>
                        <a href="javascript:void(0)" class="flight-details-link">Flight Details</a>
                      </div>
                      <div *ngIf="!popupFlightReturn" style="color: #ccc; margin-top: 10px;">Select return flight</div>
                    </div>

                    <button class="popup-close-btn" (click)="closeFlightDetailsPopup()">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>

                  <!-- Tabs -->
                  <div class="popup-tabs-row">
                    <button class="popup-tab-btn" [class.active]="popupDetailsTab === 'flight'"
                      (click)="switchPopupDetailsTab('flight')">FLIGHT DETAILS</button>
                    <button class="popup-tab-btn" [class.active]="popupDetailsTab === 'fare'"
                      (click)="switchPopupDetailsTab('fare')">FARE SUMMARY</button>
                    <button class="popup-tab-btn" [class.active]="popupDetailsTab === 'cancellation'"
                      (click)="switchPopupDetailsTab('cancellation')">CANCELLATION</button>
                    <button class="popup-tab-btn" [class.active]="popupDetailsTab === 'dateChange'"
                      (click)="switchPopupDetailsTab('dateChange')">DATE CHANGE</button>
                  </div>

                  <!-- Content -->
                  <div class="popup-content-body">

                    <!-- FLIGHT DETAILS TAB -->
                    <div *ngIf="popupDetailsTab === 'flight'" class="popup-tab-content">
                      <ng-container
                        *ngIf="activePopupTab === 'onward' ? popupFlightOnward : popupFlightReturn as currentFlight">
                        <div *ngIf="currentFlight">
                          <ng-container *ngFor="let segment of currentFlight.Segments[0]; let segIndex = index">
                            <div class="flight-details-card-new">
                              <div class="fd-header">
                                <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                  [alt]="segment.Airline.AirlineName" class="fd-logo"
                                  onerror="this.src='assets/images/default-airline.png'" />
                                <div class="fd-airline-text">
                                  <span class="fd-name">{{ segment.Airline.AirlineName }}</span>
                                  <span class="fd-code">{{ segment.Airline.AirlineCode }} | {{
                                    segment.Airline.FlightNumber
                                    }}</span>
                                  <span class="fd-craft pill">{{ segment.Craft || 'Aircraft' }}</span>
                                </div>
                              </div>

                              <div class="fd-body">
                                <div class="fd-col fd-dep">
                                  <div class="fd-time">{{ segment.Origin.DepTime | date : "HH:mm" }}</div>
                                  <div class="fd-date">{{ segment.Origin.DepTime | date : "EEE, dd MMM" }}</div>
                                  <div class="fd-place">{{ segment.Origin.Airport.CityName }}</div>
                                  <div class="fd-terminal" *ngIf="segment.Origin.Airport.Terminal">Terminal {{
                                    segment.Origin.Airport.Terminal }}</div>
                                </div>
                                <div class="durnew">
                                  <div class="fd-col fd-dur">
                                    <div class="fd-duration-text">{{ getFormattedDuration(segment.Duration) }}</div>
                                    <div class="fd-bar"></div>
                                  </div>
                                </div>
                                <div class="fd-col fd-arr">
                                  <div class="fd-time">{{ segment.Destination.ArrTime | date : "HH:mm" }}</div>
                                  <div class="fd-date">{{ segment.Destination.ArrTime | date : "EEE, dd MMM" }}</div>
                                  <div class="fd-place">{{ segment.Destination.Airport.CityName }}</div>
                                  <div class="fd-terminal" *ngIf="segment.Destination.Airport.Terminal">Terminal {{
                                    segment.Destination.Airport.Terminal }}</div>
                                </div>

                                <div class="fd-col fd-bag">
                                  <div class="fd-bag-group">
                                    <span class="fd-label">CHECK-IN</span>
                                    <span class="fd-val">{{
                                      (currentFlight.selectedFareOption?.Segments?.[0]?.[0]?.Baggage ||
                                      currentFlight.FareOptions[0]?.Segments?.[0]?.[0]?.Baggage) || '15 Kgs'
                                      }} (1 piece)</span>
                                  </div>
                                </div>
                                <div class="fd-bag-group">
                                  <span class="fd-label">CABIN</span>
                                  <span class="fd-val">{{
                                    (currentFlight.selectedFareOption?.Segments?.[0]?.[0]?.CabinBaggage ||
                                    currentFlight.FareOptions[0]?.Segments?.[0]?.[0]?.CabinBaggage) || '7 Kgs' }} (1
                                    piece)</span>
                                </div>
                              </div>
                            </div>

                            <!-- Layover Separator -->
                            <div class="layover-container" *ngIf="segIndex < currentFlight.Segments[0].length - 1">
                              <div class="layover-line"></div>
                              <div class="layover-badge">
                                <span class="change-planes">Change of planes</span>
                                <span class="layover-detail">{{ getLayoverDuration(segment,
                                  currentFlight.Segments[0][segIndex +
                                  1]) }} in {{ segment.Destination.Airport.CityName }}</span>
                              </div>
                            </div>
                          </ng-container>
                        </div>
                        <div *ngIf="!currentFlight" class="text-center p-4">
                          <p>No flight selected for this leg.</p>
                        </div>
                      </ng-container>
                    </div>

                    <!-- FARE SUMMARY TAB -->
                    <div *ngIf="popupDetailsTab === 'fare'" class="popup-tab-content">
                      <ng-container
                        *ngIf="activePopupTab === 'onward' ? popupFlightOnward : popupFlightReturn as currentFlight">
                        <div *ngIf="currentFlight" class="fare-summary-card-new">
                          <div class="fs-header">Fare breakup</div>
                          <div class="cancellation-table-container">
                            <div class="c-row">
                              <div class="c-cell">Base Fare</div>
                              <div class="c-cell" style="text-align: right; color: #000; font-weight: 500;">
                                â‚¹ {{ (currentFlight.selectedFareOption?.Fare?.BaseFare ||
                                currentFlight.FareOptions[0]?.Fare?.BaseFare || 0) | number : "1.0-0" }}
                              </div>
                            </div>
                            <div class="c-row">
                              <div class="c-cell">Surcharges</div>
                              <div class="c-cell" style="text-align: right; color: #000; font-weight: 500;">
                                â‚¹ {{ (currentFlight.selectedFareOption?.Fare?.Tax ||
                                currentFlight.FareOptions[0]?.Fare?.Tax || 0) | number : "1.0-0" }}
                              </div>
                            </div>
                            <div class="c-row" style="border-bottom: none;">
                              <div class="c-cell" style="font-weight: 700; color: #000;">TOTAL</div>
                              <div class="c-cell" style="text-align: right; font-weight: 700; color: #000;">
                                â‚¹ {{ (currentFlight.selectedFareOption?.Fare?.PublishedFare ||
                                currentFlight.FareOptions[0]?.Fare?.PublishedFare || 0) | number : "1.0-0" }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>

                    <!-- CANCELLATION TAB -->
                    <div *ngIf="popupDetailsTab === 'cancellation'" class="popup-tab-content">
                      <ng-container
                        *ngIf="activePopupTab === 'onward' ? popupFlightOnward : popupFlightReturn as currentFlight">
                        <div *ngIf="currentFlight">
                          <div class="cancellation-table-container"
                            *ngIf="getCancellationRows(currentFlight.selectedFareOption || currentFlight.FareOptions[0]).length > 0; else noCancelPolicy">
                            <div class="c-row c-header">
                              <div class="c-cell">
                                <div class="c-cell-header-content">
                                  <span class="c-title">Time frame</span>
                                  <span class="c-subtitle">(From Scheduled Flight departure)</span>
                                </div>
                              </div>
                              <div class="c-cell">
                                <div class="c-cell-header-content">
                                  <span class="c-title">Airline Fee </span>
                                  <span class="c-subtitle">(Per passenger)</span>
                                </div>
                              </div>
                            </div>
                            <div class="c-row"
                              *ngFor="let row of getCancellationRows(currentFlight.selectedFareOption || currentFlight.FareOptions[0])">
                              <div class="c-cell">{{ row.range }}</div>
                              <div class="c-cell" style="color: #000; font-weight: 500;">
                                {{ row.price }}
                              </div>
                            </div>
                          </div>
                          <ng-template #noCancelPolicy>
                            <div class="policy-content">
                              <p>{{ getCancellationRule(currentFlight.selectedFareOption ||
                                currentFlight.FareOptions[0]) }}</p>
                            </div>
                          </ng-template>
                        </div>
                      </ng-container>
                    </div>

                    <!-- DATE CHANGE TAB -->
                    <div *ngIf="popupDetailsTab === 'dateChange'" class="popup-tab-content">
                      <ng-container
                        *ngIf="activePopupTab === 'onward' ? popupFlightOnward : popupFlightReturn as currentFlight">
                        <div *ngIf="currentFlight">
                          <div class="cancellation-table-container"
                            *ngIf="getDateChangeRows(currentFlight.selectedFareOption || currentFlight.FareOptions[0]).length > 0; else noDateChangePolicy">
                            <div class="c-row c-header">
                              <div class="c-cell">
                                <div class="c-cell-header-content">
                                  <span class="c-title">Time frame</span>
                                  <span class="c-subtitle">(From Scheduled Flight departure)</span>
                                </div>
                              </div>
                              <div class="c-cell">
                                <div class="c-cell-header-content">
                                  <span class="c-title">Airline Fee + Fare difference</span>
                                  <span class="c-subtitle">(Per passenger)</span>
                                </div>
                              </div>
                            </div>
                            <div class="c-row"
                              *ngFor="let row of getDateChangeRows(currentFlight.selectedFareOption || currentFlight.FareOptions[0])">
                              <div class="c-cell">{{ row.range }}</div>
                              <div class="c-cell" style="color: #000; font-weight: 500;">
                                {{ row.policyText }}
                              </div>
                            </div>
                          </div>
                          <ng-template #noDateChangePolicy>
                            <div class="policy-content">
                              <p>{{ getDateChangeRule(currentFlight.selectedFareOption || currentFlight.FareOptions[0])
                                }}</p>
                            </div>
                          </ng-template>
                        </div>
                      </ng-container>
                    </div>

                  </div>
                </div>
              </div>

              <!-- No Flights Message for Onward -->
              <div class="no-flights"
                *ngIf="activeTab === 'onward' && (!groupedFlights || groupedFlights.length === 0) && !loader">
                <h3>No Onward Flights Found</h3>
                <p>No onward flights found for your search criteria. Please try modifying your search.</p>
              </div>

              <!-- Expandable Flight Details Section -->
              <div class="footer-expand-section" *ngIf="expandedFlightDetailsBothway">
                <div class="footer-expand-inner">
                  <div class="footer-expand-tabs">
                    <div class="tab" [class.active]="expandedTypeBothway === 'departure'"
                      (click)="toggleBothFlightDetails('departure')">Departure</div>
                    <div class="tab" [class.active]="expandedTypeBothway === 'return'"
                      (click)="toggleBothFlightDetails('return')">Return</div>
                  </div>

                  <!-- DEPARTURE DETAILS TAB SECTION -->
                  <div class="footer-tab-content" *ngIf="expandedTypeBothway === 'departure'">
                    <div class="flight-list-extention-div1">
                      <div class="flight-tabs">
                        <div class="tab" *ngFor="let tab of tabsBoth"
                          [class.active]="footerTabBothwayOutbound === tab.id"
                          (click)="setFooterTabBothwayOutbound(tab.id)">
                          {{ tab.label }}
                        </div>
                      </div>

                      <!-- Flight Tab -->
                      <div class="flight-tab-content" *ngIf="footerTabBothwayOutbound === 'flight'">
                        <div class="tab-heading">
                          {{ selectedOutbound.Origin.Airport.CityName }} to {{
                          selectedOutbound.Destination.Airport.CityName }},
                          {{ selectedOutbound.Origin.DepTime | date : "mediumDate" }}
                        </div>
                        <ng-container *ngFor="let segment of selectedOutbound.Segments[0]; let i = index">
                          <div class="tab-content-section">
                            <div class="flight-info">
                              <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                width="40" height="40" />
                              <strong>{{ segment.Airline.AirlineName }}</strong> {{ segment.Airline.FlightNumber }}
                              <div class="tag">{{ segment.Craft }}</div>
                            </div>
                            <div class="timing-row">
                              <div class="time-block">
                                <div class="time">{{ segment.Origin.DepTime | date : "shortTime" }}</div>
                                <div class="date">{{ segment.Origin.DepTime | date : "mediumDate" }}</div>
                                <div class="terminal">
                                  Terminal - {{ segment.Origin.Airport.Terminal || "-" }}<br />
                                  {{ segment.Origin.Airport.CityName }}
                                </div>
                              </div>
                              <div class="duration">{{ segment.Duration / 60 | number : "1.0-0" }}h {{ segment.Duration
                                % 60 }}m</div>
                              <div class="time-block">
                                <div class="time">{{ segment.Destination.ArrTime | date : "shortTime" }}</div>
                                <div class="date">{{ segment.Destination.ArrTime | date : "mediumDate" }}</div>
                                <div class="terminal">
                                  Terminal - {{ segment.Destination.Airport.Terminal || "-" }}<br />
                                  {{ segment.Destination.Airport.CityName }}
                                </div>
                              </div>
                            </div>
                            <div class="baggage-info">
                              <div><strong>BAGGAGE:</strong> ADULT</div>
                              <div><strong>CHECK IN : </strong>{{ segment.Baggage || "N/A" }}</div>
                              <div><strong>CABIN : </strong>{{ segment.CabinBaggage || "N/A" }}</div>
                            </div>
                          </div>
                          <div *ngIf="i < selectedOutbound.Segments[0].length - 1" class="layover-banner">
                            <div class="layover-label">Change of planes</div>
                            <div class="layover-text">
                              <strong>{{ getLayoverFormattedDuration(selectedOutbound.Segments[0][i],
                                selectedOutbound.Segments[0][i + 1]) }}</strong>
                              Layover in {{ segment.Destination.Airport.CityName }}
                            </div>
                          </div>
                        </ng-container>
                      </div>

                      <!-- Fare Summary -->
                      <div class="flight-tab-content" *ngIf="footerTabBothwayOutbound === 'fare'">
                        <div class="tab-heading">Fare Summary</div>
                        <table class="fare-summary-table">
                          <tr>
                            <th>Total</th>
                            <td><strong>â‚¹ {{ (selectedOutbound.FareOptions[0]?.Fare?.BaseFare +
                                selectedOutbound.FareOptions[0]?.Fare?.Tax) | number : "1.0-0" }}</strong></td>
                          </tr>
                          <tr>
                            <th>Base Fare</th>
                            <td>â‚¹ {{ selectedOutbound.FareOptions[0]?.Fare?.BaseFare | number : "1.0-0" }}</td>
                          </tr>
                          <tr>
                            <th>Surcharges</th>
                            <td>â‚¹ {{ selectedOutbound.FareOptions[0]?.Fare?.Tax | number : "1.0-0" }}</td>
                          </tr>
                        </table>
                      </div>

                      <!-- Cancellation -->
                      <div class="flight-tab-content"
                        *ngIf="footerTabBothwayOutbound === 'cancellation' && selectedOutbound.isRefundable">
                        <div class="tab-heading">Cancellation Policy</div>
                        <table class="cancellation-policy-table">
                          <thead>
                            <tr>
                              <th>Route</th>
                              <th>Time Frame</th>
                              <th>Airline + Wizzride Fee</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let policy of selectedOutbound.FareOptions[0]?.cancellationPolicy">
                              <td>{{ selectedOutbound.Origin.Airport.CityName }} - {{
                                selectedOutbound.Destination.Airport.CityName }}</td>
                              <td>{{ policy.From }} {{ policy.Unit?.toLowerCase() }} to {{ policy.To || "departure" }}
                                {{ policy.Unit?.toLowerCase() }}</td>
                              <td><strong>ADULT:</strong> {{ policy.Details }}</td>
                            </tr>
                          </tbody>
                        </table>
                        <div class="disclaimer-note">*From the Time of Departure</div>
                      </div>

                      <!-- Date Change -->
                      <div class="flight-tab-content" *ngIf="footerTabBothwayOutbound === 'dateChange'">
                        <div class="tab-heading">Date Change Policy</div>
                        <table class="change-policy-table">
                          <thead>
                            <tr>
                              <th>Route</th>
                              <th>Time Frame</th>
                              <th>Fee + Fare Difference</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let change of selectedOutbound.FareOptions[0]?.dateChangePolicy">
                              <td>{{ selectedOutbound.Origin.Airport.CityName }} - {{
                                selectedOutbound.Destination.Airport.CityName }}</td>
                              <td>{{ change.From }} {{ change.Unit?.toLowerCase() }} to {{ change.To || "departure" }}
                                {{ change.Unit?.toLowerCase() }}</td>
                              <td><strong>ADULT:</strong> {{ change.Details }}</td>
                            </tr>
                          </tbody>
                        </table>
                        <div class="disclaimer-note">
                          *From the Time of Departure<br /><br />
                          <strong>Important:</strong> The airline fee is indicative. Wizzride does not guarantee
                          accuracy.
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- RETURN DETAILS TAB SECTION -->
                  <div class="footer-tab-content" *ngIf="expandedTypeBothway === 'return'">
                    <div class="flight-list-extention-div1">
                      <div class="flight-tabs">
                        <div class="tab" *ngFor="let tab of tabsBoth" [class.active]="footerTabBothwayReturn === tab.id"
                          (click)="setFooterTabBothwayReturn(tab.id)">
                          {{ tab.label }}
                        </div>
                      </div>

                      <!-- Flight Tab -->
                      <div class="flight-tab-content" *ngIf="footerTabBothwayReturn === 'flight'">
                        <div class="tab-heading">
                          {{ selectedReturn.Origin.Airport.CityName }} to {{ selectedReturn.Destination.Airport.CityName
                          }},
                          {{ selectedReturn.Origin.DepTime | date : "mediumDate" }}
                        </div>
                        <ng-container *ngFor="let segment of selectedReturn.Segments[0]; let i = index">
                          <div class="tab-content-section">
                            <div class="flight-info">
                              <img [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                width="40" height="40" />
                              <strong>{{ segment.Airline.AirlineName }}</strong> {{ segment.Airline.FlightNumber }}
                              <div class="tag">{{ segment.Craft }}</div>
                            </div>
                            <div class="timing-row">
                              <div class="time-block">
                                <div class="time">{{ segment.Origin.DepTime | date : "shortTime" }}</div>
                                <div class="date">{{ segment.Origin.DepTime | date : "mediumDate" }}</div>
                                <div class="terminal">
                                  Terminal - {{ segment.Origin.Airport.Terminal || "-" }}<br />
                                  {{ segment.Origin.Airport.CityName }}
                                </div>
                              </div>
                              <div class="duration">{{ segment.Duration / 60 | number : "1.0-0" }}h {{ segment.Duration
                                % 60 }}m</div>
                              <div class="time-block">
                                <div class="time">{{ segment.Destination.ArrTime | date : "shortTime" }}</div>
                                <div class="date">{{ segment.Destination.ArrTime | date : "mediumDate" }}</div>
                                <div class="terminal">
                                  Terminal - {{ segment.Destination.Airport.Terminal || "-" }}<br />
                                  {{ segment.Destination.Airport.CityName }}
                                </div>
                              </div>
                            </div>
                            <div class="baggage-info">
                              <div><strong>BAGGAGE:</strong> ADULT</div>
                              <div><strong>CHECK IN : </strong>{{ segment.Baggage || "N/A" }}</div>
                              <div><strong>CABIN : </strong>{{ segment.CabinBaggage || "N/A" }}</div>
                            </div>
                          </div>
                          <div *ngIf="i < selectedReturn.Segments[0].length - 1" class="layover-banner">
                            <div class="layover-label">Change of planes</div>
                            <div class="layover-text">
                              <strong>{{ getLayoverFormattedDuration(selectedReturn.Segments[0][i],
                                selectedReturn.Segments[0][i + 1]) }}</strong>
                              Layover in {{ segment.Destination.Airport.CityName }}
                            </div>
                          </div>
                        </ng-container>
                      </div>

                      <!-- Fare Summary -->
                      <div class="flight-tab-content" *ngIf="footerTabBothwayReturn === 'fare'">
                        <div class="tab-heading">Fare Summary</div>
                        <table class="fare-summary-table">
                          <tr>
                            <th>Total</th>
                            <td><strong>â‚¹ {{ (selectedReturn.FareOptions[0]?.Fare?.BaseFare +
                                selectedReturn.FareOptions[0]?.Fare?.Tax) | number : "1.0-0" }}</strong></td>
                          </tr>
                          <tr>
                            <th>Base Fare</th>
                            <td>â‚¹ {{ selectedReturn.FareOptions[0]?.Fare?.BaseFare | number : "1.0-0" }}</td>
                          </tr>
                          <tr>
                            <th>Surcharges</th>
                            <td>â‚¹ {{ selectedReturn.FareOptions[0]?.Fare?.Tax | number : "1.0-0" }}</td>
                          </tr>
                        </table>
                      </div>

                      <!-- Cancellation -->
                      <div class="flight-tab-content"
                        *ngIf="footerTabBothwayReturn === 'cancellation' && selectedReturn.isRefundable">
                        <div class="tab-heading">Cancellation Policy</div>
                        <table class="cancellation-policy-table">
                          <thead>
                            <tr>
                              <th>Route</th>
                              <th>Time Frame</th>
                              <th>Airline + Wizzride Fee</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let policy of selectedReturn.FareOptions[0]?.cancellationPolicy">
                              <td>{{ selectedReturn.Origin.Airport.CityName }} - {{
                                selectedReturn.Destination.Airport.CityName }}</td>
                              <td>{{ policy.From }} {{ policy.Unit?.toLowerCase() }} to {{ policy.To || "departure" }}
                                {{ policy.Unit?.toLowerCase() }}</td>
                              <td><strong>ADULT:</strong> {{ policy.Details }}</td>
                            </tr>
                          </tbody>
                        </table>
                        <div class="disclaimer-note">*From the Time of Departure</div>
                      </div>

                      <!-- Date Change -->
                      <div class="flight-tab-content" *ngIf="footerTabBothwayReturn === 'dateChange'">
                        <div class="tab-heading">Date Change Policy</div>
                        <table class="change-policy-table">
                          <thead>
                            <tr>
                              <th>Route</th>
                              <th>Time Frame</th>
                              <th>Fee + Fare Difference</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let change of selectedReturn.FareOptions[0]?.dateChangePolicy">
                              <td>{{ selectedReturn.Origin.Airport.CityName }} - {{
                                selectedReturn.Destination.Airport.CityName }}</td>
                              <td>{{ change.From }} {{ change.Unit?.toLowerCase() }} to {{ change.To || "departure" }}
                                {{ change.Unit?.toLowerCase() }}</td>
                              <td><strong>ADULT:</strong> {{ change.Details }}</td>
                            </tr>
                          </tbody>
                        </table>
                        <div class="disclaimer-note">
                          *From the Time of Departure<br /><br />
                          <strong>Important:</strong> The airline fee is indicative. Wizzride does not guarantee
                          accuracy.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Multi-City Flights -->
        <div *ngIf="flightType === 'multi'">
          <div class="results-layout" *ngIf="multicityTabData && multicityTabData.length > 0">
            <!-- Filter Sidebar for Multi-City (Desktop) -->
            <div class="filter-sidebar-column" *ngIf="flightType === 'multi'">
              <div class="filter-card">
                <h2 class="filter-heading">Filter Flights</h2>

                <!-- Airlines Filter -->
                <div class="filter-section">
                  <h3 class="filter-subheading">Airlines</h3>
                  <label class="filter-option" *ngFor="let airline of dynamicFilters.airlines">
                    <input type="checkbox" [value]="airline" (change)="onAirlineFilterChange($event)" />
                    {{ airline }}
                  </label>
                </div>

                <!-- Price Range Filter -->
                <div class="filter-section">
                  <h3 class="filter-subheading">Price Range</h3>
                  <input type="range" [min]="dynamicFilters.min_price" [max]="dynamicFilters.max_price"
                    [(ngModel)]="priceRange" class="price-range" (input)="onPriceChange()" />
                  <div class="price-range-label">
                    â‚¹{{ dynamicFilters.min_price | number : "1.0-0" }} - â‚¹{{ priceRange | number : "1.0-0" }}
                  </div>
                </div>

                <!-- Number of Stops Filter -->
                <div class="filter-section">
                  <h3 class="filter-subheading">Number of Stops</h3>
                  <label class="filter-option" *ngFor="let stop of dynamicFilters.stops">
                    <input type="checkbox" [value]="stop" (change)="onStopFilterChange($event)" />
                    {{ stop === 0 ? "Non-stop" : stop + " Stop" + (stop > 1 ? "s" : "") }}
                  </label>
                </div>

                <!-- Departure Time Filter -->
                <div class="filter-section">
                  <h3 class="filter-subheading">Departure From {{ getMultiCityRouteOrigin(selectedMulticityTab) }}</h3>
                  <div class="departure-time-filter">
                    <div class="time-slot" *ngFor="let slot of departureTimeSlots"
                      (click)="toggleDepartureSlot(slot.label)"
                      [class.selected]="selectedDepartureSlots.has(slot.label)">
                      <i [class]="slot.iconClass"></i>
                      <div class="label">{{ slot.label }}</div>
                    </div>
                  </div>
                </div>

                <!-- Refundability Filter -->
                <div class="filter-section">
                  <h3 class="filter-subheading">Refundability</h3>
                  <label class="filter-option">
                    <input type="checkbox" value="refundable" (change)="onRefundabilityChange($event)" />
                    Partially Refundable
                  </label>
                  <label class="filter-option">
                    <input type="checkbox" value="non-refundable" (change)="onRefundabilityChange($event)" />
                    Non-refundable
                  </label>
                </div>
              </div>
            </div>

            <!-- Results Column for Multi-City -->
            <div class="results-column">
              <div class="flight-list-container" *ngIf="multicityTabData && multicityTabData.length > 0">
                <!-- Flight Cards - Show all segments in one card (like mobile but desktop design) -->
                <!-- Flight Count Header -->
                <div class="flight-count-header"
                  *ngIf="multicityTabData && multicityTabData[0] && multicityTabData[0].groupedFlights && multicityTabData[0].groupedFlights.length > 0">
                  <h2 class="flight-count-text">
                    {{ multicityTabData[0].groupedFlights.length }} {{ multicityTabData[0].groupedFlights.length === 1 ?
                    'Flight Found' : 'Flights Found' }}
                  </h2>
                  <div class="flight-announcement">
                    <div class="announceicobox">

                      <i class="fas fa-bullhorn announcement-icon"></i>
                    </div>
                    <span>Wizzride doesn't charge any convenience fee or service charge.</span>
                  </div>
                  <h2 class="flight-count-text">
                    Cheapest Flights First
                  </h2>
                </div>
                <div class="flight-cards"
                  *ngIf="multicityTabData && multicityTabData[0] && multicityTabData[0].groupedFlights && multicityTabData[0].groupedFlights.length > 0">
                  <div class="card mobile-flight-card-new multicity-combined-card"
                    [class.selected]="multicitySelectedFares[0]?.groupedFlight === flight"
                    *ngFor="let flight of multicityTabData[0].groupedFlights; let i = index">

                    <!-- DESKTOP MULTI-CITY CARD - All Segments in One Card -->
                    <div class="desktop-multicity-card" *ngIf="flight && flight.Segments"
                      (click)="selectMulticityFlight(0, i, flight); $event.stopPropagation()">
                      <!-- Show all segments one below another -->
                      <ng-container *ngFor="let segmentGroup of flight.Segments; let segIndex = index">
                        <div class="desktop-multicity-segment"
                          *ngIf="segmentGroup && segmentGroup[0] && segmentGroup[0].Origin"
                          [class.last-segment]="segIndex === flight.Segments.length - 1">
                          <!-- Desktop Flight Row for this segment -->
                          <div class="desktop-flight-row">
                            <!-- Airline Section -->
                            <div class="desktop-airline-section">
                              <img class="desktop-airline-logo"
                                [src]="'assets/images/flightimages/' + segmentGroup[0].Airline.AirlineCode + '.png'"
                                [alt]="segmentGroup[0].Airline.AirlineName"
                                onerror="this.src='assets/images/default-airline.png'" />
                              <div class="desktop-airline-info">
                                <div class="desktop-airline-name">{{ segmentGroup[0].Airline.AirlineName }}</div>
                                <div class="desktop-flight-number">{{ segmentGroup[0].Airline.AirlineCode }} {{
                                  segmentGroup[0].Airline.FlightNumber }}</div>
                                <div class="desktop-aircraft-type">{{ segmentGroup[0].Craft || 'Aircraft' }}</div>
                              </div>
                            </div>

                            <!-- Departure Section -->
                            <div class="desktop-departure-section">
                              <div class="desktop-time">{{ segmentGroup[0].Origin.DepTime | date : "HH:mm" }}</div>
                              <div class="desktop-date">{{ segmentGroup[0].Origin.DepTime | date : "EEE, dd MMM" }}
                              </div>
                              <div class="desktop-airport">{{ segmentGroup[0].Origin.Airport.CityName }}</div>
                            </div>

                            <!-- Duration & Stops Section -->
                            <div class="desktop-duration-section">
                              <div class="desktop-duration-text">{{ getTotalDuration(segmentGroup) }}</div>
                              <div class="desktop-stops-text" (mouseenter)="hoveredMultiCityIndex = i + '-' + segIndex"
                                (mouseleave)="hoveredMultiCityIndex = ''">
                                {{ (segmentGroup.length - 1) === 0 ? 'Non Stop' :
                                (segmentGroup.length - 1) + ' Stop' + ((segmentGroup.length - 1) > 1 ? 's' : '') }}
                                <ng-container *ngIf="(segmentGroup.length - 1) > 0">
                                  via {{ getProductiveLayoverCity(segmentGroup) }}
                                </ng-container>

                                <div class="layover-tooltip"
                                  *ngIf="hoveredMultiCityIndex === (i + '-' + segIndex) && (segmentGroup.length - 1) > 0">
                                  <div *ngFor="let info of getLayoverInfosForGroup(segmentGroup)" class="layover-item">
                                    <div class="layover-header">Plane change</div>
                                    <div class="layover-details">
                                      {{ info.city }} ({{ info.code }}) | {{ info.duration }} Layover
                                    </div>
                                    <div class="layover-timeline">
                                      <div class="dot"></div>
                                    </div>
                                    <div class="layover-timeline-text">
                                      {{ (segmentGroup.length - 1) === 1 ? '1 stop' : 'Stop' }} via {{ info.city }}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <!-- Arrival Section -->
                            <div class="desktop-arrival-section">
                              <div class="desktop-time">{{ segmentGroup[segmentGroup.length - 1].Destination.ArrTime |
                                date : "HH:mm" }}</div>
                              <div class="desktop-date">{{ segmentGroup[segmentGroup.length - 1].Destination.ArrTime |
                                date : "EEE, dd MMM" }}</div>
                              <div class="desktop-airport">{{ segmentGroup[segmentGroup.length -
                                1].Destination.Airport.CityName }}</div>
                              <div class="desktop-day-diff"
                                *ngIf="getDayDiff(segmentGroup[0].Origin.DepTime, segmentGroup[segmentGroup.length - 1].Destination.ArrTime) > 0">
                                +{{ getDayDiff(segmentGroup[0].Origin.DepTime, segmentGroup[segmentGroup.length -
                                1].Destination.ArrTime) }} day
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>

                      <!-- Price & Button Section (at bottom of card) -->
                      <div class="desktop-price-section multicity-total-price">
                        <div class="desktop-price-amount">â‚¹ {{ flight.price | number : "1.0-0" }}</div>
                        <div class="desktop-price-label">Total per Adult</div>
                        <button class="desktop-view-prices-btn"
                          (click)="openFareOptionsModalMultiCity(0, flight, i); $event.stopPropagation()">
                          View Prices
                        </button>
                      </div>
                    </div>
                    <!-- END DESKTOP MULTI-CITY CARD -->

                    <!-- MOBILE FLIGHT CARD DESIGN (matching reference) - Hidden on Desktop -->
                    <div class="mobile-only">
                      <ng-container *ngIf="flight.Segments.length > 1; else singleSegmentBlockMultiCity">
                        <section
                          class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                          aria-label="Flight Option"
                          (click)="openFareOptionsModalMultiCity(selectedMulticityTab, flight, i); $event.stopPropagation()">
                          <ng-container *ngFor="let group of flight.Segments; let groupIndex = index">
                            <ng-container *ngFor="let segment of normalizeGroupToArray(group); let segIndex = index">
                              <div class="flight-card-component__flight-leg">
                                <div class="flight-card-component__leg-header">
                                  <img class="flight-card-component__airline-logo"
                                    [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                    [alt]="segment.Airline.AirlineName + ' logo'"
                                    onerror="this.src='assets/images/default-airline.png'" />
                                  <div class="flight-card-component__airline-info">
                                    <div class="flight-card-component__airline-name">
                                      {{ segment.Airline.AirlineName }}
                                    </div>
                                    <div class="flight-card-component__flight-code">
                                      {{ segment.Airline.AirlineCode }} {{ segment.Airline.FlightNumber }}
                                    </div>
                                  </div>
                                  <div class="flight-card-component__pill">
                                    {{ segment.Craft || 'Aircraft' }}
                                  </div>
                                </div>

                                <div class="flight-card-component__flight-row">
                                  <div class="flight-card-component__flight-left">
                                    <div class="flight-card-component__time">
                                      {{ segment.Origin.DepTime | date : "HH:mm" }}
                                    </div>
                                    <div class="flight-card-component__date">
                                      {{ segment.Origin.DepTime | date : "EEE, dd MMM" }}
                                    </div>
                                    <div class="flight-card-component__location">
                                      {{ segment.Origin.Airport.CityName }}
                                      <div class="flight-card-component_country-name">
                                        {{ segment.Origin.Airport.CountryName }}
                                      </div>
                                    </div>
                                  </div>

                                  <div class="flight-card-component__flight-icon">
                                    <i class="fas fa-plane-departure"></i>

                                    <div class="flight-card-component__duration">
                                      {{ formatMinutesToHrMin(segment.Duration) }}
                                    </div>
                                  </div>

                                  <div class="flight-card-component__flight-right">
                                    <div class="flight-card-component__day-diff"
                                      *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">
                                      +{{ getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }}
                                      day
                                    </div>
                                    <div class="flight-card-component__time">
                                      {{ segment.Destination.ArrTime | date : "HH:mm" }}
                                    </div>
                                    <div class="flight-card-component__date">
                                      {{ segment.Destination.ArrTime | date : "EEE, dd MMM" }}
                                    </div>
                                    <div class="flight-card-component__location">
                                      {{ segment.Destination.Airport.CityName }}
                                      <div class="flight-card-component_country-name">
                                        {{ segment.Destination.Airport.CountryName }}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <!-- Layover Section -->
                              <div *ngIf="segIndex < normalizeGroupToArray(group).length - 1"
                                class="flight-card-component__layover-row">
                                <div class="flight-card-component__dotted-line"></div>
                                <div class="flight-card-component__layover">
                                  <div class="flight-card-component__layover-day">
                                    {{ getLayoverDayText(normalizeGroupToArray(group)[segIndex],
                                    normalizeGroupToArray(group)[segIndex + 1]) }}
                                  </div>
                                  <div class="flight-card-component__layover-time">
                                    {{ getLayoverDuration(normalizeGroupToArray(group)[segIndex],
                                    normalizeGroupToArray(group)[segIndex + 1]) }}
                                  </div>
                                </div>
                                <div class="flight-card-component__dotted-line"></div>
                              </div>
                            </ng-container>

                            <!-- Badges for each group -->
                            <div class="flight-card-component__badges__intreturn"
                              *ngIf="normalizeGroupToArray(group).length > 0">
                              <span class="flight-card-component__pill">
                                {{ normalizeGroupToArray(group).length - 1 === 0 ? "Non Stop" :
                                normalizeGroupToArray(group).length - 1 + " Stop" }}
                              </span>
                              <span class="flight-card-component__pill">
                                {{ getGroupDuration(normalizeGroupToArray(group)) }}
                              </span>
                            </div>

                            <!-- Separator between segment groups -->
                            <div *ngIf="groupIndex < flight.Segments.length - 1"
                              class="flight-card-component__group-separator">
                              <div class="flight-card-component__dotted-line"></div>
                            </div>
                          </ng-container>

                          <!-- Footer -->
                          <div class="flight-card-component__footer">
                            <div class="flight-card-component__badges">
                            </div>
                            <div class="flight-card-component__price">
                              <div class="flight-card-component__amount">
                                â‚¹ {{ flight.price | number : "1.2-2" }}
                              </div>
                              <div class="flight-card-component__per">per Adult</div>
                            </div>
                            <button class="flight-card-component__view-prices-btn desktop-only"
                              (click)="openFareOptionsModalMultiCity(selectedMulticityTab, flight, i); $event.stopPropagation()">
                              View Prices
                            </button>
                          </div>
                        </section>
                      </ng-container>

                      <!-- Single Segment Block -->
                      <ng-template #singleSegmentBlockMultiCity>
                        <section
                          class="flight-card-component__flight-card mobile-card-clickable mobile-flight-card-clean"
                          aria-label="Flight Option"
                          (click)="openFareOptionsModalMultiCity(selectedMulticityTab, flight, i); $event.stopPropagation()">
                          <ng-container *ngFor="let segment of flight.Segments[0]; let segIndex = index">
                            <div class="flight-card-component__flight-leg">
                              <div class="flight-card-component__leg-header">
                                <img class="flight-card-component__airline-logo"
                                  [src]="'assets/images/flightimages/' + segment.Airline.AirlineCode + '.png'"
                                  [alt]="segment.Airline.AirlineName + ' logo'"
                                  onerror="this.src='assets/images/default-airline.png'" />
                                <div class="flight-card-component__airline-info">
                                  <div class="flight-card-component__airline-name">
                                    {{ segment.Airline.AirlineName }}
                                  </div>
                                  <div class="flight-card-component__flight-code">
                                    {{ segment.Airline.AirlineCode }} {{ segment.Airline.FlightNumber }}
                                  </div>
                                </div>
                                <div class="flight-card-component__pill">
                                  {{ segment.Craft || 'Aircraft' }}
                                </div>
                              </div>

                              <div class="flight-card-component__flight-row">
                                <div class="flight-card-component__flight-left">
                                  <div class="flight-card-component__time">
                                    {{ segment.Origin.DepTime | date : "HH:mm" }}
                                  </div>
                                  <div class="flight-card-component__date">
                                    {{ segment.Origin.DepTime | date : "EEE, dd MMM" }}
                                  </div>
                                  <div class="flight-card-component__location">
                                    {{ segment.Origin.Airport.CityName }}
                                  </div>
                                </div>

                                <div class="flight-card-component__flight-icon">
                                  <i class="fas fa-plane-departure"></i>

                                  <div class="flight-card-component__duration">
                                    {{ formatMinutesToHrMin(segment.Duration) }}
                                  </div>
                                </div>

                                <div class="flight-card-component__flight-right">
                                  <div class="flight-card-component__day-diff"
                                    *ngIf="getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) > 0">
                                    +{{ getDayDiff(segment.Origin.DepTime, segment.Destination.ArrTime) }}
                                    day
                                  </div>
                                  <div class="flight-card-component__time">
                                    {{ segment.Destination.ArrTime | date : "HH:mm" }}
                                  </div>
                                  <div class="flight-card-component__date">
                                    {{ segment.Destination.ArrTime | date : "EEE, dd MMM" }}
                                  </div>
                                  <div class="flight-card-component__location">
                                    {{ segment.Destination.Airport.CityName }}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div *ngIf="segIndex < flight.Segments[0].length - 1"
                              class="flight-card-component__layover-row">
                              <div class="flight-card-component__dotted-line"></div>
                              <div class="flight-card-component__layover">
                                <div class="flight-card-component__layover-day">
                                  {{ getLayoverDayText(flight.Segments[0][segIndex], flight.Segments[0][segIndex + 1])
                                  }}
                                </div>
                                <div class="flight-card-component__layover-time">
                                  {{ getLayoverDuration(flight.Segments[0][segIndex], flight.Segments[0][segIndex + 1])
                                  }}
                                </div>
                              </div>
                              <div class="flight-card-component__dotted-line"></div>
                            </div>
                          </ng-container>

                          <div class="flight-card-component__footer">
                            <div class="flight-card-component__badges">
                              <span class="flight-card-component__pill">
                                {{ flight.Segments[0].length - 1 === 0 ? "Non Stop" : flight.Segments[0].length - 1 + "
                                Stop" }}
                              </span>
                              <span class="flight-card-component__pill">
                                {{ getTotalDuration(flight.Segments[0]) }}
                              </span>
                            </div>
                            <div class="flight-card-component__price">
                              <div class="flight-card-component__amount">
                                â‚¹ {{ flight.price | number : "1.2-2" }}
                              </div>
                              <div class="flight-card-component__per">per Adult</div>
                            </div>
                            <button class="flight-card-component__view-prices-btn desktop-only"
                              (click)="openFareOptionsModalMultiCity(selectedMulticityTab, flight, i); $event.stopPropagation()">
                              View Prices
                            </button>
                          </div>
                        </section>
                      </ng-template>
                    </div>
                  </div>
                </div>

                <!-- No Flights Message -->
                <div class="no-flights"
                  *ngIf="(!multicityTabData || !multicityTabData[0] || !multicityTabData[0].groupedFlights || multicityTabData[0].groupedFlights.length === 0) && !loader">
                  <p>No flights found for your multi-city search. Please try modifying your search.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Multi-City Summary Footer -->
          <div class="multicity-summary-footer" *ngIf="multicityTabData && multicityTabData.length > 0">
            <div class="summary-total">
              <span class="total-label">Total Price:</span>
              <span class="total-amount">â‚¹ {{ multicityTotalFare | number : "1.0-0" }}</span>
            </div>
            <button class="proceed-btn" [class.disabled]="!multicityHasSelectedFares"
              [disabled]="!multicityHasSelectedFares" (click)="proceedWithMultiCityBooking()">
              {{ multicityHasSelectedFares ? 'Proceed to Booking' : 'Select All Segments' }}
            </button>
          </div>
        </div>

      </div>
    </main>

    <!-- Fare Options Modal - One Way -->
    <div class="custom-modal-overlay" *ngIf="showFareModal" (click)="closeFareOptionsModal()">
      <div class="custom-modal makemytrip-style" (click)="$event.stopPropagation()">
        <div class="fare-options-title">Fare Options available for your trip</div>
        <button class="modal-close" (click)="closeFareOptionsModal()">&times;</button>
        <div class="flghtfaredestdet">
          <div class="fare-options-subtitle-line" *ngIf="selectedFlight">
            <span class="fare-trip-details-text">{{ selectedFlight.Origin?.Airport?.CityName }} â†’ {{
              selectedFlight.Destination?.Airport?.CityName }} Â· {{ selectedFlight.Airline?.AirlineName }} Â· {{
              selectedFlight.Origin?.DepTime | date : "EEE, dd MMM y" }} Â· {{ selectedFlight.Origin?.DepTime | date :
              "HH:mm" }} - {{ selectedFlight.Destination?.ArrTime | date : "HH:mm" }}</span>
          </div>
        </div>
        <div class="fare-options-box">
          <div class="fare-options-header">


          </div>
          <div class="fare-scroll-wrapper">
            <button class="scroll-arrow left" (click)="scrollFareCards('left')">â€¹</button>
            <div class="fare-scroll-container" #fareScrollContainer>
              <div class="fare-card makemytrip-fare-card" *ngFor="let fare of selectedFlight?.FareOptions">
                <div class="fare-price-oneway">
                  â‚¹ {{ getAdultFarePerPerson(fare.FareBreakdown) | number : "1.0-0" }} <span class="per-adult">per
                    adult</span>
                </div>
                <div class="fare-type-badge">{{ fare.Segments[0][0].SupplierFareClass }}</div>
                <div class="fare-section">
                  <strong>Baggage</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-check-circle fare-check-icon"></i>
                      <span>Cabin: {{ fare.Segments[0][0].CabinBaggage }}</span>
                    </li>
                    <li>
                      <i class="fas fa-check-circle fare-check-icon"></i>
                      <span>Check-in: {{ fare.Segments[0][0].Baggage }}</span>
                    </li>
                  </ul>
                </div>
                <div class="fare-section">
                  <strong>Flexibility</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-exclamation-triangle fare-warning-icon"></i>
                      <span>Cancel: {{ getCancellationRule(fare) }}</span>
                    </li>
                    <li>
                      <i class="fas fa-exclamation-triangle fare-warning-icon"></i>
                      <span>Change: {{ getDateChangeRule(fare) }}</span>
                    </li>
                  </ul>
                </div>
                <div class="fare-section">
                  <strong>Seats, Meals & More</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-utensils fare-icon"></i>
                      <span>Meals: {{ fare.IsFreeMealAvailable ? "Meal included" : "Meal not included" }}</span>
                    </li>
                    <li>
                      <i class="fas fa-chair fare-icon"></i>
                      <span>Seats: {{ fare.AirlineRemark?.toLowerCase().includes('standard seats are free') ? "Standard
                        seats free" : "Chargeable seats" }}</span>
                    </li>
                    <li class="check-airline">Check with airline</li>
                  </ul>
                </div>
                <button class="book-btn makemytrip-book-btn" (click)="finalizeSelection(fare)">BOOK NOW</button>
              </div>
            </div>
            <button class="scroll-arrow right" (click)="scrollFareCards('right')">â€º</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Fare Options Modal - Round Trip (using same structure as one-way) -->
    <div class="custom-modal-overlay" *ngIf="showFareModal && flightType === 'round'" (click)="closeFareOptionsModal()">
      <div class="custom-modal makemytrip-style" (click)="$event.stopPropagation()">
        <div class="fare-options-title">Fare Options available for your trip</div>
        <button class="modal-close" (click)="closeFareOptionsModal()">&times;</button>
        <div class="flghtfaredestdet">
          <div class="fare-options-subtitle-line" *ngIf="selectedFlight">
            <span class="fare-trip-details-text">
              {{ selectedFlight?.Segments?.[0]?.[0]?.Origin?.Airport?.CityName }} â†’
              {{ selectedFlight?.Segments?.[0]?.[selectedFlight?.Segments?.[0]?.length -
              1]?.Destination?.Airport?.CityName }} Â·
              {{ selectedFlight?.Segments?.[0]?.[0]?.Airline?.AirlineName }} Â·
              {{ selectedFlight?.Segments?.[0]?.[0]?.Origin?.DepTime | date : "EEE, dd MMM y" }} Â·
              {{ selectedFlight?.Segments?.[0]?.[0]?.Origin?.DepTime | date : "HH:mm" }} -
              {{ selectedFlight?.Segments?.[0]?.[selectedFlight?.Segments?.[0]?.length - 1]?.Destination?.ArrTime |
              date : "HH:mm" }}
            </span>
          </div>
        </div>
        <div class="fare-options-box">
          <div class="fare-options-header">


          </div>
          <div class="fare-scroll-wrapper">
            <button class="scroll-arrow left" (click)="scrollFareCards('left')">â€¹</button>
            <div class="fare-scroll-container" #fareScrollContainer>
              <div class="fare-card makemytrip-fare-card" *ngFor="let fare of defaultFares">
                <div class="fare-price-oneway">
                  â‚¹ {{ fare.price | number : "1.0-0" }} <span class="per-adult">per adult</span>
                </div>
                <div class="fare-type-badge">{{ fare.type }}</div>
                <div class="fare-section">
                  <strong>Baggage</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-check-circle fare-check-icon"></i>
                      <span>Cabin: {{ fare.cabin }}</span>
                    </li>
                    <li>
                      <i class="fas fa-check-circle fare-check-icon"></i>
                      <span>Check-in: {{ fare.checkIn }}</span>
                    </li>
                  </ul>
                </div>
                <div class="fare-section">
                  <strong>Flexibility</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-exclamation-triangle fare-warning-icon"></i>
                      <span>Cancel: {{ fare.cancel }}</span>
                    </li>
                    <li>
                      <i class="fas fa-exclamation-triangle fare-warning-icon"></i>
                      <span>Change: {{ fare.dateChange }}</span>
                    </li>
                  </ul>
                </div>
                <div class="fare-section">
                  <strong>Seats, Meals & More</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-utensils fare-icon"></i>
                      <span>Meals: {{ fare.meal === 'Included' ? "Meal included" : "Meal not included" }}</span>
                    </li>
                    <li>
                      <i class="fas fa-chair fare-icon"></i>
                      <span>Seats: {{ fare.seat === 'Free' ? "Standard seats free" : "Chargeable seats" }}</span>
                    </li>
                    <li class="check-airline">Check with airline</li>
                  </ul>
                </div>
                <button class="book-btn makemytrip-book-btn"
                  (click)="finalizeBookingForRoundTrip(selectedFlight, fare)">
                  BOOK NOW
                </button>
              </div>
            </div>
            <button class="scroll-arrow right" (click)="scrollFareCards('right')">â€º</button>
          </div>
        </div>
      </div>
    </div>

    <!-- New Round Trip Modal (MakeMyTrip Style) -->
    <div class="custom-modal-overlay" *ngIf="showFareModalBoth" (click)="closeFareOptionsModalBothWay()">
      <div class="custom-modal makemytrip-style" (click)="$event.stopPropagation()">
        <div class="fare-options-title">Flight Details and Fare Options available for you!</div>

        <button class="modal-close" (click)="closeFareOptionsModalBothWay()">&times;</button>
        <div class="flghtfaredestdet">
          <div class="fare-options-subtitle-line" *ngIf="selectedFlight" style="margin-top: 10px;">
            <span class="fare-trip-details-text">
              {{ selectedFlight?.Segments?.[0]?.[0]?.Origin?.Airport?.CityName }} â†’
              {{ selectedFlight?.Segments?.[0]?.[selectedFlight?.Segments?.[0]?.length -
              1]?.Destination?.Airport?.CityName }} Â·
              {{ selectedFlight?.Segments?.[0]?.[0]?.Airline?.AirlineName }} Â·
              {{ selectedFlight?.Segments?.[0]?.[0]?.Origin?.DepTime | date : "EEE, dd MMM y" }} Â·
              {{ selectedFlight?.Segments?.[0]?.[0]?.Origin?.DepTime | date : "HH:mm" }} -
              {{ selectedFlight?.Segments?.[0]?.[selectedFlight?.Segments?.[0]?.length - 1]?.Destination?.ArrTime |
              date : "HH:mm" }}
            </span>
          </div>
        </div>
        <div class="fare-options-box">
          <div class="fare-options-header">

            <!-- Tabs -->
            <div class="flight-tabs round-trip-tabs" style="margin-top: 15px; border-bottom: 2px solid #e0e0e0;">
              <div class="tab" [class.active]="activeFareTab === 'departure'" (click)="selectFareTab('departure')"
                style="padding: 10px 20px; cursor: pointer; font-weight: 600; color: #777;">
                Depart: {{ selectedOutbound?.Segments?.[0]?.[0]?.Origin?.Airport?.CityName }} - {{
                selectedOutbound?.Segments?.[0]?.[selectedOutbound?.Segments?.[0]?.length -
                1]?.Destination?.Airport?.CityName }}
              </div>
              <div class="tab" [class.active]="activeFareTab === 'return'" (click)="selectFareTab('return')"
                style="padding: 10px 20px; cursor: pointer; font-weight: 600; color: #777;">
                Return: {{ selectedReturn?.Segments?.[0]?.[0]?.Origin?.Airport?.CityName }} - {{
                selectedReturn?.Segments?.[0]?.[selectedReturn?.Segments?.[0]?.length -
                1]?.Destination?.Airport?.CityName }}
              </div>
            </div>


          </div>

          <div class="fare-scroll-wrapper">
            <button class="scroll-arrow left" (click)="scrollFareCards('left')">â€¹</button>
            <div class="fare-scroll-container" #fareScrollContainer>
              <div class="fare-card makemytrip-fare-card" *ngFor="let fare of defaultFares; let i = index">
                <div class="fare-price-oneway">
                  â‚¹ {{ fare.price | number : "1.0-0" }} <span class="per-adult">per adult</span>
                </div>
                <div class="fare-type-badge">{{ fare.type }}</div>

                <div class="fare-section">
                  <strong>Baggage</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-check-circle fare-check-icon"></i>
                      <span>Cabin: {{ fare.cabin }}</span>
                    </li>
                    <li>
                      <i class="fas fa-check-circle fare-check-icon"></i>
                      <span>Check-in: {{ fare.checkIn }}</span>
                    </li>
                  </ul>
                </div>

                <div class="fare-section">
                  <strong>Flexibility</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-exclamation-triangle fare-warning-icon"></i>
                      <span>Cancel: {{ fare.cancel }}</span>
                    </li>
                    <li>
                      <i class="fas fa-exclamation-triangle fare-warning-icon"></i>
                      <span>Change: {{ fare.dateChange }}</span>
                    </li>
                  </ul>
                </div>

                <div class="fare-section">
                  <strong>Seats, Meals & More</strong>
                  <ul class="fare-list">
                    <li>
                      <i class="fas fa-utensils fare-icon"></i>
                      <span>Meals: {{ fare.meal === 'Included' ? "Meal included" : "Meal not included" }}</span>
                    </li>
                    <li>
                      <i class="fas fa-chair fare-icon"></i>
                      <span>Seats: {{ fare.seat === 'Free' ? "Standard seats free" : "Chargeable seats" }}</span>
                    </li>
                    <li class="check-airline">Check with airline</li>
                  </ul>
                </div>

                <button class="book-btn makemytrip-book-btn" (click)="selectFare(activeFareTab, i)"
                  [disabled]="isSelectedFare(activeFareTab, i)" [class.selected-btn]="isSelectedFare(activeFareTab, i)"
                  style="cursor: pointer;">
                  {{ isSelectedFare(activeFareTab, i) ? "SELECTED" : "SELECT" }}
                </button>
              </div>
            </div>
            <button class="scroll-arrow right" (click)="scrollFareCards('right')">â€º</button>
          </div>

          <div class="fare-modal-footer" style="justify-content: flex-end; gap: 20px;">
            <div class="fare-total-block" style="text-align: right;">
              <span style="font-size: 1.5rem; font-weight: 800; color: #000;">
                â‚¹ {{ (
                (selectedOutbound?.selectedFareOption ?
                getAdultFarePerPerson(selectedOutbound.selectedFareOption.FareBreakdown) : (selectedOutbound?.price ||
                0)) +
                (selectedReturn?.selectedFareOption ?
                getAdultFarePerPerson(selectedReturn.selectedFareOption.FareBreakdown) : (selectedReturn?.price || 0))
                ) | number : "1.0-0" }}
              </span>

              <span style="font-size: 0.8rem; color: #666; font-weight: 600;">ROUNDTRIP FOR 1 ADULT</span>
            </div>
            <div class="fare-action-buttons">
              <button class="continue-book-btn" [disabled]="!hasFareSelected('departure') || !hasFareSelected('return')"
                (click)="onFareContinueOrBook()"
                style="background-color: #0091ff; color: white; border-radius: 25px; font-weight: 700; padding: 10px 30px; border: none; font-size: 1rem;"
                [style.opacity]="(!hasFareSelected('departure') || !hasFareSelected('return')) ? '0.5' : '1'">
                CONTINUE
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Fare Options Modal - Multi-City (Desktop) -->
    <div class="custom-modal-overlay desktop-only" *ngIf="showFareModalMultiCity"
      (click)="closeFareOptionsModalMultiCity()">
      <div class="custom-modal" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeFareOptionsModalMultiCity()">Ã—</button>
        <div class="flghtfaredestdet">
          <div class="fare-options-subtitle-line" *ngIf="selectedMultiCityFlight">
            <span class="fare-trip-details-text">{{ selectedMultiCityFlight.Origin.Airport.CityName }} â†’ {{
              selectedMultiCityFlight.Destination.Airport.CityName }} Â· {{ selectedMultiCityFlight.airline }} Â· {{
              selectedMultiCityFlight.Origin.DepTime | date : "EEE, dd MMM y" }} Â· {{
              selectedMultiCityFlight.Origin.DepTime | date : "HH:mm" }} - {{
              selectedMultiCityFlight.Destination.ArrTime | date : "HH:mm" }}</span>
          </div>
        </div>
        <div class="fare-options-box">
          <div class="fare-options-header">

          </div>
          <!-- Scrollable Fare Options -->
          <div class="fare-scroll-wrapper">
            <button class="scroll-arrow left" (click)="scrollFareCards('left')">â€¹</button>
            <div class="fare-scroll-container" #fareScrollContainer>
              <div class="fare-card" *ngFor="let fare of selectedMultiCityFlight?.FareOptions; let i = index">
                <div class="fare-price-oneway">
                  â‚¹ {{ getAdultFarePerPerson(fare.FareBreakdown) | number : "1.0-0" }}
                  <span class="per-adult">per adult</span>
                </div>
                <div class="fare-type">{{ fare.Segments[0][0].SupplierFareClass }}</div>
                <div class="fare-section">
                  <strong>Baggage</strong>
                  <ul>
                    <li>âœ… Cabin: {{ fare.Segments[0][0].CabinBaggage }}</li>
                    <li>âœ… Check-in: {{ fare.Segments[0][0].Baggage }}</li>
                  </ul>
                </div>
                <div class="fare-section">
                  <strong>Flexibility</strong>
                  <ul>
                    <li>âš ï¸ Cancel: {{ getCancellationRule(fare) }}</li>
                    <li>âš ï¸ Change: {{ getDateChangeRule(fare) }}</li>
                  </ul>
                </div>
                <div class="fare-section">
                  <strong>Seats, Meals & More</strong>
                  <ul>
                    <li>ðŸ½ï¸ Meals: {{ fare.IsFreeMealAvailable ? "Free meal available" : "Meal not included" }}</li>
                    <li>ðŸ’º Seats: {{ fare.AirlineRemark?.toLowerCase().includes('standard seats are free') ? "Standard
                      seats free" : "Chargeable seats" }}</li>
                    <li>{{ fare.FareRules[0]?.Details || "Check with airline" }}</li>
                  </ul>
                </div>
                <button class="book-btn"
                  (click)="finalizeMultiCityBooking(selectedMultiCityFlight, fare); $event.stopPropagation()">
                  BOOK
                </button>
              </div>
            </div>
            <button class="scroll-arrow right" (click)="scrollFareCards('right')">â€º</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Fare Options Modal - Multi-City (Mobile - Bottom Sliding) -->
    <div class="fare-popup-overlay-mobile" *ngIf="showFareModalMultiCity" (click)="closeFareOptionsModalMultiCity()">
    </div>
    <div class="fare-popup animated" *ngIf="showFareModalMultiCity && selectedMultiCityFlight"
      (click)="$event.stopPropagation()">
      <div class="fare-header">
        <span>Select Package</span>
        <button (click)="closeFareOptionsModalMultiCity()">Ã—</button>
      </div>
      <div class="fare-body">
        <div class="fare-card" *ngFor="let fare of selectedMultiCityFlight?.FareOptions; let i = index">
          <div class="fare-top">
            <div>
              <div class="fare-title">{{ fare.Segments[0][0].SupplierFareClass }}</div>
              <div class="fare-sub">Fare Offered By Airline</div>
            </div>
            <div class="fare-price">
              â‚¹ {{ getAdultFarePerPerson(fare.FareBreakdown) | number : "1.0-0" }}
              <div class="per">per Adult</div>
            </div>
          </div>
          <div class="fare-detail">
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-suitcase"></i> Cabin Bag
              </div>
              <div class="fare-right">{{ fare.Segments[0][0].CabinBaggage }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-suitcase-rolling"></i> Check-in Bag
              </div>
              <div class="fare-right">{{ fare.Segments[0][0].Baggage }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-times-circle"></i> Cancellation
              </div>
              <div class="fare-right">{{ getCancellationRule(fare) }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-exchange-alt"></i> Date Change
              </div>
              <div class="fare-right">{{ getDateChangeRule(fare) }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-chair"></i> Seat Selection
              </div>
              <div class="fare-right">{{ fare.AirlineRemark?.toLowerCase().includes('standard seats are free') ? "Free"
                : "Chargeable" }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-utensils"></i> Meal
              </div>
              <div class="fare-right">{{ fare.IsFreeMealAvailable ? "Included" : "Chargeable" }}</div>
            </div>
          </div>
          <button class="book-btn" (click)="finalizeMultiCityBooking(selectedMultiCityFlight, fare)">
            BOOK
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Fare Popup (Mobile Only) -->
    <div class="fare-popup-overlay-mobile" *ngIf="showMobileFarePopup" (click)="closeMobileFarePopup()"></div>
    <div class="fare-popup animated" *ngIf="showMobileFarePopup && selectedFlightForMobile"
      (click)="$event.stopPropagation()">
      <div class="fare-header">
        <span>Select Package</span>
        <button (click)="closeMobileFarePopup()">Ã—</button>
      </div>
      <div class="fare-body">
        <div class="fare-card" *ngFor="let fare of defaultFaresForMobile">
          <div class="fare-top">
            <div>
              <div class="fare-title">{{ fare.type }}</div>
              <div class="fare-sub">Fare Offered By Airline</div>
            </div>
            <div class="fare-price">
              â‚¹ {{ fare.price | number : "1.2-2" }}
              <div class="per">per Adult</div>
            </div>
          </div>
          <div class="fare-detail">
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-suitcase"></i> Cabin Bag
              </div>
              <div class="fare-right">{{ fare.cabin }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-suitcase-rolling"></i> Check-in Bag
              </div>
              <div class="fare-right">{{ fare.checkIn }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-times-circle"></i> Cancellation
              </div>
              <div class="fare-right">{{ fare.cancel }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-exchange-alt"></i> Date Change
              </div>
              <div class="fare-right">{{ fare.dateChange }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-chair"></i> Seat Selection
              </div>
              <div class="fare-right">{{ fare.seat }}</div>
            </div>
            <div class="fare-row">
              <div class="fare-left">
                <i class="fas fa-utensils"></i> Meal
              </div>
              <div class="fare-right">{{ fare.meal }}</div>
            </div>
          </div>
          <button class="book-btn" (click)="finalizeBookingMobile(selectedFlightForMobile, fare)">
            BOOK
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Round Trip Flight Details Slider Popup -->
  <!-- <div class="flight-details-popup-overlay" *ngIf="showFlightDetailsPopup" (click)="closeFlightDetailsPopup()"></div>-->

</div>