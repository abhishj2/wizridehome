<!-- Compact Search Summary -->
<div class="search-summary" [class.sticky]="isHeaderSticky" *ngIf="searchParams">
  <div class="container">
  <div class="summary-content">
   
    <div class="summary-info">
      <div class="route-summary">
        <div class="route-locations">
          <div class="location-group">
            <span class="from">{{ searchParams.from }}</span>
            <span class="location-detail" *ngIf="searchParams.pickupLocation">{{ searchParams.pickupLocation }}</span>
          </div>
          <i class="fas fa-arrow-right"></i>
          <div class="location-group">
            <span class="to">{{ searchParams.to }}</span>
            <span class="location-detail" *ngIf="searchParams.dropLocation">{{ searchParams.dropLocation }}</span>
          </div>
        </div>
        <div class="journey-details">
          <span class="date">{{ formatDate(searchParams.date) }}</span>
          <span class="pickup-time" *ngIf="searchParams?.type === 'reserved' && searchParams?.pickupTime">{{ formatPickupTime(searchParams.pickupTime!) }}</span>
          <span class="passengers">{{ searchParams.passengers }} seats</span>
        </div>
      </div>
    </div>
    <div class="summary-actions">
      <button class="modify-btn" (click)="modifySearch()">Modify</button>
      <button class="request-btn" (click)="requestCarAddition()" *ngIf="searchParams?.type === 'shared'">Request for Addition</button>
      <!-- <button class="modify-btn" (click)="viewAllCarAdditionRequests()" *ngIf="searchParams?.type === 'shared'" style="background: #6c757d;">View Requests</button> -->
    </div>
  </div>
  <div class="container">
    
  </div>
  </div>
</div>

<!-- Main Content -->
<main class="results-main">
  <div class="container">
    <div class="results-layout">

      <!-- Left Column - Vehicle Results -->
      <div class="results-column">
        <!-- <div class="results-header-section">
          <h2 class="results-title">
            {{ searchParams?.type === 'shared' ? 'Shared Cab' : 'Reserved Cab' }} Options
          </h2>
          <p class="results-subtitle">
            {{ vehicleOptions.length }} vehicles available for your journey
          </p>
        </div> -->

        <!-- Loading State -->
        <div class="loading-state" *ngIf="isLoading">
          <div class="loading-spinner"></div>
          <p>Finding the best options for you...</p>
        </div>

        <!-- Vehicle Cards -->
        <div class="vehicle-cards" *ngIf="!isLoading">
          <div class="card" *ngFor="let vehicle of vehicleOptions">

            <!-- Date Hanger -->
            <div class="date-hanger">
              <div class="date-content">
                <span class="date-text">{{ formatDate(searchParams?.date || '') }}</span>
              </div>
            </div>

            <!-- Route -->
            <div class="route">
              <div class="vehicle">
                <img [src]="vehicle.image" [alt]="vehicle.name">
                <div class="vehicle-info">
                  <h3>{{ vehicle.name }}</h3>
                </div>
              </div>

              <div class="route-column">
                <div class="route-code">{{ vehicle.route.from.code }}</div>
                <div class="location">{{ vehicle.route.from.name }}
                  <div class="sub-location" *ngIf="vehicle.pickupLocation">({{ vehicle.pickupLocation }})</div>
                </div>
              </div>

              <div class="route-visualization">
                <div class="route-line">
                  <div class="route-node start-node"></div>
                  <div class="route-car">
                    <img src="../../assets/images/bgremovecar.png" alt="Car">
                  </div>
                  <div class="route-node end-node"></div>
                </div>
                <div class="route-details">
                  <div class="time">{{ searchParams && searchParams.type === 'reserved' && searchParams.pickupTime ? formatPickupTime(searchParams.pickupTime) : vehicle.departureTime }}</div>
                  <div class="duration">{{ vehicle.duration }}</div>
                </div>
              </div>

              <div class="route-column">
                <div class="route-code">{{ vehicle.route.to.code }}</div>
                <div class="location">{{ vehicle.route.to.name }}
                  <div class="sub-location" *ngIf="vehicle.dropLocation">({{ vehicle.dropLocation }})</div>
                </div>
              </div>

              <div class="price-info">

                <div class="price">₹{{ vehicle.price.toFixed(0) }}</div>
                <div style="margin-top: 18px;">
                  <p>{{ vehicle.seatsLeft }} Seat Left</p>
                </div>
              </div>
            </div>

            <!-- Details -->
            <!-- <div class="details">
      <div class="duration">{{ formatDate(searchParams?.date || '') }}</div>
    </div> -->

            <!-- Options -->
            <div class="options">
              <!-- Column 1: AC/Amenities -->
              <div class="option-item">
                <div class="default-amenities">
                  <div class="amenity-item">
                    <i class="fas fa-snowflake"></i>
                    <span>AC</span>
                  </div>
                </div>
                <div class="hover-dropdowns">
                  <div class="dropdown">
                    <i class="fas fa-list-alt"></i>
                    <span>Amenities</span>
                    <div class="dropdown-content">
                      {{ vehicle.amenities.join(', ') }}.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Column 2: Luggage/Instructions -->
              <div class="option-item">
                <div class="default-amenities">
                  <div class="amenity-item">
                    <i class="fas fa-suitcase"></i>
                    <span>Luggage</span>
                  </div>
                </div>
                <div class="hover-dropdowns">
                  <div class="dropdown">
                    <i class="fas fa-info-circle"></i>
                    <span>Instructions</span>
                    <div class="dropdown-content">
                      Arrive 15 minutes before departure. Bring a valid ID. Follow crew instructions.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Column 3: Refreshment/Cancellation Policy -->
              <div class="option-item">
                <div class="default-amenities">
                  <div class="amenity-item">
                    <i class="fas fa-coffee"></i>
                    <span>Refreshment</span>
                  </div>
                </div>
                <div class="hover-dropdowns">
                  <div class="dropdown">
                    <i class="fas fa-ban"></i>
                    <span>Cancellation Policy</span>
                    <div class="dropdown-content">
                      Cancel 24 hours prior for a full refund. 50% refund within 12 hours.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Column 4: Select Seat Button for Shared / Book Cab Button for Reserved -->
              <div class="select-btn-card">
                <button class="btn" (click)="selectSeat(vehicle)" *ngIf="searchParams?.type === 'shared'">Select Seat</button>
                <button class="btn" (click)="bookCab(vehicle)" *ngIf="searchParams?.type === 'reserved'">Book Cab</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Promotional Ads -->
      <div class="sidebar-column">
        <div class="promotional-ads">

          <!-- Japan Trip Ad -->
          <div class="ad-card japan-ad">
            <div class="ad-image">
              <img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=300&h=200&fit=crop"
                alt="Japan Trip">
            </div>
            <div class="ad-content">
              <h3 class="ad-title">Japan Trip</h3>
              <p class="ad-description">
                8 Days Trip in September. Come with Us on a Trip of a Lifetime. Check more details.
              </p>
            </div>
          </div>

          <!-- Kazakhstan Ad -->
          <div class="ad-card kazakhstan-ad">
            <div class="ad-image">
              <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=300&h=200&fit=crop"
                alt="Kazakhstan">
            </div>
            <div class="ad-content">
              <h3 class="ad-title">Kazakhstan</h3>
              <p class="ad-description">
                Explore the beautiful landscapes of Kazakhstan. 10 Days Adventure Package.
              </p>
            </div>
          </div>

          <!-- Europe Tour Ad -->
          <div class="ad-card europe-ad">
            <div class="ad-image">
              <img src="https://images.unsplash.com/photo-1467269204594-9661b134dd2b?w=300&h=200&fit=crop"
                alt="Europe Tour">
            </div>
            <div class="ad-content">
              <h3 class="ad-title">Europe Tour</h3>
              <p class="ad-description">
                Discover the charm of Europe. 15 Days Multi-Country Tour Package.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Car Addition Request Modal -->
<div class="car-addition-modal-overlay" *ngIf="showCarAdditionModal" (click)="closeCarAdditionModal()">
  <div class="car-addition-modal" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title">
        <h2>Request Car Addition</h2>
        <p>We will try our best to add a car.</p>
      </div>
      <button class="modal-close-btn" (click)="closeCarAdditionModal()">×</button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content">
      <form class="car-addition-form" (ngSubmit)="submitCarAdditionRequest()" #carAdditionForm="ngForm">
        <!-- Full Name Field -->
        <div class="form-field">
          <label class="field-label">Full Name :</label>
          <input 
            type="text" 
            class="field-input" 
            placeholder="Enter your Full Name."
            [(ngModel)]="carAdditionFormData.fullName"
            name="fullName"
            required
            #fullNameInput="ngModel">
        </div>

        <!-- Contact Number Field -->
        <div class="form-field">
          <label class="field-label">Contact No :</label>
          <input 
            type="tel" 
            class="field-input" 
            placeholder="Enter your Contact Number."
            [(ngModel)]="carAdditionFormData.contactNo"
            name="contactNo"
            required
            #contactNoInput="ngModel">
        </div>

        <!-- Email ID Field -->
        <div class="form-field">
          <label class="field-label">Email ID :</label>
          <input 
            type="email" 
            class="field-input" 
            placeholder="Enter your Email ID."
            [(ngModel)]="carAdditionFormData.emailId"
            name="emailId"
            required
            #emailIdInput="ngModel">
        </div>

        <!-- Preferred Time Field -->
        <div class="form-field">
          <label class="field-label">Preferred Time :</label>
          <div class="time-input-wrapper" (click)="openTimePicker()">
            <input 
              type="text" 
              class="field-input time-display-input" 
              [value]="formatTimeDisplay(carAdditionFormData.preferredTime)"
              placeholder="Select Preferred Time"
              readonly
              name="preferredTime"
              required>
            <i class="fas fa-clock time-icon"></i>
          </div>
          <input type="hidden" [(ngModel)]="carAdditionFormData.preferredTime" name="preferredTimeHidden" required>
        </div>

        <!-- Submit Button -->
        <div class="form-submit">
          <button type="submit" class="submit-btn" [disabled]="!carAdditionForm.valid">
            Send Timing Request
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Seat Selection Popup -->
<div class="seat-popup-overlay" *ngIf="showSeatPopup" (click)="closeSeatPopup()">
  <div class="seat-popup" (click)="$event.stopPropagation()">
    <!-- Popup Header -->
    <div class="popup-header">
      <div class="popup-title">
        <h2>Select Your Seat</h2>
        <p>All seats are front-facing</p>
      </div>
      <button class="close-btn" (click)="closeSeatPopup()">×</button>
    </div>

    <!-- Popup Content -->
    <div class="popup-content">
      <!-- Two Column Layout -->
      <div class="modal-layout">
        <!-- Left Column: Car Layout -->
        <div class="car-layout-column">
          <div class="car-container">
            <!-- Car Image -->
            <img src="../../assets/images/carmodule/car2.png" alt="Car" class="car-image">

            <!-- Unified Seat Layout Container -->
            <div class="unified-seat-grid">
              <!-- Front Row: Driver + Passenger -->
              <div class="seat-row front-row">
                <div class="seat passenger-seat" [class.booked]="seat.status === 'booked'"
                  [class.selected]="seat.status === 'selected'" (click)="selectSeatFromPopup(seat)"
                  *ngFor="let seat of frontSeats; let i = index">
                  <img src="../../assets/images/carmodule/seat.png" alt="Seat">
                  <span class="seat-number">{{ seat.number }}</span>
                  <span class="seat-price">₹{{ seat.price }}</span>
                </div>
                <div class="seat driver-seat">
                  <img src="../../assets/images/carmodule/driver.png" alt="Driver">
                  <!-- <span class="seat-number">Driver</span> -->
                </div>
              </div>

              <!-- Middle Row -->
              <div class="seat-row middle-row">
                <div class="seat passenger-seat" [class.booked]="seat.status === 'booked'"
                  [class.selected]="seat.status === 'selected'" (click)="selectSeatFromPopup(seat)"
                  *ngFor="let seat of middleSeats; let i = index">
                  <img src="../../assets/images/carmodule/seat.png" alt="Seat">
                  <span class="seat-number">{{ seat.number }}</span>
                  <span class="seat-price">₹{{ seat.price }}</span>
                </div>
              </div>

              <!-- Back Row -->
              <div class="seat-row back-row">
                <div class="seat passenger-seat" [class.booked]="seat.status === 'booked'"
                  [class.selected]="seat.status === 'selected'" (click)="selectSeatFromPopup(seat)"
                  *ngFor="let seat of backSeats; let i = index">
                  <img src="../../assets/images/carmodule/seat.png" alt="Seat">
                  <span class="seat-number">{{ seat.number }}</span>
                  <span class="seat-price">₹{{ seat.price }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: Legend -->
        <div class="legend-column">
          <div class="seat-legend">
            <div class="legend-item">
              <img src="../../assets/images/carmodule/seat.png" alt="Available">
              <span>Available Seat</span>
            </div>
            <div class="legend-item">
              <img src="../../assets/images/carmodule/seat.png" alt="Selected" class="selected">
              <span>Selected Seat</span>
            </div>
            <div class="legend-item">
              <img src="../../assets/images/carmodule/driver.png" alt="Driver">
              <span>Driver's Seat</span>
            </div>
            <div class="legend-item">
              <img src="../../assets/images/carmodule/seat.png" alt="Booked" class="booked">
              <span>Booked Seat</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Popup Footer -->
    <div class="popup-footer">
      <button class="proceed-btn" (click)="proceedToBooking()" [disabled]="selectedSeats.length === 0">
        Proceed ({{ selectedSeats.length }} seat{{ selectedSeats.length !== 1 ? 's' : '' }} selected)
      </button>
    </div>
  </div>
</div>

<!-- Time Picker Modal -->
<div class="time-picker-overlay" [class.active]="timePickerVisible" (click)="closeTimePicker()">
  <div class="time-picker-modal" (click)="$event.stopPropagation()">
    <div class="time-picker-header">
      <h3>Select Preferred Time</h3>
      <button class="close-btn" (click)="closeTimePicker()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="time-picker-content">
      <div class="time-columns">
        <!-- Hours Column -->
        <div class="time-column">
          <div class="column-header">Hrs</div>
          <div class="time-scroll-container">
            <div class="time-options" #hoursContainer>
              <div class="time-option" 
                   *ngFor="let hour of hours" 
                   [class.selected]="selectedHour === hour"
                   (click)="selectHour(hour)">
                {{hour}}
              </div>
            </div>
          </div>
        </div>
        
        <!-- Minutes Column -->
        <div class="time-column">
          <div class="column-header">Min</div>
          <div class="time-scroll-container">
            <div class="time-options">
              <div class="time-option" 
                   *ngFor="let minute of minutes" 
                   [class.selected]="selectedMinute === minute"
                   (click)="selectMinute(minute)">
                {{minute}}
              </div>
            </div>
          </div>
        </div>
        
        <!-- AM/PM Column -->
        <div class="time-column">
          <div class="column-header">A.M/ P.M</div>
          <div class="time-scroll-container">
            <div class="time-options">
              <div class="time-option" 
                   [class.selected]="selectedPeriod === 'AM'"
                   (click)="selectPeriod('AM')">
                A.M.
              </div>
              <div class="time-option" 
                   [class.selected]="selectedPeriod === 'PM'"
                   (click)="selectPeriod('PM')">
                P.M.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="time-picker-footer">
      <button class="done-btn" (click)="confirmTimeSelection()">
        Done
      </button>
    </div>
  </div>
</div>